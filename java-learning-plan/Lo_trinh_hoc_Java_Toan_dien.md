# Lá»™ trÃ¬nh há»c Java ToÃ n diá»‡n â€“ Tá»« Zero Ä‘áº¿n Hero

**NgÆ°á»i Ä‘á»“ng hÃ nh cá»§a báº¡n trong hÃ nh trÃ¬nh trá»Ÿ thÃ nh Java Developer/Architect.**

ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i giÃ¡o trÃ¬nh Java toÃ n diá»‡n nÃ y! ChÃºng tÃ´i tin ráº±ng má»—i láº­p trÃ¬nh viÃªn Ä‘á»u cÃ³ thá»ƒ xÃ¢y dá»±ng Ä‘Æ°á»£c nhá»¯ng há»‡ thá»‘ng backend quy mÃ´ lá»›n vÃ  chuyÃªn nghiá»‡pâ€”miá»…n lÃ  cÃ³ lá»™ trÃ¬nh rÃµ rÃ ng, kiáº¿n thá»©c cháº¥t lÆ°á»£ng vÃ  thá»±c hÃ nh Ä‘Ãºng hÆ°á»›ng.

**Má»¥c tiÃªu cá»§a giÃ¡o trÃ¬nh:** ÄÆ°a báº¡n tá»« má»©c Ä‘á»™ nháº­p mÃ´n hoÃ n toÃ n (khÃ´ng cáº§n kinh nghiá»‡m Java trÆ°á»›c Ä‘Ã³) cho Ä‘áº¿n khi cÃ³ thá»ƒ tá»± tin triá»ƒn khai cÃ¡c há»‡ thá»‘ng thá»±c táº¿ nhÆ° E-commerce, Social Network, Chat realtime, vÃ  kiáº¿n trÃºc Microservicesâ€”táº¥t cáº£ Ä‘á»u Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i Java vÃ  Spring Boot, tÃ­ch há»£p Ä‘áº§y Ä‘á»§ báº£o máº­t, kiá»ƒm thá»­, tá»‘i Æ°u hiá»‡u nÄƒng, vÃ  quy trÃ¬nh DevOps hiá»‡n Ä‘áº¡i.

**Thá»i lÆ°á»£ng gá»£i Ã½:** 24 tuáº§n (6â€“8 giá» má»—i tuáº§n). Náº¿u báº¡n cÃ³ nhiá»u thá»i gian hÆ¡n hoáº·c Ã­t hÆ¡n, Ä‘á»«ng loâ€”chÃºng tÃ´i cÅ©ng cung cáº¥p lá»™ trÃ¬nh há»c nhanh, trung bÃ¬nh vÃ  cháº­m phÃ¹ há»£p vá»›i tá»«ng hoÃ n cáº£nh á»Ÿ cuá»‘i tÃ i liá»‡u.

---

## Má»¥c lá»¥c

1. [Giá»›i thiá»‡u & Lá»™ trÃ¬nh há»c](#ch1)
2. [CÆ¡ báº£n Java & CÃ´ng cá»¥ (Beginner)](#ch2)
3. [OOP, Collections, I/O & Generics (Beginner)](#ch3)
4. [CÃ´ng cá»¥ build (Maven/Gradle), Packaging & Testing cÆ¡ báº£n (Beginner)](#ch4)
5. [Spring Boot Fundamentals (Intermediate)](#ch5)
6. [Truy cáº­p dá»¯ liá»‡u vá»›i JPA/Hibernate (Intermediate)](#ch6)
7. [Thiáº¿t káº¿ REST API, Validation, Error Handling (Intermediate)](#ch7)
8. [Báº£o máº­t cÄƒn báº£n vá»›i Spring Security + JWT (Intermediate)](#ch8)
9. [HÃ ng Ä‘á»£i tin nháº¯n: RabbitMQ/Kafka (Intermediate)](#ch9)
10. [Hiá»‡u nÄƒng & Caching (Redis), Tuning HikariCP, Actuator (Advanced)](#ch10)
11. [Láº­p trÃ¬nh Reactive: Spring WebFlux (Advanced)](#ch11)
12. [Kiáº¿n trÃºc & Tá»• chá»©c mÃ£: Hexagonal, DDD-lite, Modul hÃ³a (Advanced)](#ch12)
13. [Microservices: gRPC, GraphQL, SAGA, Outbox, Idempotency (Expert)](#ch13)
14. [Quan sÃ¡t & DevOps: Docker, K8s, CI/CD, OpenTelemetry (Expert)](#ch14)
15. [Dá»± Ã¡n máº«u: E-commerce](#ch15)
16. [Dá»± Ã¡n máº«u: Social Network](#ch16)
17. [Dá»± Ã¡n máº«u: Chat Realtime](#ch17)
18. [Dá»± Ã¡n máº«u: Microservices Demo End-to-End](#ch18)
19. [Testing nÃ¢ng cao: Unit, Integration, Contract (Pact), E2E, Testcontainers](#ch19)
20. [Báº£o máº­t chuyÃªn sÃ¢u: OAuth2/OIDC, PKCE, RBAC/ABAC, Anti-XSS/CSRF/CORS](#ch20)
21. [Phá»¥ lá»¥c: Cheat-sheets, máº«u pom/gradle, Dockerfile, Manifests K8s, GH Actions](#ch21)
22. [Timeline Ä‘á» xuáº¥t: Nhanh (full-time), Trung bÃ¬nh (part-time), Cháº­m (hobby)](#ch22)

---

<a id="ch1"></a>

## 1. Giá»›i thiá»‡u & Lá»™ trÃ¬nh há»c

### Táº¡i sao há»c Java vÃ  Spring Boot?

Java váº«n lÃ  má»™t trong nhá»¯ng ngÃ´n ngá»¯ Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i nháº¥t trong cÃ¡c há»‡ thá»‘ng backend quy mÃ´ doanh nghiá»‡p. Káº¿t há»£p vá»›i Spring Bootâ€”framework giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c xÃ¢y dá»±ng á»©ng dá»¥ng enterpriseâ€”báº¡n sáº½ cÃ³ trong tay bá»™ cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ phÃ¡t triá»ƒn cÃ¡c dá»‹ch vá»¥ Ä‘Ã¡ng tin cáº­y, báº£o máº­t vÃ  dá»… má»Ÿ rá»™ng.

Lá»™ trÃ¬nh nÃ y khÃ´ng chá»‰ dáº¡y báº¡n cÃº phÃ¡p Java hay cÃ¡ch dÃ¹ng Spring Boot. ChÃºng tÃ´i sáº½ Ä‘i sÃ¢u vÃ o nhá»¯ng thÃ¡ch thá»©c thá»±c táº¿ mÃ  cÃ¡c Ä‘á»™i ngÅ© phÃ¡t triá»ƒn pháº§n má»m thÆ°á»ng gáº·p: lÃ m tháº¿ nÃ o Ä‘á»ƒ thiáº¿t káº¿ API chuáº©n, báº£o vá»‡ há»‡ thá»‘ng khá»i cÃ¡c lá»— há»•ng báº£o máº­t, tá»‘i Æ°u hiá»‡u nÄƒng khi táº£i tÄƒng cao, vÃ  triá»ƒn khai liÃªn tá»¥c mÃ  khÃ´ng lÃ m giÃ¡n Ä‘oáº¡n dá»‹ch vá»¥.

### Báº¡n sáº½ há»c Ä‘Æ°á»£c gÃ¬?

Trong hÃ nh trÃ¬nh nÃ y, báº¡n sáº½:

- **Náº¯m vá»¯ng ná»n táº£ng Java:** Tá»« cÃº phÃ¡p cÆ¡ báº£n, láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP), Collections Framework, Ä‘áº¿n cÃ¡c khÃ¡i niá»‡m nÃ¢ng cao nhÆ° Generics, I/O, vÃ  Exception Handling.
- **LÃ m chá»§ Spring Boot:** Hiá»ƒu cÆ¡ cháº¿ Dependency Injection, Auto-configuration, cáº¥u hÃ¬nh á»©ng dá»¥ng theo mÃ´i trÆ°á»ng, vÃ  cÃ¡ch táº­n dá»¥ng Spring Actuator Ä‘á»ƒ giÃ¡m sÃ¡t há»‡ thá»‘ng.
- **Thiáº¿t káº¿ vÃ  triá»ƒn khai REST API:** XÃ¢y dá»±ng API chuáº©n RESTful vá»›i validation, xá»­ lÃ½ lá»—i thá»‘ng nháº¥t, phÃ¢n trang vÃ  versioning.
- **Quáº£n lÃ½ dá»¯ liá»‡u bá»n vá»¯ng:** LÃ m viá»‡c vá»›i JPA/Hibernate, thiáº¿t káº¿ schema database, viáº¿t migration vá»›i Flyway/Liquibase, vÃ  tá»‘i Æ°u truy váº¥n Ä‘á»ƒ trÃ¡nh cÃ¡c váº¥n Ä‘á» nhÆ° N+1.
- **Báº£o máº­t á»©ng dá»¥ng:** TÃ­ch há»£p Spring Security, xÃ¡c thá»±c JWT, phÃ¢n quyá»n theo RBAC/ABAC, vÃ  báº£o vá»‡ á»©ng dá»¥ng khá»i cÃ¡c táº¥n cÃ´ng phá»• biáº¿n (XSS, CSRF, SQL Injection).
- **Giao tiáº¿p báº¥t Ä‘á»“ng bá»™:** Sá»­ dá»¥ng message queue (RabbitMQ/Kafka) Ä‘á»ƒ xÃ¢y dá»±ng há»‡ thá»‘ng cÃ³ kháº£ nÄƒng chá»‹u táº£i cao vÃ  decoupled.
- **Tá»‘i Æ°u hiá»‡u nÄƒng:** Cache vá»›i Redis, tinh chá»‰nh connection pool (HikariCP), vÃ  quan sÃ¡t metrics thÃ´ng qua Prometheus/Grafana.
- **Láº­p trÃ¬nh Reactive:** LÃ m viá»‡c vá»›i Spring WebFlux, hiá»ƒu vá» backpressure, vÃ  xá»­ lÃ½ luá»“ng dá»¯ liá»‡u real-time.
- **Kiáº¿n trÃºc pháº§n má»m:** Ãp dá»¥ng Hexagonal Architecture, DDD-lite, vÃ  tá»• chá»©c mÃ£ nguá»“n theo module Ä‘á»ƒ dá»… báº£o trÃ¬.
- **Microservices:** Giao tiáº¿p giá»¯a cÃ¡c service qua gRPC, GraphQL; xá»­ lÃ½ giao dá»‹ch phÃ¢n tÃ¡n vá»›i SAGA pattern; Ä‘áº£m báº£o Ä‘á»™ tin cáº­y vá»›i Outbox pattern.
- **DevOps & Observability:** Container hÃ³a á»©ng dá»¥ng vá»›i Docker, triá»ƒn khai lÃªn Kubernetes, thiáº¿t láº­p CI/CD pipeline, vÃ  giÃ¡m sÃ¡t end-to-end vá»›i OpenTelemetry.

### YÃªu cáº§u kiáº¿n thá»©c ná»n táº£ng

GiÃ¡o trÃ¬nh nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ cho ngÆ°á»i má»›i báº¯t Ä‘áº§u vá»›i Java, nhÆ°ng báº¡n nÃªn cÃ³:

- Hiá»ƒu biáº¿t cÆ¡ báº£n vá» láº­p trÃ¬nh (biáº¿n, vÃ²ng láº·p, Ä‘iá»u kiá»‡nâ€”báº¥t ká»³ ngÃ´n ngá»¯ nÃ o cÅ©ng Ä‘Æ°á»£c)
- Biáº¿t sá»­ dá»¥ng terminal/command line cÆ¡ báº£n
- Quen thuá»™c vá»›i Git Ä‘á»ƒ quáº£n lÃ½ mÃ£ nguá»“n
- CÃ³ kháº£ nÄƒng cÃ i Ä‘áº·t pháº§n má»m trÃªn mÃ¡y tÃ­nh cá»§a báº¡n (JDK, IDE, Docker)

### CÃ¡ch há»c hiá»‡u quáº£ nháº¥t

Há»c láº­p trÃ¬nh khÃ´ng chá»‰ lÃ  Ä‘á»c vÃ  ghi nhá»›â€”quan trá»ng nháº¥t lÃ  **thá»±c hÃ nh Ä‘á»u Ä‘áº·n**. ChÃºng tÃ´i khuyáº¿n khÃ­ch báº¡n:

1. **Äá»c ká»¹ tá»«ng pháº§n:** Hiá»ƒu rÃµ khÃ¡i niá»‡m trÆ°á»›c khi viáº¿t code.
2. **Code theo vÃ­ dá»¥:** GÃµ láº¡i cÃ¡c Ä‘oáº¡n code máº«u, cháº¡y thá»­ vÃ  quan sÃ¡t káº¿t quáº£.
3. **LÃ m bÃ i táº­p:** Má»—i chÆ°Æ¡ng Ä‘á»u cÃ³ bÃ i táº­p thá»±c hÃ nhâ€”hÃ£y hoÃ n thÃ nh chÃºng trÆ°á»›c khi chuyá»ƒn sang chÆ°Æ¡ng tiáº¿p theo.
4. **XÃ¢y dá»±ng dá»± Ã¡n mini:** Ãp dá»¥ng kiáº¿n thá»©c vÃ o cÃ¡c dá»± Ã¡n máº«u (E-commerce, Social Network, Chat) Ä‘á»ƒ cá»§ng cá»‘ ká»¹ nÄƒng.
5. **Äo lÆ°á»ng vÃ  tá»‘i Æ°u:** KhÃ´ng chá»‰ viáº¿t code cháº¡y Ä‘Æ°á»£câ€”hÃ£y há»c cÃ¡ch Ä‘o hiá»‡u nÄƒng, phÃ¡t hiá»‡n lá»—i vÃ  cáº£i thiá»‡n liÃªn tá»¥c.
6. **Ghi chÃº vÃ  Ã´n táº­p:** Viáº¿t láº¡i nhá»¯ng Ä‘iá»ƒm chÃ­nh báº±ng ngÃ´n ngá»¯ cá»§a báº¡n, giáº£i thÃ­ch cho ngÆ°á»i khÃ¡c náº¿u cÃ³ thá»ƒ.

### Cáº¥u trÃºc cá»§a lá»™ trÃ¬nh

Lá»™ trÃ¬nh Ä‘Æ°á»£c chia thÃ nh 4 má»©c Ä‘á»™ chÃ­nh:

#### **Beginner (ChÆ°Æ¡ng 1-4):** Ná»n táº£ng Java

- Java cÆ¡ báº£n, JDK/JRE/JVM
- Láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, Collections, I/O
- Build tools (Maven/Gradle) vÃ  Testing cÆ¡ báº£n

#### **Intermediate (ChÆ°Æ¡ng 5-9):** Spring Boot & Há»‡ sinh thÃ¡i

- Spring Boot Fundamentals
- JPA/Hibernate vÃ  quáº£n lÃ½ transaction
- Thiáº¿t káº¿ REST API, Validation vÃ  Error Handling
- Báº£o máº­t vá»›i Spring Security vÃ  JWT
- Message Queue (RabbitMQ/Kafka)

#### **Advanced (ChÆ°Æ¡ng 10-12):** Hiá»‡u nÄƒng & Kiáº¿n trÃºc

- Hiá»‡u nÄƒng, Caching, Connection Pool tuning
- Láº­p trÃ¬nh Reactive vá»›i Spring WebFlux
- Kiáº¿n trÃºc pháº§n má»m: Hexagonal, DDD-lite, Module hÃ³a

#### **Expert (ChÆ°Æ¡ng 13-14):** Microservices & DevOps

- Microservices: gRPC, GraphQL, SAGA, Outbox
- DevOps: Docker, Kubernetes, CI/CD, OpenTelemetry

#### **Dá»± Ã¡n thá»±c chiáº¿n (ChÆ°Æ¡ng 15-18)**

- E-commerce platform
- Social Network
- Chat Realtime
- Microservices End-to-End Demo

#### **ChuyÃªn sÃ¢u (ChÆ°Æ¡ng 19-20)**

- Testing nÃ¢ng cao (Unit, Integration, Contract, E2E)
- Báº£o máº­t chuyÃªn sÃ¢u (OAuth2/OIDC, RBAC/ABAC)

### Checkpoint vÃ  Ä‘Ã¡nh giÃ¡

Sau má»—i chÆ°Æ¡ng, báº¡n sáº½ tháº¥y pháº§n **"Checkpoint tá»± Ä‘Ã¡nh giÃ¡"** vá»›i cÃ¡c cÃ¢u há»i hoáº·c thá»­ thÃ¡ch nhá». HÃ£y dÃ nh thá»i gian tráº£ lá»i chÃºngâ€”Ä‘Ã¢y lÃ  cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ kiá»ƒm tra xem báº¡n Ä‘Ã£ thá»±c sá»± hiá»ƒu hay chÆ°a.

### Chuáº©n bá»‹ mÃ´i trÆ°á»ng

TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y Ä‘áº£m báº£o báº¡n Ä‘Ã£ cÃ i Ä‘áº·t:

- **JDK 17 trá»Ÿ lÃªn** (khuyÃªn dÃ¹ng Eclipse Temurin hoáº·c OpenJDK)
- **IDE:** IntelliJ IDEA, Eclipse hoáº·c VS Code vá»›i extension Java
- **Docker & Docker Compose:** Äá»ƒ cháº¡y cÃ¡c dá»‹ch vá»¥ phá»¥ thuá»™c (database, message queue, cache)
- **Git:** Äá»ƒ quáº£n lÃ½ mÃ£ nguá»“n
- **Maven hoáº·c Gradle:** Build tool (Maven Ä‘Æ°á»£c khuyÃªn dÃ¹ng cho ngÆ°á»i má»›i)

### Lá»i khuyÃªn cuá»‘i

Äá»«ng vá»™i vÃ ng. Há»c láº­p trÃ¬nh giá»‘ng nhÆ° há»c má»™t ká»¹ nÄƒng thá»§ cÃ´ngâ€”cáº§n thá»i gian, kiÃªn nháº«n vÃ  thá»±c hÃ nh Ä‘á»u Ä‘áº·n. Náº¿u báº¡n gáº·p khÃ³ khÄƒn á»Ÿ má»™t chÆ°Æ¡ng nÃ o Ä‘Ã³, hÃ£y quay láº¡i, Ä‘á»c thÃªm tÃ i liá»‡u bá»• sung, hoáº·c tÃ¬m kiáº¿m sá»± há»— trá»£ tá»« cá»™ng Ä‘á»“ng.

ChÃºng tÃ´i tin ráº±ng vá»›i sá»± kiÃªn trÃ¬ vÃ  lá»™ trÃ¬nh rÃµ rÃ ng nÃ y, báº¡n hoÃ n toÃ n cÃ³ thá»ƒ trá»Ÿ thÃ nh má»™t Java Developer/Architect tá»± tin vÃ  chuyÃªn nghiá»‡p.

**HÃ£y báº¯t Ä‘áº§u hÃ nh trÃ¬nh cá»§a báº¡n ngay bÃ¢y giá»!**

---

### TÃ³m táº¯t chÆ°Æ¡ng 1

Báº¡n Ä‘Ã£ hiá»ƒu Ä‘Æ°á»£c:

- Tá»•ng quan vá» lá»™ trÃ¬nh há»c vÃ  nhá»¯ng gÃ¬ báº¡n sáº½ Ä‘áº¡t Ä‘Æ°á»£c
- Cáº¥u trÃºc 22 chÆ°Æ¡ng tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao
- CÃ¡ch há»c hiá»‡u quáº£ nháº¥t: Ä‘á»c â†’ code â†’ test â†’ Ä‘o Ä‘áº¡c â†’ tá»‘i Æ°u
- YÃªu cáº§u mÃ´i trÆ°á»ng vÃ  cÃ´ng cá»¥ cáº§n chuáº©n bá»‹

### BÃ i táº­p chÆ°Æ¡ng 1

1. **CÃ i Ä‘áº·t mÃ´i trÆ°á»ng Ä‘áº§y Ä‘á»§:**

   - CÃ i JDK 17+ vÃ  xÃ¡c nháº­n báº±ng lá»‡nh `java -version`
   - CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh IDE yÃªu thÃ­ch
   - CÃ i Docker vÃ  cháº¡y thá»­ `docker run hello-world`
   - Clone má»™t repository máº«u tá»« GitHub (tÃ¹y chá»n)

2. **Táº¡o repository Git:**

   - Khá»Ÿi táº¡o má»™t Git repository má»›i cho cÃ¡c bÃ i thá»±c hÃ nh cá»§a báº¡n
   - Táº¡o cáº¥u trÃºc thÆ° má»¥c cho tá»«ng chÆ°Æ¡ng (vÃ­ dá»¥: `ch02-java-basics`, `ch03-oop-collections`...)

3. **Äáº·t má»¥c tiÃªu há»c táº­p:**
   - Viáº¿t ra má»¥c tiÃªu cá»¥ thá»ƒ báº¡n muá»‘n Ä‘áº¡t Ä‘Æ°á»£c sau khi hoÃ n thÃ nh lá»™ trÃ¬nh nÃ y
   - Láº­p lá»‹ch há»c hÃ ng tuáº§n vÃ  cam káº¿t vá»›i báº£n thÃ¢n

**Checkpoint:** Báº¡n Ä‘Ã£ sáºµn sÃ ng khi mÃ´i trÆ°á»ng phÃ¡t triá»ƒn hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh vÃ  báº¡n cÃ³ thá»ƒ cháº¡y Ä‘Æ°á»£c lá»‡nh `java` tá»« terminal.

---

<a id="ch2"></a>

## 2. Java CÆ¡ báº£n & CÃ´ng cá»¥ (Beginner)

### Táº¡i sao pháº§n nÃ y quan trá»ng?

ÄÃ¢y lÃ  ná»n táº£ng cá»§a má»i á»©ng dá»¥ng Java. Náº¿u báº¡n khÃ´ng náº¯m vá»¯ng cÃ¡ch JDK/JRE/JVM hoáº¡t Ä‘á»™ng, cÃ¡ch dá»± Ã¡n Java Ä‘Æ°á»£c cáº¥u trÃºc, vÃ  quy trÃ¬nh build/run cÆ¡ báº£n, báº¡n sáº½ gáº·p khÃ³ khÄƒn khi Ä‘i sÃ¢u vÃ o Spring Boot hay cÃ¡c framework phá»©c táº¡p hÆ¡n.

ChÆ°Æ¡ng nÃ y khÃ´ng chá»‰ dáº¡y cÃº phÃ¡pâ€”chÃºng ta sáº½ Ä‘i sÃ¢u vÃ o cÃ¡ch Java cháº¡y "under the hood", giÃºp báº¡n debug hiá»‡u quáº£, tá»‘i Æ°u á»©ng dá»¥ng, vÃ  hiá»ƒu rÃµ nhá»¯ng gÃ¬ diá»…n ra khi báº¡n nháº¥n nÃºt "Run" trong IDE.

**Má»¥c tiÃªu há»c táº­p:**

- PhÃ¢n biá»‡t rÃµ JDK, JRE vÃ  JVMâ€”vai trÃ² cá»§a tá»«ng thÃ nh pháº§n
- Náº¯m vá»¯ng cÃº phÃ¡p Java cÆ¡ báº£n: kiá»ƒu dá»¯ liá»‡u, Ä‘iá»u khiá»ƒn luá»“ng, class vÃ  method
- Hiá»ƒu cáº¥u trÃºc dá»± Ã¡n Maven/Gradle vÃ  quy trÃ¬nh compile â†’ run â†’ package
- Táº¡o Ä‘Æ°á»£c má»™t REST API Ä‘Æ¡n giáº£n vá»›i Spring Boot

**Thá»i lÆ°á»£ng:** 1 tuáº§n (6â€“8 giá»)

---

### Pháº§n 1: Java, JDK, JRE vÃ  JVMâ€”Hiá»ƒu rÃµ tá»« gá»‘c rá»…

Khi báº¡n viáº¿t dÃ²ng code Java Ä‘áº§u tiÃªn, Ä‘áº±ng sau háº­u trÆ°á»ng lÃ  cáº£ má»™t cá»— mÃ¡y hoáº¡t Ä‘á»™ng tinh vi. HÃ£y cÃ¹ng khÃ¡m phÃ¡ tá»«ng máº£nh ghÃ©p cá»§a bá»©c tranh nÃ y.

#### JVM (Java Virtual Machine) - TrÃ¡i tim cá»§a Java

JVM lÃ  **mÃ¡y áº£o** chá»‹u trÃ¡ch nhiá»‡m thá»±c thi bytecode Java. Khi báº¡n biÃªn dá»‹ch file `.java` báº±ng `javac`, báº¡n nháº­n Ä‘Æ°á»£c file `.class` chá»©a bytecodeâ€”má»™t dáº¡ng mÃ£ trung gian khÃ´ng phá»¥ thuá»™c vÃ o há»‡ Ä‘iá»u hÃ nh hay kiáº¿n trÃºc CPU. JVM Ä‘á»c bytecode nÃ y vÃ  chuyá»ƒn Ä‘á»•i nÃ³ thÃ nh mÃ£ mÃ¡y mÃ  mÃ¡y tÃ­nh cá»§a báº¡n hiá»ƒu Ä‘Æ°á»£c.

**Äiá»ƒm Ä‘áº·c biá»‡t cá»§a JVM:**

- Má»™t bytecode cÃ³ thá»ƒ cháº¡y trÃªn báº¥t ká»³ há»‡ Ä‘iá»u hÃ nh nÃ o cÃ³ JVM (Windows, Linux, macOS)
- JVM quáº£n lÃ½ bá»™ nhá»› tá»± Ä‘á»™ng thÃ´ng qua Garbage Collector (GC)
- JVM tá»‘i Æ°u mÃ£ cá»§a báº¡n lÃºc cháº¡y (runtime) nhá» JIT (Just-In-Time) compiler
- Cung cáº¥p cÃ¡c cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n máº¡nh máº½ nhÆ° `jcmd`, `jfr` (Java Flight Recorder)

Hiá»ƒu JVM giÃºp báº¡n:

- Debug cÃ¡c váº¥n Ä‘á» vá» memory leak, deadlock
- Tá»‘i Æ°u hiá»‡u nÄƒng á»©ng dá»¥ng trong production
- Cáº¥u hÃ¬nh Ä‘Ãºng cÃ¡c tham sá»‘ `-Xmx`, `-Xms`, GC options khi triá»ƒn khai

#### JRE (Java Runtime Environment) - MÃ´i trÆ°á»ng cháº¡y á»©ng dá»¥ng

JRE bao gá»“m JVM cá»™ng vá»›i cÃ¡c thÆ° viá»‡n chuáº©n cá»§a Java (Java SE API). TrÆ°á»›c Java 11, JRE thÆ°á»ng Ä‘Æ°á»£c phÃ¡t hÃ nh riÃªng Ä‘á»ƒ cháº¡y á»©ng dá»¥ng Java mÃ  khÃ´ng cáº§n cÃ´ng cá»¥ phÃ¡t triá»ƒn. Tá»« Java 11 trá»Ÿ Ä‘i, JDK Ä‘Ã£ tÃ­ch há»£p Ä‘áº§y Ä‘á»§ runtime, nÃªn khÃ¡i niá»‡m JRE riÃªng biá»‡t Ã­t phá»• biáº¿n hÆ¡n.

Trong mÃ´i trÆ°á»ng production hiá»‡n Ä‘áº¡i, báº¡n cÃ³ thá»ƒ:

- DÃ¹ng JDK lÃ m runtime (Ä‘Æ¡n giáº£n, dá»… cÃ i Ä‘áº·t)
- Táº¡o runtime tá»‘i thiá»ƒu báº±ng `jlink` Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c Docker image vÃ  tÄƒng báº£o máº­t

#### JDK (Java Development Kit) - Bá»™ cÃ´ng cá»¥ phÃ¡t triá»ƒn

JDK lÃ  bá»™ cÃ´ng cá»¥ Ä‘áº§y Ä‘á»§ dÃ nh cho developer, bao gá»“m:

- **JRE** (Ä‘á»ƒ cháº¡y á»©ng dá»¥ng)
- **javac:** TrÃ¬nh biÃªn dá»‹ch tá»« `.java` â†’ `.class`
- **jar:** ÄÃ³ng gÃ³i á»©ng dá»¥ng thÃ nh file JAR
- **jlink:** Táº¡o runtime tá»‘i thiá»ƒu
- **jpackage:** ÄÃ³ng gÃ³i native installer (exe, deb, rpm...)
- **javadoc:** Táº¡o tÃ i liá»‡u API
- **CÃ´ng cá»¥ cháº©n Ä‘oÃ¡n:** jcmd, jfr, jmap, jstack, jstat...

**LÆ°u Ã½ quan trá»ng:** Khi phÃ¡t triá»ƒn, báº¡n luÃ´n cáº§n JDK. Khi triá»ƒn khai lÃªn server, báº¡n cÃ³ thá»ƒ chá»‰ cáº§n runtime (JRE hoáº·c runtime `jlink`).

#### Chuá»—i build/run trong Java

HÃ£y hÃ¬nh dung quy trÃ¬nh nÃ y nhÆ° má»™t dÃ¢y chuyá»n sáº£n xuáº¥t:

```
YourCode.java â†’ [javac] â†’ YourCode.class (bytecode) â†’ [jar] â†’ app.jar â†’ [java] â†’ JVM â†’ Cháº¡y trÃªn OS/CPU
```

1. **Viáº¿t mÃ£ nguá»“n:** File `.java` chá»©a mÃ£ Java
2. **BiÃªn dá»‹ch:** `javac` chuyá»ƒn Ä‘á»•i thÃ nh bytecode `.class`
3. **ÄÃ³ng gÃ³i:** `jar` gom cÃ¡c file `.class` vÃ  resources thÃ nh file `.jar`
4. **Thá»±c thi:** `java -jar app.jar` khá»Ÿi Ä‘á»™ng JVM vÃ  cháº¡y á»©ng dá»¥ng

---

### Pháº§n 2: CÃº phÃ¡p Java cÆ¡ báº£n

#### Kiá»ƒu dá»¯ liá»‡u: NguyÃªn thá»§y vs Tham chiáº¿u

Java cÃ³ hai loáº¡i kiá»ƒu dá»¯ liá»‡u chÃ­nh:

**Kiá»ƒu nguyÃªn thá»§y (Primitive):**

- `int`, `long`, `double`, `float`, `boolean`, `char`, `byte`, `short`
- LÆ°u trá»±c tiáº¿p giÃ¡ trá»‹ trong stack memory
- Hiá»‡u nÄƒng cao, khÃ´ng cáº§n GC

**Kiá»ƒu tham chiáº¿u (Reference):**

- `String`, `List`, `Map`, cÃ¡c Object tá»± Ä‘á»‹nh nghÄ©a
- LÆ°u Ä‘á»‹a chá»‰ tham chiáº¿u Ä‘áº¿n object trong heap memory
- ÄÆ°á»£c GC quáº£n lÃ½

```java
int age = 25;                    // NguyÃªn thá»§y
String name = "Anh";            // Tham chiáº¿u
List<String> cities = List.of("Hanoi", "Saigon");  // Tham chiáº¿u
```

**Tá»« khÃ³a `final`:** Biáº¿n khÃ´ng thá»ƒ thay Ä‘á»•i tham chiáº¿u (vá»›i reference type, ná»™i dung object váº«n cÃ³ thá»ƒ thay Ä‘á»•i).

**Tá»« khÃ³a `var`:** (Java 10+) Suy luáº­n kiá»ƒu tá»± Ä‘á»™ng cho biáº¿n cá»¥c bá»™.

```java
var count = 10;        // Compiler tá»± hiá»ƒu lÃ  int
var names = List.of("An", "Binh");  // Compiler hiá»ƒu lÃ  List<String>
```

#### Äiá»u khiá»ƒn luá»“ng: If, Switch, VÃ²ng láº·p

```java
// If-else truyá»n thá»‘ng
if (score >= 90) {
    System.out.println("Xuáº¥t sáº¯c");
} else if (score >= 70) {
    System.out.println("KhÃ¡");
} else {
    System.out.println("Cáº§n cá»‘ gáº¯ng");
}

// Switch expression (Java 14+) - hiá»‡n Ä‘áº¡i hÆ¡n
String grade = switch (score / 10) {
    case 10, 9 -> "Xuáº¥t sáº¯c";
    case 8, 7 -> "KhÃ¡";
    default -> "Cáº§n cá»‘ gáº¯ng";
};

// VÃ²ng láº·p for cÆ¡ báº£n
for (int i = 0; i < 5; i++) {
    System.out.println("Láº§n thá»© " + i);
}

// For-each loop (dá»… Ä‘á»c hÆ¡n)
List<String> cities = List.of("Hanoi", "Danang", "Saigon");
for (String city : cities) {
    System.out.println(city);
}

// Stream API (functional style)
cities.stream()
      .filter(c -> c.startsWith("H"))
      .forEach(System.out::println);
```

#### Class, Method vÃ  Package

Java lÃ  ngÃ´n ngá»¯ hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng thuáº§n tÃºy. Má»i thá»© Ä‘á»u náº±m trong class.

```java
// File: User.java
package com.example.model;  // Package giÃºp tá»• chá»©c code

public class User {
    // Fields (thuá»™c tÃ­nh)
    private Long id;
    private String email;

    // Constructor
    public User(Long id, String email) {
        this.id = id;
        this.email = email;
    }

    // Getter/Setter
    public Long getId() { return id; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    // Method (hÃ nh vi)
    public boolean isActive() {
        return email != null && !email.isEmpty();
    }
}
```

---

### Pháº§n 3: Mavenâ€”Quáº£n lÃ½ dá»± Ã¡n vÃ  dependencies

Maven lÃ  cÃ´ng cá»¥ build phá»• biáº¿n nháº¥t trong há»‡ sinh thÃ¡i Java. NÃ³ giÃºp báº¡n:

- Quáº£n lÃ½ dependencies (thÆ° viá»‡n bÃªn ngoÃ i)
- Tá»± Ä‘á»™ng hÃ³a quy trÃ¬nh build (compile, test, package)
- Chuáº©n hÃ³a cáº¥u trÃºc dá»± Ã¡n

#### Cáº¥u trÃºc dá»± Ã¡n Maven chuáº©n

```
my-project/
â”œâ”€â”€ pom.xml                    # File cáº¥u hÃ¬nh Maven
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/              # MÃ£ nguá»“n chÃ­nh
â”‚   â”‚   â”‚   â””â”€â”€ com/example/
â”‚   â”‚   â””â”€â”€ resources/         # File cáº¥u hÃ¬nh, properties
â”‚   â”‚       â””â”€â”€ application.yml
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ java/              # MÃ£ nguá»“n test
â”‚       â””â”€â”€ resources/
â””â”€â”€ target/                    # ThÆ° má»¥c build output (tá»± Ä‘á»™ng táº¡o)
    â””â”€â”€ my-project-1.0.0.jar
```

#### File `pom.xml` cÆ¡ báº£n

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>my-app</artifactId>
  <version>1.0.0</version>

  <properties>
    <maven.compiler.release>17</maven.compiler.release>
  </properties>

  <dependencies>
    <!-- Spring Boot Web Starter -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
  </dependencies>
</project>
```

#### CÃ¡c lá»‡nh Maven thÆ°á»ng dÃ¹ng

```bash
mvn clean          # XÃ³a thÆ° má»¥c target
mvn compile        # BiÃªn dá»‹ch mÃ£ nguá»“n
mvn test           # Cháº¡y unit tests
mvn package        # ÄÃ³ng gÃ³i thÃ nh JAR/WAR
mvn install        # CÃ i vÃ o local repository
mvn spring-boot:run  # Cháº¡y á»©ng dá»¥ng Spring Boot
```

---

### Pháº§n 4: VÃ­ dá»¥ thá»±c hÃ nhâ€”Hello World vá»›i Spring Boot

BÃ¢y giá» chÃºng ta sáº½ káº¿t há»£p táº¥t cáº£ kiáº¿n thá»©c trÃªn Ä‘á»ƒ táº¡o má»™t REST API Ä‘Æ¡n giáº£n.

#### BÆ°á»›c 1: Táº¡o dá»± Ã¡n Spring Boot

CÃ¡ch nhanh nháº¥t lÃ  dÃ¹ng [Spring Initializr](https://start.spring.io/):

- Project: Maven
- Language: Java
- Spring Boot: 3.2+ (hoáº·c má»›i nháº¥t)
- Dependencies: Spring Web

Hoáº·c dÃ¹ng command line:

```bash
curl https://start.spring.io/starter.zip \
  -d dependencies=web \
  -d type=maven-project \
  -d language=java \
  -d bootVersion=3.2.0 \
  -d baseDir=hello-api \
  -o hello-api.zip
unzip hello-api.zip
cd hello-api
```

#### BÆ°á»›c 2: Viáº¿t code

**File: `src/main/java/com/example/demo/DemoApplication.java`**

```java
package com.example.demo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication  // Annotation kÃ­ch hoáº¡t auto-configuration
public class DemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
```

**File: `src/main/java/com/example/demo/HelloController.java`**

```java
package com.example.demo;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.Map;

@RestController  // Annotation Ä‘Ã¡nh dáº¥u Ä‘Ã¢y lÃ  REST controller
public class HelloController {

    @GetMapping("/hello")  // Map HTTP GET /hello
    public Map<String, String> hello() {
        return Map.of(
            "message", "Xin chÃ o Spring Boot!",
            "version", "1.0.0"
        );
    }
}
```

#### BÆ°á»›c 3: Cháº¡y á»©ng dá»¥ng

```bash
./mvnw spring-boot:run
```

Hoáº·c náº¿u báº¡n Ä‘Ã£ cÃ³ Maven global:

```bash
mvn spring-boot:run
```

Má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p: http://localhost:8080/hello

Báº¡n sáº½ tháº¥y JSON response:

```json
{
  "message": "Xin chÃ o Spring Boot!",
  "version": "1.0.0"
}
```

**ChÃºc má»«ng!** Báº¡n vá»«a táº¡o ra REST API Ä‘áº§u tiÃªn vá»›i Spring Boot! ğŸ‰

---

### TÃ³m táº¯t chÆ°Æ¡ng 2

Báº¡n Ä‘Ã£ há»c Ä‘Æ°á»£c:

- **JDK vs JRE vs JVM:** Hiá»ƒu vai trÃ² vÃ  cÃ¡ch chÃºng phá»‘i há»£p
- **CÃº phÃ¡p Java cÆ¡ báº£n:** Kiá»ƒu dá»¯ liá»‡u, Ä‘iá»u khiá»ƒn luá»“ng, class/method
- **Maven:** Cáº¥u trÃºc dá»± Ã¡n, `pom.xml`, vÃ  cÃ¡c lá»‡nh cÆ¡ báº£n
- **Spring Boot:** Táº¡o vÃ  cháº¡y má»™t REST API Ä‘Æ¡n giáº£n

### BÃ i táº­p thá»±c hÃ nh

1. **ThÃªm endpoint `/health`:**

   - Tráº£ vá» `{"status": "UP", "timestamp": "2024-01-15T10:30:00Z"}`
   - Sá»­ dá»¥ng `java.time.Instant` Ä‘á»ƒ láº¥y thá»i gian hiá»‡n táº¡i

2. **Táº¡o endpoint `/calculate`:**

   - Nháº­n hai sá»‘ qua query parameters: `/calculate?a=10&b=5`
   - Tráº£ vá» tá»•ng, hiá»‡u, tÃ­ch, thÆ°Æ¡ng

3. **Viáº¿t README.md:**
   - HÆ°á»›ng dáº«n cÃ i Ä‘áº·t dependencies
   - CÃ¡ch cháº¡y á»©ng dá»¥ng
   - Danh sÃ¡ch endpoints cÃ³ sáºµn

### LÆ°u Ã½ quan trá»ng cho production

- **Cá»‘ Ä‘á»‹nh version JDK:** DÃ¹ng cÃ¹ng version JDK trong dev/CI/production
- **Sá»­ dá»¥ng `--release`:** Äáº£m báº£o bytecode tÆ°Æ¡ng thÃ­ch: `<maven.compiler.release>17</maven.compiler.release>`
- **DÃ¹ng Maven Wrapper:** File `mvnw`/`mvnw.cmd` giÃºp Ä‘áº£m báº£o má»i ngÆ°á»i dÃ¹ng cÃ¹ng version Maven

### Checkpoint tá»± Ä‘Ã¡nh giÃ¡

Tráº£ lá»i cÃ¡c cÃ¢u há»i sau Ä‘á»ƒ kiá»ƒm tra hiá»ƒu biáº¿t cá»§a báº¡n:

1. Sá»± khÃ¡c biá»‡t chÃ­nh giá»¯a JDK vÃ  JRE lÃ  gÃ¬?
2. Bytecode Java Ä‘Æ°á»£c lÆ°u trong file nÃ o sau khi biÃªn dá»‹ch?
3. Táº¡i sao nÃªn dÃ¹ng `final` cho biáº¿n khÃ´ng thay Ä‘á»•i?
4. Maven lÆ°u dependencies Ä‘Ã£ táº£i vá» á»Ÿ Ä‘Ã¢u? (Gá»£i Ã½: `~/.m2/repository`)
5. LÃ m tháº¿ nÃ o Ä‘á»ƒ thay Ä‘á»•i port máº·c Ä‘á»‹nh cá»§a Spring Boot? (Gá»£i Ã½: `application.properties`)

---

## JDK vs JRE vs JVM

Khi báº¡n viáº¿t má»™t dÃ²ng code Java Ä‘áº§u tiÃªn, Ä‘áº±ng sau háº­u trÆ°á»ng lÃ  cáº£ má»™t cá»— mÃ¡y hoáº¡t Ä‘á»™ng tinh vi: bá»™ cÃ´ng cá»¥ phÃ¡t triá»ƒn (JDK) Ä‘á»ƒ biÃªn dá»‹ch vÃ  Ä‘Ã³ng gÃ³i, mÃ´i trÆ°á»ng cháº¡y (JRE) Ä‘á»ƒ cung cáº¥p thÆ° viá»‡n chuáº©n vÃ  Ä‘áº·c biá»‡t lÃ  mÃ¡y áº£o Java (JVM) â€“ trÃ¡i tim thá»±c thi bytecode cá»§a báº¡n trÃªn má»i há»‡ Ä‘iá»u hÃ nh, kiáº¿n trÃºc CPU. Hiá»ƒu rÃµ ba khÃ¡i niá»‡m nÃ y giÃºp báº¡n lÃ m chá»§ quy trÃ¬nh build/run, cáº¥u hÃ¬nh Ä‘Ãºng mÃ´i trÆ°á»ng production, debug sá»± cá»‘ hiá»‡u nÄƒng, vÃ  tá»‘i Æ°u chi phÃ­ khi váº­n hÃ nh á»Ÿ quy mÃ´ lá»›n (microservices cháº¡y trong container, autoscaling, CI/CDâ€¦). Pháº§n nÃ y Ä‘Æ°á»£c viáº¿t nhÆ° má»™t chÆ°Æ¡ng Ä‘á»™c láº­p, Ä‘i tá»« nguyÃªn lÃ½ â†’ thá»±c hÃ nh â†’ tá»‘i Æ°u, kÃ¨m vÃ­ dá»¥ cháº¡y Ä‘Æ°á»£c vÃ  bÃ i táº­p thá»±c chiáº¿n.

### Giá»›i thiá»‡u tá»•ng quan: JDK, JRE, JVM lÃ  gÃ¬ vÃ  vÃ¬ sao quan trá»ng

JVM (Java Virtual Machine) lÃ  chÆ°Æ¡ng trÃ¬nh mÃ´ phá»ng má»™t mÃ¡y áº£o nÆ¡i bytecode Java Ä‘Æ°á»£c thá»±c thi. Bytecode lÃ  dáº¡ng trung gian sau khi file `.java` Ä‘Æ°á»£c biÃªn dá»‹ch bá»Ÿi `javac` thÃ nh file `.class`. JVM cung cáº¥p cÃ¡c dá»‹ch vá»¥ runtime nhÆ° quáº£n lÃ½ bá»™ nhá»› (GC), náº¡p lá»›p (class loader), JIT compiler, kiá»ƒm soÃ¡t luá»“ng, vÃ  má»™t loáº¡t cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n (jcmd, jfrâ€¦). Äiá»ƒm Ä‘áº·c biá»‡t: cÃ¹ng má»™t bytecode, JVM cÃ³ thá»ƒ cháº¡y trÃªn Windows/Linux/macOS vÃ  nhiá»u kiáº¿n trÃºc CPU khÃ¡c nhau (x64, ARM64â€¦), giÃºp Java Ä‘áº¡t kháº©u hiá»‡u â€œwrite once, run anywhereâ€.

JRE (Java Runtime Environment) lÃ  táº­p há»£p bao gá»“m JVM + thÆ° viá»‡n chuáº©n (Java SE). TrÆ°á»›c Java 11, JRE thÆ°á»ng Ä‘Æ°á»£c phÃ¡t hÃ nh tÃ¡ch riÃªng cho má»¥c Ä‘Ã­ch cháº¡y á»©ng dá»¥ng. Tá»« Java 11 trá»Ÿ Ä‘i, thá»±c táº¿ JDK Ä‘Ã£ bao gá»“m Ä‘áº§y Ä‘á»§ mÃ´i trÆ°á»ng runtime; cÃ¡c báº£n JRE riÃªng Ã­t phá»• biáº¿n hÆ¡n. Trong triá»ƒn khai production hiá»‡n Ä‘áº¡i, báº¡n cÃ³ thá»ƒ dÃ¹ng chÃ­nh JDK lÃ m runtime, hoáº·c táº¡o má»™t runtime tá»‘i thiá»ƒu báº±ng `jlink` Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c vÃ  bá» máº·t táº¥n cÃ´ng.

JDK (Java Development Kit) lÃ  bá»™ cÃ´ng cá»¥ dÃ nh cho nhÃ  phÃ¡t triá»ƒn: ngoÃ i thÃ nh pháº§n runtime (tá»©c lÃ  JRE) cÃ²n cÃ³ cÃ¡c cÃ´ng cá»¥ nhÆ° `javac` (biÃªn dá»‹ch), `jar` (Ä‘Ã³ng gÃ³i), `jlink` (táº¡o runtime tá»‘i thiá»ƒu), `jpackage` (Ä‘Ã³ng gÃ³i native installer), `jcmd` (Ä‘iá»u khiá»ƒn/quan sÃ¡t JVM), `jfr` (Java Flight Recorder â€“ ghi há»“ sÆ¡ thá»±c thi), `jmap`, `jstat`, `jstack`, `jconsole`, `javadoc`â€¦ NhÃ  phÃ¡t triá»ƒn luÃ´n lÃ m viá»‡c vá»›i JDK; mÃ¡y production cÃ³ thá»ƒ dÃ¹ng JDK hoáº·c má»™t runtime tá»‘i thiá»ƒu tuá»³ chiáº¿n lÆ°á»£c.

VÃ¬ sao cáº§n há»c ká»¹? VÃ¬ má»i quyáº¿t Ä‘á»‹nh báº¡n Ä‘Æ°a ra â€“ chá»n phiÃªn báº£n LTS (17/21), cáº¥u hÃ¬nh GC, Ä‘áº·t `-Xmx`, báº­t JIT hay profile báº±ng JFR, xÃ¢y Docker image báº±ng JDK vendor nÃ o â€“ Ä‘á»u tÃ¡c Ä‘á»™ng trá»±c tiáº¿p Ä‘áº¿n Ä‘á»™ á»•n Ä‘á»‹nh, latency, throughput, vÃ  chi phÃ­ háº¡ táº§ng á»Ÿ quy mÃ´ lá»›n.

### Chuá»—i build/run trong Java: tá»« .java Ä‘áº¿n tiáº¿n trÃ¬nh JVM

HÃ nh trÃ¬nh tiÃªu chuáº©n cá»§a má»™t chÆ°Æ¡ng trÃ¬nh Java:

1. Viáº¿t mÃ£ nguá»“n `.java` vá»›i cÃ¡c lá»›p vÃ  phÆ°Æ¡ng thá»©c.
2. BiÃªn dá»‹ch báº±ng `javac` Ä‘á»ƒ sinh file `.class` chá»©a bytecode.
3. ÄÃ³ng gÃ³i cÃ¡c `.class` (cÃ¹ng tÃ i nguyÃªn) thÃ nh `.jar` (Java ARchive).
4. Thá»±c thi báº±ng `java -cp ... MainClass` hoáº·c `java -jar app.jar`.

Báº¡n cÃ³ thá»ƒ quan sÃ¡t bytecode báº±ng `javap -c` Ä‘á»ƒ hiá»ƒu JVM thá»±c sá»± cháº¡y gÃ¬. Äiá»u nÃ y há»¯u Ã­ch khi phÃ¢n tÃ­ch tá»‘i Æ°u hoÃ¡ cá»§a JIT, inlining, hoáº·c Ä‘Æ¡n giáº£n lÃ  xÃ¡c minh behavior.

VÃ­ dá»¥ tá»‘i thiá»ƒu minh hoáº¡ chuá»—i nÃ y vÃ  in thÃ´ng tin runtime:

```java
// File: Main.java
public class Main {
    public static void main(String[] args) {
        System.out.println("Xin chÃ o tá»« JVM!");
        System.out.println("java.version=" + System.getProperty("java.version"));
        System.out.println("java.vendor=" + System.getProperty("java.vendor"));
        System.out.println("java.vm.name=" + System.getProperty("java.vm.name"));
        System.out.println("os.name=" + System.getProperty("os.name"));

        // TÃ­nh toÃ¡n Ä‘Æ¡n giáº£n Ä‘á»ƒ lÃ m nÃ³ng JIT (tiered compilation sáº½ tá»‘i Æ°u sau vÃ i nghÃ¬n iteration)
        long sum = 0;
        for (int i = 0; i < 5_000_000; i++) sum += i;
        System.out.println("sum=" + sum);
    }
}
```

Cháº¡y báº±ng CLI:

```bash
javac Main.java            # biÃªn dá»‹ch -> Main.class
java Main                  # cháº¡y class trá»±c tiáº¿p

# ÄÃ³ng gÃ³i thÃ nh JAR cÃ³ Main-Class
jar --create --file app.jar --main-class Main Main.class
java -jar app.jar
```

Náº¿u báº¡n dÃ¹ng Maven, hÃ£y cá»‘ Ä‘á»‹nh version phÃ¡t hÃ nh má»¥c tiÃªu Ä‘á»ƒ trÃ¡nh lá»‡ch mÃ´i trÆ°á»ng cháº¡y:

```xml
<!-- pom.xml (tá»‘i thiá»ƒu, pháº§n compiler) -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.example</groupId>
  <artifactId>jdk-jre-jvm-demo</artifactId>
  <version>1.0.0</version>
  <properties>
    <maven.compiler.release>17</maven.compiler.release>
  </properties>
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.11.0</version>
        <configuration>
          <release>${maven.compiler.release}</release>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-jar-plugin</artifactId>
        <version>3.3.0</version>
        <configuration>
          <archive>
            <manifest>
              <mainClass>Main</mainClass>
            </manifest>
          </archive>
        </configuration>
      </plugin>
    </plugins>
  </build>
  <!-- CÃ³ thá»ƒ thÃªm maven-surefire-plugin, maven-shade-plugin tuá»³ nhu cáº§u -->
</project>
```

Build vÃ  cháº¡y:

```bash
mvn -q -DskipTests package
java -jar target/jdk-jre-jvm-demo-1.0.0.jar
```

áº¢nh hÆ°á»Ÿng hiá»‡u nÄƒng: Khi cháº¡y láº§n Ä‘áº§u, má»™t sá»‘ phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c thÃ´ng dá»‹ch; sau khi â€œnÃ³ngâ€ (Ä‘Æ°á»£c gá»i nhiá»u), JIT biÃªn dá»‹ch sang mÃ£ mÃ¡y tá»‘i Æ°u. Náº¿u báº¡n benchmark, cáº§n warmâ€‘up Ä‘á»ƒ trÃ¡nh káº¿t quáº£ bá»‹ nhiá»…u.

### BÃªn trong JVM: bá»™ náº¡p lá»›p, bá»™ nhá»›, JIT, GC

JVM táº£i lá»›p thÃ´ng qua há»‡ thá»‘ng class loader phÃ¢n táº§ng: bootstrap (cho java.base), platform, vÃ  application (classpath). Báº¡n cÅ©ng cÃ³ thá»ƒ cÃ³ custom class loader (thÆ°á»ng dÃ¹ng trong framework hoáº·c container). Má»—i lá»›p gáº¯n vá»›i má»™t class loader; hai lá»›p cÃ³ cÃ¹ng tÃªn nhÆ°ng tá»« class loader khÃ¡c nhau Ä‘Æ°á»£c xem lÃ  khÃ¡c nhau â€“ Ä‘Ã¢y lÃ  nguyÃªn nhÃ¢n nhiá»u lá»—i ClassCastException â€œká»³ quáº·câ€ trÃªn cÃ¡c server container cÅ©.

Bá»™ nhá»› JVM gá»“m:

- Heap: nÆ¡i Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c cáº¥p phÃ¡t; chia vÃ¹ng young/old; cÃ³ TLAB (Threadâ€‘Local Allocation Buffer) giÃºp cáº¥p phÃ¡t cá»±c nhanh theo tá»«ng thread.
- Stack per thread: lÆ°u khung ngÄƒn xáº¿p cho lá»i gá»i hÃ m, biáº¿n cá»¥c bá»™ kiá»ƒu nguyÃªn thuá»·, tham chiáº¿u.
- Metaspace: lÆ°u metadata cá»§a lá»›p (thay tháº¿ PermGen tá»« Java 8); máº·c Ä‘á»‹nh cÃ³ thá»ƒ ná»Ÿ ra theo nhu cáº§u, nhÆ°ng báº¡n nÃªn giá»›i háº¡n trong prod Ä‘á»ƒ trÃ¡nh rÃ² rá»‰ classloader.
- Code cache: lÆ°u mÃ£ mÃ¡y do JIT sinh ra.

JIT (Justâ€‘Inâ€‘Time) vá»›i tiered compilation (C1/C2, hoáº·c Graal JIT) quan sÃ¡t hot methods vÃ  tá»‘i Æ°u: inlining, escape analysis (Ä‘Æ°a cáº¥p phÃ¡t lÃªn stack khi cÃ³ thá»ƒ), loop unrollingâ€¦ Äiá»u nÃ y giáº£i thÃ­ch vÃ¬ sao hiá»‡u nÄƒng tÄƒng dáº§n sau warmâ€‘up. Báº¡n cÃ³ thá»ƒ báº­t JFR Ä‘á»ƒ quan sÃ¡t má»©c tá»‘i Æ°u vÃ  hotspot.

GC (Garbage Collector) tá»± Ä‘á»™ng thu há»“i bá»™ nhá»›. CÃ¡c tuá»³ chá»n phá»• biáº¿n:

- G1GC (máº·c Ä‘á»‹nh trÃªn 17/21): cÃ¢n báº±ng latency/throughput, phÃ¹ há»£p háº§u háº¿t dá»‹ch vá»¥ backend.
- ZGC (Ä‘á»™ trá»… cá»±c tháº¥p, thay Ä‘á»•i heap size nhanh): há»¯u Ã­ch cho dá»‹ch vá»¥ yÃªu cáº§u p99 ráº¥t tháº¥p, heap lá»›n.
- Shenandoah (lowâ€‘pause): tÆ°Æ¡ng tá»± ZGC, do Red Hat.
- Parallel/Serial: Ä‘Ã£ Ã­t dÃ¹ng trong dá»‹ch vá»¥ production hiá»‡n Ä‘áº¡i trá»« trÆ°á»ng há»£p Ä‘áº·c thÃ¹.

Trong container, Java 10+ tÃ´n trá»ng giá»›i háº¡n cgroup (CPU/mem). Tuy váº­y, báº¡n váº«n nÃªn Ä‘áº·t chiáº¿n lÆ°á»£c heap rÃµ rÃ ng:

- Thiáº¿t láº­p trá»±c tiáº¿p: `-Xms512m -Xmx2048m` Ä‘á»ƒ kiá»ƒm soÃ¡t cháº·t.
- Hoáº·c dÃ¹ng pháº§n trÄƒm: `-XX:InitialRAMPercentage=20 -XX:MaxRAMPercentage=70` Ä‘á»ƒ tá»± thÃ­ch á»©ng nhiá»u kÃ­ch cá»¡ pod.
  KÃ¨m theo Ä‘Ã³ lÃ  GC logging/metrics Ä‘á»ƒ theo dÃµi pause time, allocation rate.

VÃ­ dá»¥ báº­t log GC hiá»‡n Ä‘áº¡i:

```bash
java -Xms512m -Xmx1024m \
     -XX:+UseG1GC \
     -Xlog:gc*,safepoint:file=gc.log:time,uptime,level,tags \
     -jar app.jar
```

### ClassPath vs ModulePath (Java 9+)

TrÆ°á»›c Java 9, JVM dÃ¹ng classpath â€“ danh sÃ¡ch thÆ° má»¥c/JAR Ä‘á»ƒ tÃ¬m lá»›p. Tá»« Java 9, há»‡ thá»‘ng module (Project Jigsaw) cho phÃ©p mÃ´â€‘Ä‘un hoÃ¡ JDK/á»©ng dá»¥ng: báº¡n khai bÃ¡o `module-info.java`, dÃ¹ng module path Ä‘á»ƒ kiá»ƒm soÃ¡t export/require rÃµ rÃ ng. Vá»›i á»©ng dá»¥ng Spring Boot, pháº§n lá»›n váº«n cháº¡y tá»‘t trÃªn classpath (vÃ¬ Spring Boot sá»­ dá»¥ng cÆ¡ cháº¿ loader riÃªng cho fatâ€‘jar). Báº¡n nÃªn hiá»ƒu module Ä‘á»ƒ lÃ m viá»‡c vá»›i `jlink`/`jpackage` hoáº·c á»©ng dá»¥ng desktop/native.

VÃ­ dá»¥ module tá»‘i thiá»ƒu:

```java
// module-info.java
module com.example.app {
  requires java.base;      // luÃ´n cÃ³
  requires java.net.http;  // vÃ­ dá»¥ cáº§n HTTP Client
  exports com.example.api; // gÃ³i public cho module khÃ¡c dÃ¹ng
}
```

### PhÃ¢n phá»‘i JDK: OpenJDK, Temurin, Oracle JDK, GraalVM

Báº¡n cÃ³ nhiá»u lá»±a chá»n vendor JDK: OpenJDK build, Eclipse Temurin (Adoptium), Oracle JDK, Amazon Corretto, Azul Zulu, BellSoft Liberica, GraalVMâ€¦ Trong Ä‘a sá»‘ há»‡ thá»‘ng backend, Temurin/OpenJDK LTS (17/21) lÃ  lá»±a chá»n á»•n Ä‘á»‹nh, cáº­p nháº­t báº£o máº­t Ä‘á»u. Náº¿u báº¡n muá»‘n native image hoáº·c polyglot (GraalVM languages), cÃ¢n nháº¯c GraalVM. Quan trá»ng nháº¥t lÃ  Ä‘á»“ng bá»™ cÃ¹ng má»™t dÃ²ng LTS cho dev/CI/prod Ä‘á»ƒ trÃ¡nh sai khÃ¡c micro.

### Táº¡o runtime tá»‘i thiá»ƒu báº±ng jlink; Ä‘Ã³ng gÃ³i native báº±ng jpackage

`jlink` cho phÃ©p báº¡n táº¡o má»™t runtime (gáº§n nhÆ° â€œJRE thá»­a riÃªngâ€) chá»‰ chá»©a cÃ¡c mÃ´â€‘Ä‘un JDK báº¡n cáº§n â€“ giáº£m kÃ­ch thÆ°á»›c image vÃ  cáº£i thiá»‡n báº£o máº­t do loáº¡i bá» thÃ nh pháº§n thá»«a. Quy trÃ¬nh Ä‘iá»ƒn hÃ¬nh:

```bash
# PhÃ¡t hiá»‡n mÃ´-Ä‘un cáº§n thiáº¿t tá»« JAR
jdeps --print-module-deps --multi-release=17 target/app.jar

# Táº¡o runtime tá»‘i thiá»ƒu (vÃ­ dá»¥ chá»‰ cáº§n java.base vÃ  java.net.http)
jlink --no-header-files --no-man-pages \
      --compress=2 \
      --add-modules java.base,java.net.http \
      --output runtime-min

# Cháº¡y á»©ng dá»¥ng báº±ng runtime vá»«a táº¡o
./runtime-min/bin/java -jar target/app.jar
```

`jpackage` cÃ³ thá»ƒ táº¡o installer native (msi, pkg, deb, rpm) â€“ há»¯u Ã­ch cho desktop, Ã­t dÃ¹ng trong microservice nhÆ°ng há»¯u Ã­ch khi cáº§n ship onâ€‘prem.

### Spring Boot vÃ  JVM: nhá»¯ng khÃ¡c biá»‡t cáº§n lÆ°u Ã½

Spring Boot táº¡o â€œfat jarâ€/â€œÃ¼berâ€‘jarâ€ chá»©a dependencies vÃ  má»™t boot loader chuyÃªn biá»‡t. Cháº¡y báº±ng `java -jar app.jar` thay vÃ¬ `java -cp ...` thÃ´ng thÆ°á»ng. áº¢nh hÆ°á»Ÿng:

- Class loader Ä‘áº·c thÃ¹ cá»§a Boot: khi debug `ClassNotFoundException`, hÃ£y kiá»ƒm tra cáº¥u trÃºc jar (`jar tf app.jar`) vÃ  hiá»ƒu cÆ¡ cháº¿ nested JAR.
- Layered jar: cÃ³ thá»ƒ dÃ¹ng `spring-boot-jarmode` hoáº·c cáº¥u hÃ¬nh `spring-boot-maven-plugin` Ä‘á»ƒ báº­t cháº¿ Ä‘á»™ layered cho Docker cache tá»‘t hÆ¡n.

Dockerfile máº«u theo multiâ€‘stage build cho Spring Boot:

```dockerfile
# Stage 1: build
FROM eclipse-temurin:17-jdk AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn -q -DskipTests package

# Stage 2: run (runtime tá»‘i thiá»ƒu)
FROM eclipse-temurin:17-jre
ENV JAVA_OPTS="-XX:InitialRAMPercentage=20 -XX:MaxRAMPercentage=70 -XX:+UseG1GC"
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["sh","-c","java $JAVA_OPTS -jar app.jar"]
```

Báº¡n cÃ³ thá»ƒ thay `17-jre` báº±ng runtime `jlink` do báº¡n táº¡o Ä‘á»ƒ giáº£m kÃ­ch thÆ°á»›c thÃªm ná»¯a.

### Quan sÃ¡t vÃ  debug JVM trong production

á» mÃ´i trÆ°á»ng tháº­t, khi gáº·p sá»± cá»‘ CPU cao, GC pause, memory leak hoáº·c deadlock, báº¡n cáº§n cÃ´ng cá»¥ Ä‘Ãºng:

- jcmd: cá»•ng Ä‘iá»u khiá»ƒn Ä‘a nÄƒng â€“ liá»‡t kÃª flags, heap, thread dump, kÃ­ch hoáº¡t JFR.
- jfr (Java Flight Recorder): ghi há»“ sÆ¡ thá»±c thi (CPU, allocation, GC, I/O, lock contentionâ€¦) vá»›i overhead tháº¥p, cÃ³ thá»ƒ báº­t/ táº¯t nÃ³ng.
- jstack: láº¥y thread dump, há»¯u Ã­ch khi nghi deadlock hoáº·c block I/O.
- jmap/jstat: quan sÃ¡t heap, histo, GC stats (trong cÃ¡c phiÃªn báº£n má»›i, dÃ¹ng `jcmd`/`jfr` thay tháº¿ nhiá»u trÆ°á»ng há»£p).

VÃ­ dá»¥: báº­t JFR 60 giÃ¢y vÃ  ghi ra file, Ä‘á»“ng thá»i láº¥y thread dump vÃ  class histogram:

```bash
PID=$(jcmd | awk '/app.jar/{print $1}')
jcmd $PID JFR.start duration=60s filename=app.jfr settings=profile
jcmd $PID Thread.print > threads.txt
jcmd $PID GC.class_histogram > histo.txt
jcmd $PID JFR.dump filename=app.jfr
```

### Khi nÃ o dÃ¹ng JDK/JRE/jlink trong production

- Triá»ƒn khai nhanh, Ä‘Æ¡n giáº£n: dÃ¹ng JDK/JRE vendor LTS (Temurin 17/21). Æ¯u Ä‘iá»ƒm: dá»… cÃ i Ä‘áº·t, cáº­p nháº­t. NhÆ°á»£c: image to hÆ¡n runtime tá»‘i thiá»ƒu.
- Tá»‘i Æ°u kÃ­ch thÆ°á»›c vÃ  báº£o máº­t: dÃ¹ng `jlink` Ä‘á»ƒ chá»‰ giá»¯ mÃ´â€‘Ä‘un cáº§n thiáº¿t. Cáº§n hiá»ƒu module, kiá»ƒm thá»­ ká»¹ vÃ¬ runtime quÃ¡ tá»‘i giáº£n cÃ³ thá»ƒ thiáº¿u tiá»‡n Ã­ch cháº©n Ä‘oÃ¡n quen thuá»™c náº¿u báº¡n loáº¡i bá».
- SiÃªu nháº¹/khá»Ÿi Ä‘á»™ng cá»±c nhanh: cÃ¢n nháº¯c GraalVM Native Image cho dá»‹ch vá»¥ nhá» cáº§n cold start nhanh (lambda, CLI). ÄÃ¡nh Ä‘á»•i: má»™t sá»‘ tÃ­nh nÄƒng reflection vÃ  dynamic proxy cáº§n cáº¥u hÃ¬nh phá»©c táº¡p; footprint runtime nhá» nhÆ°ng thá»i gian build lá»›n.

### á»¨ng dá»¥ng thá»±c táº¿ trong cÃ¡c há»‡ thá»‘ng lá»›n

Eâ€‘commerce: há»‡ thá»‘ng thÆ°á»ng náº·ng truy váº¥n DB, nhiá»u chuá»—i String (SKU, mÃ´ táº£), vÃ  peak traffic theo giá». DÃ¹ng G1GC máº·c Ä‘á»‹nh, cÃ¢n nháº¯c `-XX:+UseStringDeduplication` Ä‘á»ƒ giáº£m duplicate String. Tá»‘i Æ°u pool káº¿t ná»‘i (HikariCP). Trong container, Ä‘áº·t `-Xms`â‰ˆ30â€“50% vÃ  `-Xmx`â‰ˆ60â€“75% limit. Báº­t metrics qua Actuator Ä‘á»ƒ quan sÃ¡t GC vÃ  thread pool.

Máº¡ng xÃ£ há»™i: táº£i biáº¿n Ä‘á»™ng, nhiá»u event ná»n (feed, recommendation). DÃ¹ng JFR Ä‘á»‹nh ká»³ 1â€“2 phÃºt trong peak Ä‘á»ƒ phÃ¡t hiá»‡n Ä‘iá»ƒm nÃ³ng (hot methods) â€“ thÆ°á»ng lÃ  serialization/deserialization, JSON binding. DÃ¹ng Jackson afterburner hoáº·c switch sang JSONâ€‘B/record Ä‘á»ƒ giáº£m overhead.

Chat realtime: nháº¡y cáº£m latency, nhiá»u káº¿t ná»‘i. CÃ¢n nháº¯c ZGC náº¿u heap lá»›n vÃ  p99 cáº§n ráº¥t tháº¥p; kiá»ƒm soÃ¡t allocation rate (giáº£m object chatter), dÃ¹ng byte buffer/pooled buffers cho I/O. Thá»­ Netty vÃ  pháº£n á»©ng báº¥t Ä‘á»“ng bá»™ (WebFlux) Ä‘á»ƒ giáº£m thread context switching.

Microservices: ráº¥t nhiá»u service nhá». Äá»“ng bá»™ JDK LTS; fixed set flags cho cÃ¡c profile (dev/stage/prod). Vá»›i service nhá», `jlink` giÃºp giáº£m image vÃ  cold start; vá»›i service phá»©c táº¡p, cá»© JDK/JRE LTS chuáº©n Ä‘á»ƒ thÃªm cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n thuáº­n tiá»‡n.

### VÃ­ dá»¥ minh hoáº¡ Ä‘áº§y Ä‘á»§: Spring Boot + Actuator + cáº¥u hÃ¬nh JVM containerâ€‘friendly

pom.xml (trá»ng tÃ¢m):

```xml
<project>
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.3.0</version>
  </parent>
  <groupId>com.example</groupId>
  <artifactId>boot-jvm-demo</artifactId>
  <version>1.0.0</version>
  <properties>
    <java.version>17</java.version>
  </properties>
  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
  </dependencies>
</project>
```

á»¨ng dá»¥ng vÃ  controller Ä‘Æ¡n giáº£n:

```java
// src/main/java/com/example/DemoApplication.java
package com.example;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class DemoApplication {
  public static void main(String[] args) {
    SpringApplication.run(DemoApplication.class, args);
  }
}

// src/main/java/com/example/HelloController.java
package com.example;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.Map;

@RestController
class HelloController {
  @GetMapping("/hello")
  public Map<String, Object> hello() {
    return Map.of(
      "message", "Xin chÃ o Spring Boot!",
      "java", System.getProperty("java.version"),
      "vm", System.getProperty("java.vm.name")
    );
  }
}
```

Cáº¥u hÃ¬nh Actuator vÃ  management port, Ä‘á»“ng thá»i demo cáº¥u hÃ¬nh GC log:

```properties
# src/main/resources/application.properties
server.port=8080
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
```

Cháº¡y kÃ¨m JVM flags thÃ¢n thiá»‡n container:

```bash
JAVA_OPTS="-XX:InitialRAMPercentage=20 -XX:MaxRAMPercentage=70 -XX:+UseG1GC -Xlog:gc*,safepoint:stdout:time"
mvn -q -DskipTests spring-boot:run -Dspring-boot.run.jvmArguments=\"$JAVA_OPTS\"
```

Giáº£i thÃ­ch hoáº¡t Ä‘á»™ng trong JVM vÃ  hiá»‡u nÄƒng:

- LÃºc khá»Ÿi Ä‘á»™ng, class loader cá»§a Spring Boot náº¡p cÃ¡c lá»›p tá»« nested JAR, má»™t sá»‘ bean khá»Ÿi táº¡o ngay (eager), má»™t sá»‘ lazy. HÃ£y báº­t `spring.main.lazy-initialization=true` náº¿u cold start quan trá»ng.
- Sau vÃ i request, JIT tá»‘i Æ°u cÃ¡c hot path nhÆ° serialization JSON, mapping HTTP â†’ method. GC G1 hoáº¡t Ä‘á»™ng chá»§ yáº¿u trong young GC nhanh; náº¿u heap quÃ¡ nhá», báº¡n sáº½ tháº¥y nhiá»u major GC â†’ tÄƒng `-Xmx`.

### BÃ i táº­p thá»±c hÃ nh (kÃ¨m gá»£i Ã½)

1. UnsupportedClassVersionError â€œ54.0/61.0â€
   â€“ Cá»‘ tÃ¬nh biÃªn dá»‹ch báº±ng JDK 21, cháº¡y trÃªn runtime 17 Ä‘á»ƒ nháº­n lá»—i. Sá»­a báº±ng `javac --release 17` hoáº·c `<maven.compiler.release>17</maven.compiler.release>`.

2. Kiá»ƒm tra classpath vs modulepath
   â€“ Viáº¿t má»™t app nhá» dÃ¹ng `java.net.http`. Cháº¡y báº±ng classpath sáº½ á»•n; thÃªm `module-info.java` rá»“i thá»­ cháº¡y báº±ng module path (`java --module-path`). Quan sÃ¡t lá»—i khi thiáº¿u require/export vÃ  sá»­a.

3. Quan sÃ¡t JIT warmâ€‘up
   â€“ Viáº¿t má»™t vÃ²ng láº·p tÃ­nh toÃ¡n (vÃ­ dá»¥ sum hoáº·c xá»­ lÃ½ chuá»—i) vÃ  Ä‘o thá»i gian á»Ÿ láº§n Ä‘áº§u vs sau 5 láº§n. Gá»£i Ã½: `System.nanoTime()`; cháº¡y áº¥m trÆ°á»›c khi Ä‘o.

4. Ghi JFR 60s trong lÃºc load test
   â€“ DÃ¹ng `ab`/`wrk` (hoáº·c Postman Runner) gá»­i request Ä‘áº¿n `/hello` cá»§a Spring Boot; báº­t `-XX:StartFlightRecording=duration=60s,filename=app.jfr` vÃ  má»Ÿ file báº±ng JDK Mission Control Ä‘á»ƒ xem allocation hot spot.

5. Táº¡o runtime `jlink` vÃ  Docker image nhá»
   â€“ Cháº¡y `jdeps` Ä‘á»ƒ phÃ¡t hiá»‡n mÃ´â€‘Ä‘un cáº§n, táº¡o `runtime-min`, viáº¿t Dockerfile dÃ¹ng `FROM debian:bookworm-slim` vÃ  copy runtime + app vÃ o, so sÃ¡nh kÃ­ch thÆ°á»›c image vá»›i image dÃ¹ng `temurin:17-jre`.

### LÆ°u Ã½ production, lá»—i phá»• biáº¿n vÃ  cÃ¡ch tá»‘i Æ°u

- Äá»“ng bá»™ JDK: Dev/CI/Prod nÃªn dÃ¹ng cÃ¹ng vendor vÃ  dÃ²ng LTS; cá»‘ Ä‘á»‹nh minor náº¿u muá»‘n tÃ¡i láº­p 100%.
- Chá»n GC phÃ¹ há»£p: G1GC cho háº§u háº¿t backend; ZGC/Shenandoah cho latency cá»±c tháº¥p vÃ  heap lá»›n. Äá»«ng tá»‘i Æ°u sá»›m â€“ Ä‘o Ä‘áº¡c rá»“i má»›i Ä‘á»•i GC.
- KÃ­ch thÆ°á»›c heap: TrÃ¡nh Ä‘áº·t `-Xms` = `-Xmx` quÃ¡ lá»›n trong container nhá» vÃ¬ JVM cÃ³ thá»ƒ bá»‹ OOM nhÃ³m khÃ¡c (native, metaspace, direct buffer). Báº¯t Ä‘áº§u vá»›i 60â€“70% limit.
- GC logging vÃ  metrics: báº­t `-Xlog:gc*` vÃ  Actuator/Prometheus Ä‘á»ƒ cÃ³ sá»‘ liá»‡u thay vÃ¬ phá»ng Ä‘oÃ¡n.
- String dedup vÃ  Compact Strings: Máº·c Ä‘á»‹nh Java dÃ¹ng Compact Strings (Latinâ€‘1). Vá»›i á»©ng dá»¥ng nhiá»u chuá»—i trÃ¹ng, thÃªm `-XX:+UseStringDeduplication` (G1) Ä‘á»ƒ giáº£m heap, Ä‘o p99 vÃ¬ cÃ³ overhead nháº¹.
- Kiá»ƒm soÃ¡t metaspace: RÃ² rá»‰ classloader (plugin, redeploy nhiá»u láº§n) lÃ m metaspace tÄƒng â†’ giá»›i háº¡n `-XX:MaxMetaspaceSize` vÃ  theo dÃµi báº±ng JFR.
- Báº£o máº­t: Cháº¡y tiáº¿n trÃ¬nh báº±ng user khÃ´ng Ä‘áº·c quyá»n; vá»›i `jlink`, bá» mÃ´â€‘Ä‘un khÃ´ng dÃ¹ng; cáº­p nháº­t CPU (Critical Patch Update) Ä‘á»‹nh ká»³.
- Fatâ€‘jar Spring Boot: Náº¿u tháº¥y `ClassNotFoundException` trong fatâ€‘jar, kiá»ƒm tra `spring-boot-maven-plugin` version vÃ  cáº¥u trÃºc jar; trÃ¡nh copy thá»§ cÃ´ng `lib/` khi khÃ´ng hiá»ƒu loader.
- Äo Ä‘áº¡c Ä‘Ãºng: LuÃ´n warmâ€‘up trÆ°á»›c khi benchmark; dÃ¹ng JMH cho microbenchmark. Äá»«ng Ä‘o báº±ng `currentTimeMillis`.

### Káº¿t ná»‘i thá»±c chiáº¿n: Ã¡p dá»¥ng trong eâ€‘commerce, máº¡ng xÃ£ há»™i, chat realtime, microservice

Khi xÃ¢y má»™t ná»n táº£ng eâ€‘commerce, nhÃ³m thÆ°á»ng phÃ¢n chia theo microservices: product, catalog, pricing, order, payment, notification. Táº¥t cáº£ cÃ¹ng má»™t profile JVM/GC chuáº©n hoÃ¡ giÃºp váº­n hÃ nh dá»… dÃ ng. VÃ­ dá»¥ profile chung:

```text
JAVA_OPTS="-XX:+UseG1GC -XX:InitialRAMPercentage=25 -XX:MaxRAMPercentage=70 -Xlog:gc*,safepoint:stdout:time"
"
```

CÃ¡c service realtime nhÆ° notification/websocket nháº¡y cáº£m latency cÃ³ thá»ƒ chuyá»ƒn sang ZGC náº¿u heap > 8â€“16GB vÃ  p99 lÃ  KPI chÃ­nh. Dá»‹ch vá»¥ xá»­ lÃ½ batch (ETL, recommendation offline) Æ°u tiÃªn throughput â€“ Parallel GC Ä‘Ã´i khi váº«n phÃ¹ há»£p, nhÆ°ng hÃ£y Ä‘o thá»±c táº¿.

Vá»›i máº¡ng xÃ£ há»™i, lÆ°á»£ng Ä‘á»‘i tÆ°á»£ng táº¡m thá»i (DTO, JSON) lá»›n, hÃ£y tá»‘i Æ°u pipeline serialization (Jackson + afterburner, `record`), tÃ¡i sá»­ dá»¥ng buffer, háº¡n cháº¿ táº¡o object khÃ´ng cáº§n thiáº¿t (object churn) Ä‘á»ƒ giáº£m Ã¡p lá»±c GC.

### Tá»•ng káº¿t nhanh (dÃ nh cho báº¡n sau khi Ä‘Ã£ Ä‘á»c háº¿t chÆ°Æ¡ng)

Báº¡n Ä‘Ã£ náº¯m: sá»± khÃ¡c nhau JDK/JRE/JVM; chuá»—i build/run; cáº¥u trÃºc bá»™ nhá»› vÃ  cÆ¡ cháº¿ JIT/GC; cÃ¡ch dÃ¹ng classpath vs modulepath; cÃ¡ch táº¡o runtime tá»‘i thiá»ƒu báº±ng jlink; cÃ¡ch Ä‘Ã³ng gÃ³i vÃ  cháº¡y Spring Boot thÃ¢n thiá»‡n container; cÃ¡c cÃ´ng cá»¥ quan sÃ¡t nhÆ° jcmd/jfr; tiÃªu chÃ­ chá»n GC vÃ  tinh chá»‰nh heap; cÅ©ng nhÆ° checklist production chá»‘ng láº¡i cÃ¡c lá»—i phá»• biáº¿n. Tá»« Ä‘Ã¢y, má»i pháº§n tiáº¿p theo (OOP, Collections, Threading, Spring Boot nÃ¢ng caoâ€¦) sáº½ dá»±a trÃªn ná»n táº£ng nÃ y Ä‘á»ƒ báº¡n tá»± tin xÃ¢y, triá»ƒn khai vÃ  tá»‘i Æ°u há»‡ thá»‘ng thá»±c táº¿ quy mÃ´ lá»›n.

### Giá»›i thiá»‡u khÃ¡i niá»‡m

- JVM (Java Virtual Machine): MÃ¡y áº£o thá»±c thi bytecode `.class`. Cung cáº¥p GC, JIT, bá»™ náº¡p lá»›p (class loader), quáº£n lÃ½ bá»™ nhá»› vÃ  cÃ¡c dá»‹ch vá»¥ runtime.
- JRE (Java Runtime Environment): Táº­p há»£p JVM + thÆ° viá»‡n chuáº©n Ä‘á»ƒ cháº¡y á»©ng dá»¥ng Java. Tá»« JDK 11, khÃ´ng cÃ²n phÃ¡t hÃ nh JRE riÃªng phá»• biáº¿n; JDK bao gá»“m Ä‘áº§y Ä‘á»§ mÃ´i trÆ°á»ng runtime Ä‘á»ƒ cháº¡y.
- JDK (Java Development Kit): Bá»™ cÃ´ng cá»¥ phÃ¡t triá»ƒn gá»“m JRE + cÃ´ng cá»¥ dev (`javac`, `jar`, `jlink`, `jpackage`, `javadoc`, `jcmd`, `jfr`, ...).

Khi nÃ o dÃ¹ng cÃ¡i gÃ¬?

- NhÃ  phÃ¡t triá»ƒn: dÃ¹ng JDK Ä‘á»ƒ biÃªn dá»‹ch, test, profile, Ä‘Ã³ng gÃ³i.
- MÃ¡y cháº¡y production: chá»‰ cáº§n runtime. TÃ¹y chiáº¿n lÆ°á»£c, cÃ³ thá»ƒ dÃ¹ng JDK (Ä‘Æ¡n giáº£n) hoáº·c runtime tá»‘i thiá»ƒu táº¡o báº±ng `jlink` (nháº¹ hÆ¡n, báº£o máº­t tá»‘t hÆ¡n).

### Giáº£i thÃ­ch chi tiáº¿t

- Chuá»—i build/run: `.java` --(javac)--> `.class` (bytecode) --(jar)--> `.jar` --(java)--> cháº¡y trÃªn JVM.
- ClassPath vs ModulePath:
  - ClassPath (truyá»n thá»‘ng): JVM tÃ¬m lá»›p theo danh sÃ¡ch thÆ° má»¥c/JAR.
  - ModulePath (Java 9+): CÃ³ mÃ´-Ä‘un hÃ³a, khai bÃ¡o phá»¥ thuá»™c rÃµ rÃ ng (`module-info.java`).
- JIT (Just-In-Time) vÃ  GC:
  - JVM ban Ä‘áº§u thÃ´ng dá»‹ch bytecode, sau Ä‘Ã³ JIT biÃªn dá»‹ch nÃ³ng thÃ nh mÃ£ mÃ¡y tá»‘i Æ°u (C1/C2/Graal JIT).
  - GC tá»± Ä‘á»™ng thu há»“i bá»™ nhá»›; máº·c Ä‘á»‹nh G1GC (Java 17/21) cÃ¢n báº±ng Ä‘á»™ trá»…/throughput.
- PhÃ¢n phá»‘i JDK phá»• biáº¿n: OpenJDK, Eclipse Temurin (Adoptium), Oracle JDK, GraalVM. Chá»n báº£n LTS (17/21) cho production.

SÆ¡ Ä‘á»“ dÃ²ng cháº£y (Ä‘Æ¡n giáº£n):

```
YourCode.java  --javac-->  YourCode.class  --jar-->  app.jar  --java-->  JVM
                                                           |             |
                                                         JRE           OS/CPU
```

### Code vÃ­ dá»¥

VÃ­ dá»¥ 1: Java console in ra thÃ´ng tin JVM (cÃ³ thá»ƒ cháº¡y Ä‘á»™c láº­p)

```java
// File: Main.java
public class Main {
    public static void main(String[] args) {
        System.out.println("Xin chÃ o tá»« JVM!");
        System.out.println("java.version=" + System.getProperty("java.version"));
        System.out.println("java.vendor=" + System.getProperty("java.vendor"));
        System.out.println("java.vm.name=" + System.getProperty("java.vm.name"));
        System.out.println("os.name=" + System.getProperty("os.name"));

        // VÃ­ dá»¥ tÃ­nh toÃ¡n nhá» Ä‘á»ƒ kÃ­ch hoáº¡t JIT má»™t chÃºt
        long sum = 0;
        for (int i = 0; i < 5_000_000; i++) sum += i;
        System.out.println("sum=" + sum);
    }
}
```

Cháº¡y báº±ng CLI:

```bash
javac Main.java            # biÃªn dá»‹ch -> Main.class
java Main                  # cháº¡y class trá»±c tiáº¿p

# ÄÃ³ng gÃ³i thÃ nh JAR cÃ³ Main-Class
jar --create --file app.jar --main-class Main Main.class
java -jar app.jar
```

VÃ­ dá»¥ 2: Thiáº¿t láº­p Maven Ä‘á»ƒ biÃªn dá»‹ch vá»›i báº£n phÃ¡t hÃ nh má»¥c tiÃªu (trÃ¡nh lá»—i lá»‡ch version)

```xml
<!-- pom.xml (tá»‘i thiá»ƒu, mÃ´ táº£ pháº§n compiler) -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.example</groupId>
  <artifactId>jdk-jre-jvm-demo</artifactId>
  <version>1.0.0</version>
  <properties>
    <maven.compiler.release>17</maven.compiler.release>
  </properties>
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.11.0</version>
        <configuration>
          <release>${maven.compiler.release}</release>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-jar-plugin</artifactId>
        <version>3.3.0</version>
        <configuration>
          <archive>
            <manifest>
              <mainClass>Main</mainClass>
            </manifest>
          </archive>
        </configuration>
      </plugin>
    </plugins>
  </build>
</project>
```

Build vÃ  cháº¡y:

```bash
mvn -q -DskipTests package
java -jar target/jdk-jre-jvm-demo-1.0.0.jar
```

VÃ­ dá»¥ 3 (nÃ¢ng cao): Táº¡o runtime tá»‘i thiá»ƒu báº±ng `jlink` cho á»©ng dá»¥ng console

```bash
# PhÃ¡t hiá»‡n mÃ´-Ä‘un cáº§n thiáº¿t (vá»›i app console Ä‘Æ¡n giáº£n thÆ°á»ng chá»‰ cáº§n java.base)
jdeps --print-module-deps --multi-release=17 target/jdk-jre-jvm-demo-1.0.0.jar

# Táº¡o runtime tá»‘i thiá»ƒu (thay com.example báº±ng káº¿t quáº£ tá»« jdeps náº¿u cÃ³)
jlink --no-header-files --no-man-pages \
      --compress=2 \
      --add-modules java.base \
      --output runtime-min

# Cháº¡y á»©ng dá»¥ng báº±ng runtime vá»«a táº¡o
./runtime-min/bin/java -jar target/jdk-jre-jvm-demo-1.0.0.jar
```

### á»¨ng dá»¥ng thá»±c táº¿

- E-commerce: Chá»n JDK LTS (17/21), build Spring Boot JAR (fat/Ã¼berâ€‘jar), deploy báº±ng Docker. DÃ¹ng `--release` Ä‘á»ƒ Ä‘áº£m báº£o tÆ°Æ¡ng thÃ­ch mÃ´i trÆ°á»ng cháº¡y.
- Máº¡ng xÃ£ há»™i: DÃ¹ng cÃ¡c cÃ´ng cá»¥ JDK nhÆ° `jcmd`, `jfr` Ä‘á»ƒ cháº©n Ä‘oÃ¡n CPU/memory khi táº£i tÄƒng cao, phÃ¢n tÃ­ch GC pause.
- Chat realtime: Tá»‘i Æ°u JVM flags cho container, Ä‘áº£m báº£o heap há»£p lÃ½, giÃ¡m sÃ¡t GC Ä‘á»ƒ giá»¯ latency tháº¥p.
- Microservice: DÃ¹ng `jlink` táº¡o runtime tá»‘i thiá»ƒu giáº£m kÃ­ch thÆ°á»›c image, khá»Ÿi Ä‘á»™ng nhanh hÆ¡n; hoáº·c cÃ¢n nháº¯c GraalVM Native Image cho cÃ¡c service siÃªu nháº¹.

### Thá»±c hÃ nh / bÃ i táº­p

1. BiÃªn dá»‹ch & cháº¡y CLI

- Viáº¿t `Main.java` nhÆ° vÃ­ dá»¥, dÃ¹ng `javac`/`java` Ä‘á»ƒ cháº¡y; Ä‘Ã³ng gÃ³i JAR vÃ  cháº¡y báº±ng `java -jar`.

2. Kiá»ƒm soÃ¡t version má»¥c tiÃªu

- BiÃªn dá»‹ch vá»›i `javac --release 17` hoáº·c Maven `maven.compiler.release`. Thá»­ cháº¡y trÃªn JDK 17 vÃ  21 Ä‘á»ƒ quan sÃ¡t tÆ°Æ¡ng thÃ­ch.

3. BÃ i táº­p lá»—i thÆ°á»ng gáº·p

- Cá»‘ tÃ¬nh cháº¡y JAR biÃªn dá»‹ch báº±ng 21 trÃªn JDK 17 Ä‘á»ƒ tháº¥y `UnsupportedClassVersionError`, sau Ä‘Ã³ sá»­a báº±ng `--release`.
- Táº¡o JAR thiáº¿u Main-Class vÃ  sá»­a lá»—i `no main manifest attribute` báº±ng cáº¥u hÃ¬nh `maven-jar-plugin`.

4. `jlink` miniâ€‘project

- DÃ¹ng `jdeps` Ä‘á»ƒ tÃ¬m mÃ´â€‘Ä‘un, táº¡o runtime tá»‘i thiá»ƒu, Ä‘o kÃ­ch thÆ°á»›c trÆ°á»›c/sau (so sÃ¡nh image Docker).

5. Quan sÃ¡t runtime (tuá»³ chá»n)

- Cháº¡y `jcmd <pid> VM.flags`, `jcmd <pid> GC.class_histogram`; thá»­ báº­t JFR: `-XX:StartFlightRecording=duration=60s,filename=app.jfr` vÃ  phÃ¢n tÃ­ch.

### LÆ°u Ã½ khi triá»ƒn khai thá»±c táº¿

- Chá»n LTS, Ä‘á»“ng bá»™ version JDK giá»¯a dev/CI/prod; cá»‘ Ä‘á»‹nh minor khi cáº§n tÃ¡i láº­p build.
- Thiáº¿t láº­p `JAVA_HOME` vÃ  `PATH` nháº¥t quÃ¡n; trong CI dÃ¹ng toolchain hoáº·c container.
- DÃ¹ng `--release` (hoáº·c `maven.compiler.release`) thay vÃ¬ `source/target` rá»i ráº¡c Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh tÆ°Æ¡ng thÃ­ch API/bytecode.
- TrÃªn container:
  - Java 10+ tá»± tÃ´n trá»ng limit cgroup; váº«n nÃªn Ä‘iá»u chá»‰nh: `-XX:InitialRAMPercentage` vÃ  `-XX:MaxRAMPercentage` (vÃ­ dá»¥ 20/75) hoáº·c Ä‘áº·t `-Xms/-Xmx` rÃµ rÃ ng.
  - DÃ¹ng G1GC máº·c Ä‘á»‹nh; cÃ¢n nháº¯c `-XX:+UseStringDeduplication` cho á»©ng dá»¥ng nhiá»u String.
- ÄÃ³ng gÃ³i Spring Boot:
  - Maven: `spring-boot-maven-plugin` táº¡o executable jar. Cháº¡y `java -jar app.jar`.
  - Docker multiâ€‘stage: build trong stage Maven, copy artifact sang image run thá»i gian cháº¡y tá»‘i thiá»ƒu (Temurin JRE hoáº·c runtime `jlink`).
- Báº£o máº­t & giáº£m bá» máº·t táº¥n cÃ´ng: Vá»›i `jlink`, loáº¡i bá» mÃ´â€‘Ä‘un khÃ´ng cáº§n; cháº¡y user khÃ´ng Ä‘áº·c quyá»n trong container.
- Debug sá»± cá»‘ phá»• biáº¿n:
  - `UnsupportedClassVersionError`: lá»‡ch version biÃªn dá»‹ch/cháº¡y â†’ Ä‘á»“ng bá»™ `--release` vÃ  runtime.
  - `ClassNotFoundException`/`NoClassDefFoundError`: sai classpath/jar bá»‹ thiáº¿u â†’ kiá»ƒm tra `-cp`, `jar tf`.
  - `OutOfMemoryError`: thiáº¿u heap/metaspace â†’ tÄƒng `-Xmx`/`-XX:MaxMetaspaceSize`, xem leak báº±ng JFR.

---

<a id="ch3"></a>

## 3. OOP, Collections, I/O & Generics (Beginner)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: thÃ nh tháº¡o OOP, cáº¥u trÃºc dá»¯ liá»‡u Java, Ä‘á»c/ghi file, generic API.
- Kiáº¿n thá»©c ná»n: Java cÆ¡ báº£n (biáº¿n, Ä‘iá»u kiá»‡n, vÃ²ng láº·p).
- LÃ½ do: mÃ´ hÃ¬nh hoÃ¡ domain vÃ  hiá»‡u quáº£ dá»¯ liá»‡u lÃ  ná»n cho má»i dá»‹ch vá»¥.

#### Ná»™i dung chi tiáº¿t

- Encapsulation/Inheritance/Polymorphism; List/Set/Map; NIO.2; Generics (variance, erasure).

#### VÃ­ dá»¥ code thá»±c táº¿

- Lá»›p domain, repo generic inâ€‘memory, I/O CSV, exceptions (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- MÃ´ hÃ¬nh hoÃ¡ Product/Order/User; xá»­ lÃ½ import/export dá»¯ liá»‡u.

#### Tá»‘i Æ°u & best practice

- Chá»n cáº¥u trÃºc phÃ¹ há»£p useâ€‘case; tryâ€‘withâ€‘resources; trÃ¡nh raw types.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: biáº¿t thiáº¿t káº¿ OOP vÃ  dÃ¹ng Collections hiá»‡u quáº£.
- BÃ i táº­p: viáº¿t `Repository<T,ID>` inâ€‘memory vÃ  bÃ¡o cÃ¡o tá»“n kho tá»« CSV.

Má»¥c tiÃªu há»c:

- Náº¯m OOP (encapsulation, inheritance, polymorphism), interface, abstract class.
- Sá»­ dá»¥ng Collections (List, Set, Map), Generics, Exception handling.

Thá»i lÆ°á»£ng: 1 tuáº§n (6â€“8 giá»)

Ná»™i dung chi tiáº¿t (báº£n má»Ÿ rá»™ng):

1. Lá»›p, Ä‘á»‘i tÆ°á»£ng, káº¿ thá»«a, override

- KhÃ¡i niá»‡m:
  - Lá»›p (class) Ä‘á»‹nh nghÄ©a thuá»™c tÃ­nh vÃ  hÃ nh vi; Ä‘á»‘i tÆ°á»£ng (object) lÃ  thá»ƒ hiá»‡n cá»§a lá»›p.
  - Káº¿ thá»«a (inheritance): lá»›p con dÃ¹ng láº¡i, má»Ÿ rá»™ng lá»›p cha. Äa hÃ¬nh (polymorphism): cÃ¹ng interface, hÃ nh vi cá»¥ thá»ƒ khÃ¡c nhau tÃ¹y Ä‘á»‘i tÆ°á»£ng thá»±c.
  - ÄÃ³ng gÃ³i (encapsulation): che giáº¥u dá»¯ liá»‡u qua private/protected, cung cáº¥p getter/setter hoáº·c phÆ°Æ¡ng thá»©c nghiá»‡p vá»¥.
- Code máº«u:

```java
class User {
  private final long id;
  private String email;

  public User(long id, String email) { this.id = id; this.email = email; }
  public long getId() { return id; }
  public String getEmail() { return email; }
  public void changeEmail(String newEmail) { this.email = newEmail; }

  @Override public String toString() { return "User#" + id + " <" + email + ">"; }
}

class PremiumUser extends User {
  private int points = 0;
  public PremiumUser(long id, String email){ super(id, email); }
  public void addPoints(int p){ this.points += p; }
  @Override public String toString(){ return super.toString() + " pts=" + points; }
}

User u = new PremiumUser(1L, "a@ex.com");
System.out.println(u.toString());
```

- Khi nÃ o override? Khi lá»›p con muá»‘n Ä‘iá»u chá»‰nh hÃ nh vi lá»›p cha. Khi nÃ o overloading? CÃ¹ng tÃªn phÆ°Æ¡ng thá»©c nhÆ°ng tham sá»‘ khÃ¡c â€” KHÃC override.
- Pitfalls: LuÃ´n dÃ¹ng `@Override` Ä‘á»ƒ trÃ¡nh sai chá»¯ kÃ½; Æ°u tiÃªn composition hÆ¡n inheritance khi quan há»‡ khÃ´ng tháº­t sá»± â€œlÃ  má»™t/ISâ€‘Aâ€.
- Debug: In `obj.getClass()` Ä‘á»ƒ biáº¿t kiá»ƒu thá»±c thi; viáº¿t `toString()` há»¯u Ã­ch.
- Miniâ€‘lab: Viáº¿t lá»›p `Order` cÃ³ `List<OrderItem>` vÃ  `VipOrder` override cÃ¡ch tÃ­nh giáº£m giÃ¡.

2. Interface vs Abstract class: khi nÃ o dÃ¹ng

- Interface: Ä‘á»‹nh nghÄ©a há»£p Ä‘á»“ng, cÃ³ thá»ƒ cÃ³ `default/static` methods; cho phÃ©p multiple inheritance of type.
- Abstract class: chia sáº» state/hÃ nh vi chung + cho phÃ©p má»™t pháº§n cÃ i Ä‘áº·t; chá»‰ Ä‘Æ¡n káº¿ thá»«a.
- Khi nÃ o dÃ¹ng:
  - Interface khi cáº§n há»£p Ä‘á»“ng á»•n Ä‘á»‹nh vÃ  nhiá»u implementation (vÃ­ dá»¥ adapter nhiá»u nhÃ  cung cáº¥p).
  - Abstract class khi cÃ³ logic dÃ¹ng chung cáº§n tÃ¡i sá»­ dá»¥ng giá»¯a cÃ¡c lá»›p con.
- Code máº«u:

```java
interface PaymentGateway { boolean charge(long userId, int amountCents); }

abstract class BasePaymentGateway implements PaymentGateway {
  protected boolean fraudCheck(long userId){ return true; }
}

class StripeGateway extends BasePaymentGateway {
  @Override public boolean charge(long userId, int amountCents) {
    if(!fraudCheck(userId)) return false;
    return amountCents < 1_000_000;
  }
}
```

- Pitfalls: Äá»«ng nhÃ©t quÃ¡ nhiá»u vÃ o abstract base class; báº¯t Ä‘áº§u báº±ng interface, thÃªm abstract class khi tháº­t sá»± cáº§n.
- Miniâ€‘lab: Thiáº¿t káº¿ `NotificationChannel` (interface) vá»›i 2 implementation: Email/SMS. ThÃªm `AbstractNotification` chia sáº» template â€œHello, {name}â€.

3. Collections framework vÃ  Bigâ€‘O cÆ¡ báº£n

- Tá»•ng quan:
  - List: ArrayList (O(1) truy cáº­p, chÃ¨n cuá»‘i amortized O(1)), LinkedList (chÃ¨n/xÃ³a giá»¯a O(1) náº¿u cÃ³ node).
  - Set: HashSet (TB O(1)), LinkedHashSet (duy trÃ¬ thá»© tá»± chÃ¨n), TreeSet (O(log n), cÃ³ sáº¯p xáº¿p).
  - Map: HashMap (TB O(1)), LinkedHashMap (thá»© tá»±/LRU), TreeMap (O(log n)).
- Code máº«u:

```java
List<String> names = List.of("An","BÃ¬nh","An");
Set<String> unique = new HashSet<>(names);
Map<String, Long> freq = names.stream().collect(Collectors.groupingBy(s -> s, Collectors.counting()));

Map<String, Integer> lru = new LinkedHashMap<>(16, 0.75f, true);
lru.put("A",1); lru.put("B",2); lru.get("A"); // A thÃ nh má»›i nháº¥t
```

- Concurrency: `ConcurrentHashMap` cho Ä‘a luá»“ng; trÃ¡nh mutate key sau khi put.
- Pitfalls: DÃ¹ng `ArrayList` cho xÃ³a Ä‘áº§u liÃªn tá»¥c (O(n)) â†’ cÃ¢n nháº¯c `Deque`.
- Miniâ€‘lab: TÃ­nh tá»•ng giÃ¡ theo danh má»¥c (Map<String, BigDecimal>) vÃ  in Topâ€‘N danh má»¥c theo tá»•ng.

4. Generics: typeâ€‘safety, `List<T>`

- Má»¥c tiÃªu: báº¯t lá»—i táº¡i compileâ€‘time, khÃ´ng Ã©p kiá»ƒu runtime.
- KhÃ¡i niá»‡m: lá»›p/phÆ°Æ¡ng thá»©c tá»•ng quÃ¡t, bounded type, wildcards theo quy táº¯c PECS (Producer Extends, Consumer Super).

```java
class Pair<L,R> { final L left; final R right; Pair(L l, R r){ left=l; right=r; } }

static <T> void copy(List<? extends T> src, List<? super T> dst){ for (T x : src) dst.add(x); }

List<Integer> a = List.of(1,2,3);
List<Number> b = new ArrayList<>();
copy(a, b); // OK: Producer extends, Consumer super
```

- Type erasure: khÃ´ng `new T()`, khÃ´ng `List<int>` mÃ  `List<Integer>`.
- Pitfalls: TrÃ¡nh raw type (`List` thay vÃ¬ `List<T>`); thiáº¿t káº¿ API generic rÃµ rÃ ng.
- Miniâ€‘lab: Viáº¿t `Repository<T, ID>` inâ€‘memory (`save/findById/findAll`).

5. I/O: Ä‘á»c/ghi file vá»›i NIO.2

- KhÃ¡i niá»‡m: `Path`, `Files`, tryâ€‘withâ€‘resources Ä‘áº£m báº£o Ä‘Ã³ng tÃ i nguyÃªn.

```java
Path p = Path.of("products.csv");
try (Stream<String> lines = Files.lines(p, StandardCharsets.UTF_8)) {
  lines.map(l -> l.split(","))
       .map(a -> new Product(a[0], new BigDecimal(a[1])))
       .forEach(System.out::println);
}

List<String> out = List.of("id,name,price", "1,Book,10.5");
Files.write(Path.of("out.csv"), out, StandardCharsets.UTF_8,
            StandardOpenOption.CREATE, StandardOpenOption.TRUNCATE_EXISTING);

Files.walk(Path.of("data")).filter(Files::isRegularFile).forEach(System.out::println);
```

- Pitfalls: Set Ä‘Ãºng Charset; trÃ¡nh leak báº±ng tryâ€‘withâ€‘resources.
- Miniâ€‘lab: TÃ­nh â€œgiÃ¡ trá»‹ tá»“n khoâ€ = sum(qty\*price) tá»« CSV, ghi bÃ¡o cÃ¡o.

6. Exception: checked vs unchecked, tryâ€‘withâ€‘resources

- PhÃ¢n loáº¡i: Checked (phá»¥c há»“i Ä‘Æ°á»£c) vs Unchecked (lá»—i láº­p trÃ¬nh/logic).
- Thá»±c hÃ nh tá»‘t: chá»‰ catch khi xá»­ lÃ½ Ä‘Æ°á»£c; propagate vá»›i ngá»¯ cáº£nh.

```java
class NotFoundException extends RuntimeException { public NotFoundException(String msg){ super(msg); } }
Product findProduct(Long id){ return repo.findById(id).orElseThrow(() -> new NotFoundException("Product "+id+" not found")); }

try (var in = Files.newBufferedReader(Path.of("in.txt")); var out = Files.newBufferedWriter(Path.of("out.txt"))) {
  out.write(in.readLine());
} catch (IOException e) {
  throw new UncheckedIOException("I/O error while copying", e);
}
```

- Pitfalls: Nuá»‘t lá»—i (catch rá»—ng), log spam, báº¯t Exception tá»•ng quÃ¡t á»Ÿ quÃ¡ cao.
- Miniâ€‘lab: Táº¡o `ValidationException`; khi CSV thiáº¿u cá»™t, throw vÃ  log dÃ²ng + sá»‘ thá»© tá»±.

Miniâ€‘Project cuá»‘i chÆ°Æ¡ng (Ä‘á» xuáº¥t)

- â€œKho dá»¯ liá»‡u sáº£n pháº©m miniâ€:
  - Äá»c CSV -> map `Product`, lÆ°u vÃ o `Repository<Product, Long>` generic inâ€‘memory.
  - API console: tÃ¬m theo tÃªn (contains, ignore-case), thá»‘ng kÃª giÃ¡ trá»‹ tá»“n kho theo danh má»¥c, xuáº¥t bÃ¡o cÃ¡o CSV.
  - NÃ¢ng cao: thÃªm `PriceRule` (interface) vá»›i nhiá»u implementation Ä‘á»ƒ Ã¡p dá»¥ng khuyáº¿n mÃ£i theo Ä‘a hÃ¬nh.

TÃ³m táº¯t & Key Takeaways:

- Hiá»ƒu báº£n cháº¥t káº¿ thá»«a/Ä‘a hÃ¬nh vÃ  khi nÃ o dÃ¹ng interface vs abstract class.
- Náº¯m Ä‘áº·c tÃ­nh hiá»‡u nÄƒng cá»§a List/Set/Map vÃ  chá»n cáº¥u trÃºc dá»¯ liá»‡u Ä‘Ãºng.
- Xá»­ lÃ½ ngoáº¡i lá»‡ há»£p lÃ½, khÃ´ng nuá»‘t lá»—i; dÃ¹ng try-with-resources cho I/O.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t hÃ m generic `max(List<T> list, Comparator<T>)` vÃ  test.
- PhÃ¢n tÃ­ch Ä‘á»™ phá»©c táº¡p thao tÃ¡c thÃªm/tÃ¬m kiáº¿m vá»›i `ArrayList` vs `LinkedList`.
- Thiáº¿t káº¿ interface `Cache<K,V>` vÃ  má»™t impl LRU Ä‘Æ¡n giáº£n.

---

<a id="ch4"></a>

## 4. Build tools (Maven/Gradle), Packaging & Testing cÆ¡ báº£n (Beginner)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: quáº£n lÃ½ phá»¥ thuá»™c, profile, Ä‘Ã³ng gÃ³i, test cÆ¡ báº£n.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 2â€“3.
- LÃ½ do: Ä‘áº£m báº£o build reproducible vÃ  cÃ³ kiá»ƒm thá»­ sá»›m.

#### Ná»™i dung chi tiáº¿t

- `pom.xml`/`build.gradle`, BOM; profiles; JUnit 5, Mockito, MVC slice.

#### VÃ­ dá»¥ code thá»±c táº¿

- Test `OrderService` vÃ  `@WebMvcTest` (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Thiáº¿t láº­p profile dev/test/prod; thÃªm test smoke cho API chÃ­nh.

#### Tá»‘i Æ°u & best practice

- KhoÃ¡ version qua BOM; cáº¥u hÃ¬nh CI cháº¡y test vÃ  build artifact.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: build/test cÆ¡ báº£n Ä‘Ã£ hoÃ n thiá»‡n.
- BÃ i táº­p: thÃªm test cho `/hello` vÃ  profile `dev`.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Gradle Version Catalogs)

```toml
# gradle/libs.versions.toml
[versions]
spring-boot = "3.3.2"

[libraries]
spring-boot-starter-web = { module = "org.springframework.boot:spring-boot-starter-web", version.ref = "spring-boot" }
```

```kotlin
// build.gradle.kts
dependencies {
  implementation(libs.spring.boot.starter.web)
}
```

Má»¥c tiÃªu há»c:

- Quáº£n lÃ½ phá»¥ thuá»™c, profile, build JAR/Docker, test cÆ¡ báº£n vá»›i JUnit.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- `pom.xml`/`build.gradle`: dependency, plugin.
- Profiles (dev/test/prod) vÃ  `application-*.yml`.
- JUnit 5 vÃ  Mockito cÄƒn báº£n.

VÃ­ dá»¥ test Ä‘Æ¡n giáº£n:

```java
class OrderServiceTest {
  @Test void checkout_ok_when_amount_small() {
    PaymentGateway gw = (u, a) -> true;
    var service = new OrderService(gw);
    assertTrue(service.checkout(1L, List.of(10, 20)));
  }
}
```

BÃ i táº­p: Viáº¿t test cho controller `/hello` báº±ng `@WebMvcTest`.

LÆ°u Ã½ production: KhÃ³a phiÃªn báº£n phá»¥ thuá»™c; dÃ¹ng BOM cá»§a Spring.

TÃ³m táº¯t & Key Takeaways:

- Hiá»ƒu cáº¥u trÃºc `pom.xml`/`build.gradle` vÃ  chá»‘t version qua BOM.
- Biáº¿t táº¡o profile cáº¥u hÃ¬nh tÃ¡ch biá»‡t theo mÃ´i trÆ°á»ng.
- Viáº¿t Ä‘Æ°á»£c test JUnit 5 cÆ¡ báº£n vÃ  test MVC slice (`@WebMvcTest`).

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t lá»‡nh Maven Ä‘á»ƒ cháº¡y test Ä‘Æ¡n láº»? Gá»£i Ã½: `-Dtest=ClassName#method`.
- CÃ¡ch kÃ­ch hoáº¡t profile `dev` khi cháº¡y local? Gá»£i Ã½: `--spring.profiles.active=dev`.
- KhÃ¡c nhau giá»¯a `compileOnly` vÃ  `implementation` (Gradle)? Gá»£i Ã½: áº£nh hÆ°á»Ÿng classpath runtime.

---

<a id="ch5"></a>

## 5. Spring Boot Fundamentals (Intermediate)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: hiá»ƒu autoâ€‘configuration, DI, configuration properties, profiles, Actuator.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 2â€“4.
- LÃ½ do: lÃ m chá»§ khung á»©ng dá»¥ng vÃ  vÃ²ng Ä‘á»i bean.

#### Ná»™i dung chi tiáº¿t

- Component scan; `@Bean` vs `@Component`; properties binding; actuator endpoints.

#### VÃ­ dá»¥ code thá»±c táº¿

- `GreetingService`, `@ConfigurationProperties`, `/actuator/health` (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Cáº¥u hÃ¬nh dá»‹ch vá»¥ thanh toÃ¡n/váº­n chuyá»ƒn qua properties; expose health/metrics.

#### Tá»‘i Æ°u & best practice

- Ghi Ä‘Ã¨ cáº¥u hÃ¬nh Ä‘Ãºng chá»—; kiá»ƒm soÃ¡t phÆ¡i lá»™ Actuator; dÃ¹ng constructor injection.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: hiá»ƒu cÃ¡ch Spring Boot tá»± cáº¥u hÃ¬nh vÃ  ghi Ä‘Ã¨.
- BÃ i táº­p: táº¡o `PayProps` (timeout/retries) vÃ  Ã¡p dá»¥ng trong service.

Má»¥c tiÃªu há»c:

- Hiá»ƒu auto-configuration, `@Configuration`, `@Bean`, lifecycle, profiles.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- Component scan, `@Component`, `@Service`, `@Repository`.
- Configuration properties, `application.yml`.
- Actuator cÆ¡ báº£n.

Giáº£i thÃ­ch chi tiáº¿t:

- Auto-configuration: Spring Boot báº­t cáº¥u hÃ¬nh máº·c Ä‘á»‹nh dá»±a trÃªn starter cÃ³ máº·t trÃªn classpath (vÃ­ dá»¥: `spring-boot-starter-web` cáº¥u hÃ¬nh MVC + Tomcat). CÃ³ thá»ƒ ghi Ä‘Ã¨ báº±ng `@Bean` hoáº·c báº±ng properties trong `application.yml`.
- Dependency Injection (DI): Spring táº¡o vÃ  quáº£n lÃ½ bean, inject qua constructor giÃºp báº¥t biáº¿n vÃ  dá»… test.

```java
@Service
class GreetingService { String hi(String name){ return "Xin chÃ o, "+name; } }

@RestController
class Api {
  private final GreetingService svc;
  Api(GreetingService svc){ this.svc = svc; }
  @GetMapping("/hi/{name}") Map<String,String> hi(@PathVariable String name){ return Map.of("msg", svc.hi(name)); }
}
```

- Configuration Properties: bind cáº¥u hÃ¬nh sang class type-safe.

```yaml
app:
  payment:
    timeoutMs: 2000
    retries: 3
```

```java
@ConfigurationProperties(prefix="app.payment")
record PayProps(int timeoutMs, int retries) {}
@Configuration @EnableConfigurationProperties(PayProps.class)
class PayCfg {}
```

- Profiles: `application-dev.yml`, báº­t báº±ng `--spring.profiles.active=dev` Ä‘á»ƒ tÃ¡ch config theo mÃ´i trÆ°á»ng.
- Actuator: cung cáº¥p `/actuator/health`, `/info`, `/metrics`. Má»Ÿ thÃªm endpoint báº±ng `management.endpoints.web.exposure.include`.

VÃ­ dá»¥ cáº¥u hÃ¬nh properties:

```yaml
# src/main/resources/application.yml
app:
  greeting: "Xin chÃ o"
```

```java
@ConfigurationProperties(prefix = "app")
record AppProps(String greeting) {}

@RestController
class GreetingController {
  private final AppProps props;
  GreetingController(AppProps props) { this.props = props; }
  @GetMapping("/greet/{name}") Map<String,String> greet(@PathVariable String name){
    return Map.of("msg", props.greeting()+", "+name);
  }
}
```

BÃ i táº­p: Táº¡o `@ConfigurationProperties` cho thÃ´ng sá»‘ thanh toÃ¡n (timeout, retries).

LÆ°u Ã½ production: Báº­t Actuator `/health`, `/info`; áº©n endpoint nháº¡y cáº£m.

TÃ³m táº¯t & Key Takeaways:

- Náº¯m cÆ¡ cháº¿ auto-configuration vÃ  cÃ¡ch ghi Ä‘Ã¨ báº±ng `@Bean`/properties.
- Biáº¿t bind cáº¥u hÃ¬nh vá»›i `@ConfigurationProperties` an toÃ n vÃ  testable.
- LÃ m chá»§ Actuator cÆ¡ báº£n vÃ  kiá»ƒm soÃ¡t phÆ¡i lá»™ endpoint.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- CÃ¡ch báº­t exposure Actuator `prometheus`? Gá»£i Ã½: `management.endpoints.web.exposure.include`.
- KhÃ¡c nhau giá»¯a `@Component` vÃ  `@Configuration`? Gá»£i Ã½: proxy CGLIB, bean factory method.
- VÃ¬ sao nÃªn Ä‘áº·t cáº¥u hÃ¬nh trong `application.yml` thay vÃ¬ hard-code?

---

<a id="ch6"></a>

## 6. JPA/Hibernate & Giao dá»‹ch (Intermediate)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: mapping entity, repository, JPQL, transaction, migration.
- Kiáº¿n thá»©c ná»n: SQL cÆ¡ báº£n, chÆ°Æ¡ng 5.
- LÃ½ do: bá»n vá»¯ng dá»¯ liá»‡u vÃ  toÃ n váº¹n giao dá»‹ch.

#### Ná»™i dung chi tiáº¿t

- Entity/Relational mapping, `@OneToMany`, lazy/eager; `@Transactional`; Flyway/Liquibase.

#### VÃ­ dá»¥ code thá»±c táº¿

- Entity `Product`, repository, service transactional, migration script (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- LÆ°u trá»¯ Ä‘Æ¡n hÃ ng, tá»“n kho, thanh toÃ¡n; chiáº¿n lÆ°á»£c fetch vÃ  index.

#### Tá»‘i Æ°u & best practice

- TrÃ¡nh N+1; dÃ¹ng DTO projection; tá»‘i Æ°u query/index; giá»›i háº¡n transaction scope.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: CRUD bá»n vá»¯ng, giao dá»‹ch an toÃ n.
- BÃ i táº­p: thÃªm `Order` + `OrderItem` vÃ  test transactional.

Má»¥c tiÃªu há»c:

- Mapping entity, repository, JPQL/Criteria, transaction, migrations.

Thá»i lÆ°á»£ng: 1â€“2 tuáº§n

Ná»™i dung:

- Entity cÆ¡ báº£n, quan há»‡ OneToMany/ManyToOne/ManyToMany.
- Spring Data JPA: `CrudRepository`, query method, `@Query`.
- Transaction: `@Transactional`, isolation, propagation.
- Flyway/Liquibase migration.

Giáº£i thÃ­ch chi tiáº¿t:

- Entity & PK: Má»—i entity cáº§n khÃ³a chÃ­nh (`@Id`). Táº¡o id tá»± Ä‘á»™ng: `@GeneratedValue(strategy=AUTO/IDENTITY/SEQUENCE)` tÃ¹y DB.
- Quan há»‡:
  - `@ManyToOne` máº·c Ä‘á»‹nh `FetchType.EAGER`, nÃªn chuyá»ƒn `LAZY` Ä‘á»ƒ trÃ¡nh N+1 khi khÃ´ng cáº§n.
  - `@OneToMany(mappedBy="order", cascade=CascadeType.ALL)` biá»ƒu diá»…n danh sÃ¡ch con. TrÃ¡nh `EAGER` cho táº­p lá»›n.
  - `@ManyToMany` Ã­t dÃ¹ng cho báº£ng lá»›n, cÃ¢n nháº¯c báº£ng trung gian (2 Ã— OneToMany) Ä‘á»ƒ kiá»ƒm soÃ¡t tá»‘t hÆ¡n.
- Cascade: `PERSIST`, `MERGE`, `REMOVE`, `REFRESH`, `DETACH`. Chá»‰ báº­t khi muá»‘n lan hÃ nh vi rÃµ rÃ ng (vÃ­ dá»¥ Order -> OrderItem).
- Transaction: `@Transactional` Ã¡p dá»¥ng á»Ÿ service. Vá»›i Ä‘á»c, dÃ¹ng `readOnly=true` Ä‘á»ƒ Hibernate tá»‘i Æ°u. Isolation `READ_COMMITTED` thÆ°á»ng Ä‘á»§ cho OLTP; náº¿u cáº§n nháº¥t quÃ¡n cao, cÃ¢n nháº¯c `REPEATABLE_READ`/`SERIALIZABLE` (Ä‘á»•i láº¡i lock/hiá»‡u nÄƒng).
- Truy váº¥n:

```java
@Query("select p from Product p where p.price >= :min order by p.price desc")
List<Product> findExpensive(@Param("min") BigDecimal min);
```

- Tá»‘i Æ°u N+1: DÃ¹ng `join fetch` hoáº·c `@EntityGraph` khi biáº¿t cháº¯c cáº§n dá»¯ liá»‡u liÃªn quan.

VÃ­ dá»¥ code (PostgreSQL):

```xml
<!-- pom.xml -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
  <groupId>org.postgresql</groupId>
  <artifactId>postgresql</artifactId>
  <scope>runtime</scope>
</dependency>
```

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/shop
    username: shop
    password: shop
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
```

```java
@Entity
class Product {
  @Id @GeneratedValue Long id;
  String name;
  BigDecimal price;
}

interface ProductRepo extends JpaRepository<Product, Long> {
  List<Product> findByNameContainingIgnoreCase(String q);
}

@Service
class ProductService {
  private final ProductRepo repo;
  ProductService(ProductRepo repo){this.repo=repo;}
  @Transactional(readOnly=true)
  List<Product> search(String q){ return repo.findByNameContainingIgnoreCase(q); }
}

@RestController
@RequestMapping("/api/products")
class ProductController {
  private final ProductService svc;
  ProductController(ProductService svc){this.svc=svc;}
  @GetMapping public List<Product> all(@RequestParam(required=false) String q){
    return (q==null||q.isBlank())? svc.search("") : svc.search(q);
  }
}
```

BÃ i táº­p: Thiáº¿t káº¿ entity `Order`, `OrderItem` vÃ  viáº¿t service tÃ­nh tá»•ng tiá»n cÃ³ transaction.

LÆ°u Ã½ production: DÃ¹ng migration (Flyway) Ä‘á»ƒ quáº£n lÃ½ schema; chÃº Ã½ N+1 query, dÃ¹ng `fetch join`/`EntityGraph`.

NÃ¢ng cao (JPA/Hibernate):

- KhÃ³a láº¡c quan: dÃ¹ng `@Version` Ä‘á»ƒ trÃ¡nh ghi Ä‘Ã¨ cáº¡nh tranh.

```java
@Entity class Inventory { @Id Long productId; int stock; @Version long v; }
```

- `@EntityGraph` hoáº·c `join fetch` Ä‘á»ƒ trÃ¡nh N+1:

```java
@EntityGraph(attributePaths = {"items"})
Optional<Order> findById(Long id);
```

- Isolation transaction vÃ  read phenomena: READ_COMMITTED vs REPEATABLE_READ.
- Flyway migration vÃ­ dá»¥: `src/main/resources/db/migration/V1__init.sql`

```sql
create table product(id bigserial primary key, name varchar(200) not null, price numeric not null);
create index idx_product_name on product using gin (to_tsvector('simple', name));
```

### 6A. PostgreSQL & MySQL cÆ¡ báº£n (migrations, CRUD, index)

- Dependencies (Maven):

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
  <groupId>org.flywaydb</groupId>
  <artifactId>flyway-core</artifactId>
</dependency>
<dependency>
  <groupId>org.postgresql</groupId>
  <artifactId>postgresql</artifactId>
  <scope>runtime</scope>
</dependency>
<dependency>
  <groupId>com.mysql</groupId>
  <artifactId>mysql-connector-j</artifactId>
  <scope>runtime</scope>
</dependency>
```

- Entity + Repository vá»›i chá»‰ má»¥c:

```java
@Entity @Table(name="products", indexes=@Index(name="idx_products_name", columnList="name"))
class Product { @Id @GeneratedValue Long id; String name; BigDecimal price; }

interface ProductRepo extends JpaRepository<Product, Long> {
  @Query("select p from Product p where lower(p.name) like lower(concat('%', :q, '%'))")
  List<Product> search(@Param("q") String q);
}
```

- Flyway: `V1__init.sql` (Postgres) vÃ  lÆ°u Ã½ MySQL (ENGINE/InnoDB, collation UTF8MB4).

```sql
-- Postgres
create table products(id bigserial primary key, name varchar(200) not null, price numeric not null);
create index idx_products_name on products using gin (to_tsvector('simple', name));
-- MySQL
create table products(
  id bigint primary key auto_increment,
  name varchar(200) not null,
  price decimal(19,2) not null
) engine=InnoDB default charset=utf8mb4 collate=utf8mb4_0900_ai_ci;
create index idx_products_name on products(name);
```

- EXPLAIN cÆ¡ báº£n: `EXPLAIN ANALYZE` (Postgres) vÃ  `EXPLAIN FORMAT=JSON` (MySQL) Ä‘á»ƒ kiá»ƒm tra index Ä‘Æ°á»£c hit.

### 6B. JPA nÃ¢ng cao & tá»‘i Æ°u truy váº¥n

- Pessimistic Lock khi cáº­p nháº­t tá»“n kho:

```java
@Transactional
public void reserveStock(Long productId, int qty){
  var p = repo.findById(productId, LockModeType.PESSIMISTIC_WRITE).orElseThrow();
  // ... cáº­p nháº­t tá»“n kho
}
```

- Batch insert/update: cáº¥u hÃ¬nh `hibernate.jdbc.batch_size=50`, dÃ¹ng `saveAll` theo lÃ´ vÃ  flush/clear Ä‘á»‹nh ká»³.
- Projection/DTO: dÃ¹ng interfaceâ€‘based projection Ä‘á»ƒ trÃ¡nh load cá»™t khÃ´ng cáº§n.
- JSON: MySQL `json_extract`, Postgres `jsonb_path_query_first` khi cáº§n lÆ°u metadata.
- Readâ€‘replica: tÃ¡ch DataSource (read/write) vÃ  route theo annotation á»Ÿ service (tham kháº£o Spring RoutingDataSource).

Checkpoint DB (6A/6B):

- Thá»±c hiá»‡n EXPLAIN cho `search(q)` vÃ  chá»©ng minh index hoáº¡t Ä‘á»™ng.
- Viáº¿t migration thÃªm chá»‰ má»¥c tá»•ng há»£p vÃ  Ä‘o cáº£i thiá»‡n truy váº¥n.
- Thiáº¿t káº¿ chiáº¿n lÆ°á»£c lock phÃ¹ há»£p khi 2 ngÆ°á»i mua cÃ¹ng sáº£n pháº©m cuá»‘i.

TÃ³m táº¯t & Key Takeaways:

- Hiá»ƒu mapping quan há»‡ vÃ  ká»¹ thuáº­t trÃ¡nh N+1; kiá»ƒm soÃ¡t transaction.
- Ãp dá»¥ng migration Ä‘á»ƒ version hÃ³a schema.
- Sá»­ dá»¥ng optimistic locking Ä‘á»ƒ báº£o vá»‡ cáº­p nháº­t Ä‘á»“ng thá»i.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Khi nÃ o dÃ¹ng `@Transactional(readOnly=true)`? áº¢nh hÆ°á»Ÿng Ä‘áº¿n Hibernate nhÆ° tháº¿ nÃ o?
- KhÃ¡c nhau giá»¯a `merge` vÃ  `save` trong JPA? TÃ¬nh huá»‘ng sá»­ dá»¥ng?
- Viáº¿t JPQL Ä‘á»ƒ tÃ¬m sáº£n pháº©m giÃ¡ > X vÃ  tÃªn chá»©a Y.

---

<a id="ch7"></a>

## 7. REST API, Validation, Error Handling (Intermediate)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: thiáº¿t káº¿ RESTful, validate dá»¯ liá»‡u, chuáº©n hoÃ¡ lá»—i.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 5â€“6.
- LÃ½ do: API á»•n Ä‘á»‹nh cho frontends vÃ  dá»‹ch vá»¥ khÃ¡c.

#### Ná»™i dung chi tiáº¿t

- Resource design, status code, pagination; Hibernate Validator; `@ControllerAdvice`.

#### VÃ­ dá»¥ code thá»±c táº¿

- DTO `CreateProduct`, `@Valid`, `GlobalExceptionHandler` (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- API sáº£n pháº©m/Ä‘Æ¡n hÃ ng vá»›i filter/sort; error model chuáº©n cho clients.

#### Tá»‘i Æ°u & best practice

- Idempotency cho POST; tiÃªu chuáº©n hoÃ¡ error codes; tÃ i liá»‡u hoÃ¡ vá»›i OpenAPI.

#### Bá»• sung hiá»‡n Ä‘áº¡i (OpenAPI)

```xml
<dependency>
  <groupId>org.springdoc</groupId>
  <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
  <version>2.5.0</version>
</dependency>
```

Truy cáº­p Swagger UI táº¡i `/swagger-ui.html`; cáº¥u hÃ¬nh `servers`/security schemes cho JWT.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Problem Details - RFC7807)

```java
@RestControllerAdvice
class ProblemHandler {
  @ExceptionHandler(EntityNotFoundException.class)
  ResponseEntity<ProblemDetail> notFound(EntityNotFoundException e, HttpServletRequest req){
    var pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND);
    pd.setTitle("Entity not found");
    pd.setDetail(e.getMessage());
    pd.setProperty("instance", req.getRequestURI());
    return ResponseEntity.status(HttpStatus.NOT_FOUND).body(pd);
  }
}
```

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: API nháº¥t quÃ¡n vÃ  dá»… tiÃªu thá»¥.
- BÃ i táº­p: thÃªm phÃ¢n trang/sort vÃ  test lá»—i validation.

Má»¥c tiÃªu há»c:

- Thiáº¿t káº¿ API chuáº©n, versioning, DTO mapping, validation.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- DTO vs Entity, MapStruct/record DTO.
- Validation: `@Valid`, `@NotBlank`, `@Email`, custom validator.
- Error handling: `@ControllerAdvice` + `@ExceptionHandler`.
- API versioning: URI `/v1`, header, hoáº·c content-negotiation.

Giáº£i thÃ­ch chi tiáº¿t:

- Thiáº¿t káº¿ tÃ i nguyÃªn: má»—i tÃ i nguyÃªn cÃ³ URL á»•n Ä‘á»‹nh (`/api/v1/products/{id}`), dÃ¹ng danh tá»« sá»‘ nhiá»u; thao tÃ¡c qua HTTP verbs (GET/POST/PUT/PATCH/DELETE). Tráº£ status code phÃ¹ há»£p (201 khi táº¡o, 404 khi khÃ´ng tÃ¬m tháº¥y, 400 khi dá»¯ liá»‡u sai).
- DTO vs Entity: KhÃ´ng expose entity trá»±c tiáº¿p Ä‘á»ƒ trÃ¡nh rÃ² rá»‰ field vÃ  coupling JPA. DÃ¹ng DTO records hoáº·c MapStruct Ä‘á»ƒ map.

```java
record ProductDto(Long id, String name, BigDecimal price){}
@GetMapping("/api/v1/products/{id}")
ResponseEntity<ProductDto> get(@PathVariable Long id){
  var p = repo.findById(id).orElseThrow(() -> new ResponseStatusException(HttpStatus.NOT_FOUND));
  return ResponseEntity.ok(new ProductDto(p.id, p.name, p.price));
}
```

- Validation: báº­t `spring-boot-starter-validation`, annotate DTO vÃ  dÃ¹ng `@Valid` trÃªn controller; viáº¿t validator custom khi cáº§n logic Ä‘áº·c thÃ¹.
- Error handling: centralize vá»›i `@ControllerAdvice`, tráº£ Problem JSON (RFC7807) Ä‘á»ƒ chuáº©n hÃ³a lá»—i.
- Versioning: Æ°u tiÃªn prefix `/v1`. Khi breaking, giá»¯ `/v1` cháº¡y song song `/v2` má»™t thá»i gian chuyá»ƒn tiáº¿p.

VÃ­ dá»¥:

```java
record CreateProductReq(@NotBlank String name, @NotNull BigDecimal price) {}
record ErrorRes(String code, String message, Instant timestamp) {}

@RestControllerAdvice
class ApiExceptionHandler {
  @ExceptionHandler(MethodArgumentNotValidException.class)
  ResponseEntity<ErrorRes> invalid(MethodArgumentNotValidException ex){
    String msg = ex.getBindingResult().getAllErrors().get(0).getDefaultMessage();
    return ResponseEntity.badRequest().body(new ErrorRes("VALIDATION_ERROR", msg, Instant.now()));
  }
}

@PostMapping("/api/products")
public Product create(@Valid @RequestBody CreateProductReq req){
  var p = new Product(); p.name=req.name(); p.price=req.price();
  return repo.save(p);
}
```

BÃ i táº­p: Thiáº¿t káº¿ API `POST /api/orders` vá»›i validation vÃ  tráº£ lá»—i thÃ¢n thiá»‡n.

LÆ°u Ã½ production: Chuáº©n hÃ³a lá»—i; báº­t CORS cÃ³ kiá»ƒm soÃ¡t nguá»“n; rate limiting á»Ÿ gateway.

NÃ¢ng cao (REST chuáº©n hÃ³a):

- Chuáº©n lá»—i Problem Details (RFC7807):

```json
{
  "type": "https://api.example.com/errors/validation",
  "title": "Validation failed",
  "status": 400,
  "detail": "price must be positive",
  "instance": "/api/products"
}
```

- MapStruct mapping DTOâ†”Entity:

```java
@Mapper(componentModel = "spring") interface ProductMapper {
  Product toEntity(CreateProductReq req);
  ProductDto toDto(Product p);
}
```

- Versioning: Æ°u tiÃªn `/v1`, vÃ  tÃ¡ch module cho `v2` khi breaking.
- Idempotency cho `POST` nháº¡y cáº£m (Ä‘Æ¡n hÃ ng) báº±ng header `Idempotency-Key` + store táº¡m.

TÃ³m táº¯t & Key Takeaways:

- Thiáº¿t káº¿ API cÃ³ DTO, validation vÃ  xá»­ lÃ½ lá»—i chuáº©n hÃ³a.
- TÆ° duy idempotency á»Ÿ endpoint táº¡o má»›i; quáº£n lÃ½ version.
- Cáº¥u hÃ¬nh CORS há»£p lá»‡ theo mÃ´i trÆ°á»ng.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t `@ControllerAdvice` Ä‘á»ƒ tráº£ Problem JSON cho `EntityNotFoundException`.
- Thiáº¿t káº¿ DTO `UpdateProductReq` vÃ  mapping vá»›i MapStruct.
- Táº¡o `curl` minh há»a lá»—i validation vÃ  quan sÃ¡t cáº¥u trÃºc tráº£ vá».

---

<a id="ch8"></a>

## 8. Spring Security + JWT (Intermediate)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: xÃ¡c thá»±c/á»§y quyá»n, JWT stateless.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 5â€“7.
- LÃ½ do: báº£o vá»‡ tÃ i nguyÃªn, giáº£m rá»§i ro báº£o máº­t phá»• biáº¿n.

#### Ná»™i dung chi tiáº¿t

- Filter chain, `SecurityFilterChain`, password encoder, JWT bearer, method security.

#### VÃ­ dá»¥ code thá»±c táº¿

- Login phÃ¡t hÃ nh JWT, `@PreAuthorize` (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Role/permission cho sáº£n pháº©m/Ä‘Æ¡n hÃ ng; phÃ¢n quyá»n theo chá»§ sá»Ÿ há»¯u.

#### Tá»‘i Æ°u & best practice

- TTL ngáº¯n, refresh token rotation; revoke; cáº¥u hÃ¬nh CORS.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: báº£o máº­t cÄƒn báº£n, sáºµn sÃ ng production.
- BÃ i táº­p: báº£o vá»‡ `POST /products` vÃ  viáº¿t test auth.

Má»¥c tiÃªu há»c:

- XÃ¡c thá»±c JWT, phÃ¢n quyá»n RBAC, method security.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- Filter chuá»—i: `OncePerRequestFilter` trÃ­ch Bearer token.
- `SecurityFilterChain` thay tháº¿ `WebSecurityConfigurerAdapter`.
- `@PreAuthorize` vá»›i `hasRole('ADMIN')`/`hasAuthority('product:read')`.
- Refresh token vÃ  revocation chiáº¿n lÆ°á»£c.

Giáº£i thÃ­ch chi tiáº¿t:

- JWT gá»“m 3 pháº§n: `header.payload.signature` (Base64URL). Server kÃ½ (HMAC/RS256) vÃ  client gá»­i qua header `Authorization: Bearer <token>`.
- ÄÄƒng nháº­p: verify username/password (BCrypt), sinh JWT access token TTL ngáº¯n, refresh token TTL dÃ i hÆ¡n.

```java
// Sinh JWT báº±ng jjwt
String token = Jwts.builder()
 .setSubject(user.getUsername())
 .claim("roles", List.of("ROLE_USER"))
 .setExpiration(Date.from(Instant.now().plusSeconds(3600)))
 .signWith(Keys.hmacShaKeyFor(secret.getBytes()), SignatureAlgorithm.HS256)
 .compact();
```

- Filter: parse JWT, set Authentication vÃ o SecurityContext Ä‘á»ƒ Spring Security phÃ¢n quyá»n.
- Method security: `@PreAuthorize("hasRole('ADMIN')")` báº£o vá»‡ á»Ÿ service/controller; Æ°u tiÃªn báº£o vá»‡ cáº£ API vÃ  service layer.
- Refresh & revoke: lÆ°u báº£ng refresh token (hash), rotate má»—i láº§n sá»­ dá»¥ng, revoke khi logout hoáº·c nghi ngá» lá»™.

VÃ­ dá»¥ cáº¥u hÃ¬nh tá»‘i thiá»ƒu:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-security</artifactId>
</dependency>
<dependency>
  <groupId>io.jsonwebtoken</groupId>
  <artifactId>jjwt-api</artifactId>
  <version>0.11.5</version>
</dependency>
```

```java
@Configuration
@EnableMethodSecurity
class SecurityConfig {
  @Bean SecurityFilterChain http(HttpSecurity http) throws Exception {
    return http.csrf(csrf->csrf.disable())
      .authorizeHttpRequests(auth->auth
        .requestMatchers("/actuator/health", "/auth/**").permitAll()
        .anyRequest().authenticated())
      .addFilterBefore(new JwtAuthFilter(), UsernamePasswordAuthenticationFilter.class)
      .build();
  }
}

class JwtAuthFilter extends OncePerRequestFilter {
  @Override protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain fc)
      throws ServletException, IOException {
    String h = req.getHeader("Authorization");
    if(h!=null && h.startsWith("Bearer ")){
      String jwt = h.substring(7);
      // verify, parse claims â†’ create Authentication
      var auth = new UsernamePasswordAuthenticationToken("user", null, List.of(new SimpleGrantedAuthority("ROLE_USER")));
      SecurityContextHolder.getContext().setAuthentication(auth);
    }
    fc.doFilter(req, res);
  }
}
```

RBAC máº«u (báº£ng):

- users(id, username, password_hash, enabled)
- roles(id, name)
- permissions(id, name)
- user_roles(user_id, role_id)
- role_permissions(role_id, permission_id)

BÃ i táº­p: Báº£o vá»‡ `/api/products` chá»‰ cho `ROLE_ADMIN` táº¡o, `ROLE_USER` chá»‰ Ä‘á»c.

LÆ°u Ã½ production: LÆ°u secret an toÃ n, rotate keys, thÃªm `@PreAuthorize` á»Ÿ service.

NÃ¢ng cao (Security):

- Bcrypt/Argon2 cáº¥u hÃ¬nh strength:

```java
@Bean PasswordEncoder encoder(){ return new BCryptPasswordEncoder(12); }
```

- Refresh token & revocation: báº£ng `refresh_tokens(id, user_id, token_hash, expires_at, revoked_at)`; rotate khi dÃ¹ng.
- CORS an toÃ n:

```java
@Bean CorsConfigurationSource cors(){ var c=new CorsConfiguration(); c.setAllowedOrigins(List.of("https://app.example.com")); c.setAllowedMethods(List.of("GET","POST","PUT","DELETE")); c.setAllowCredentials(true); var s=new UrlBasedCorsConfigurationSource(); s.registerCorsConfiguration("/**", c); return s; }
```

- ABAC vá»›i SpEL: `@PreAuthorize("hasRole('ADMIN') or #userId == authentication.name")`.

TÃ³m táº¯t & Key Takeaways:

- Hiá»ƒu chuá»—i filter, cáº¥u hÃ¬nh `SecurityFilterChain`, vÃ  method security.
- Ãp dá»¥ng refresh token rotation vÃ  token revocation an toÃ n.
- CORS cáº¥u hÃ¬nh theo domain whitelist; máº­t kháº©u bÄƒm máº¡nh.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t rule cho chá»‰ chá»§ Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c xem: `@PreAuthorize("hasAuthority('order:read') and #order.userId == principal.id")` (gá»£i Ã½ dÃ¹ng service Ä‘á»ƒ láº¥y owner).
- TrÃ¬nh bÃ y chiáº¿n lÆ°á»£c revoke token khi user logout.
- CÃ¡ch chÃ¨n `JwtAuthenticationConverter` Ä‘á»ƒ map claimsâ†’authorities.

---

<a id="ch9"></a>

## 9. Message Queue: RabbitMQ/Kafka (Intermediate)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: giao tiáº¿p async, decoupling, retry/dlq.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 6â€“8.
- LÃ½ do: tÄƒng thÃ´ng lÆ°á»£ng, Ä‘á»™ bá»n vÃ  chá»‘ng sá»‘c táº£i.

#### Ná»™i dung chi tiáº¿t

- RabbitMQ exchange/queue; Kafka topic/partition; consumer group; retry/dlq; idempotency.

#### VÃ­ dá»¥ code thá»±c táº¿

- Producer/consumer, keying, idempotent handler (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Order â†’ Payment â†’ Notification; audit logs; event sourcing nháº¹.

#### Tá»‘i Æ°u & best practice

- Chá»n key, partition; backoff; outbox pattern.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™ Ä‘Ã¡ng tin cáº­y.
- BÃ i táº­p: thÃªm retry/dlq vÃ  kiá»ƒm thá»­ báº±ng Testcontainers.

Má»¥c tiÃªu há»c:

- Gá»­i/nháº­n sá»± kiá»‡n, thiáº¿t káº¿ topic, idempotency.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- RabbitMQ (exchange, queue, routing) vÃ  Kafka (topic, partition, consumer group).
- DÃ¹ng Spring for Rabbit/Kafka Ä‘á»ƒ publish/consume.
- Thiáº¿t káº¿ event schema, versioning, idempotency key.

Giáº£i thÃ­ch chi tiáº¿t:

- RabbitMQ: broker theo mÃ´ hÃ¬nh message + routing. Exchange types: `direct` (exact key), `topic` (pattern), `fanout` (broadcast). Ack/nack Ä‘iá»u khiá»ƒn requeue; DLX (dead-letter exchange) Ä‘á»ƒ Ä‘áº©y message lá»—i sang hÃ ng chá» khÃ¡c.
- Kafka: log phÃ¢n vÃ¹ng, lÆ°u trá»¯ theo offset. Consumer group chia táº£i theo partition. Thá»© tá»± Ä‘áº£m báº£o trong 1 partition cÃ¹ng key. Producer chá»n partition báº±ng key Ä‘á»ƒ giá»¯ thá»© tá»± theo aggregate.
- Exactly-once vs at-least-once: Kafka há»— trá»£ idempotent producer vÃ  transactional gá»­i, nhÆ°ng thá»±c táº¿ váº«n cáº§n idempotency á»Ÿ consumer báº±ng kho lÆ°u eventId.
- Schema event: thÃªm `type`, `version`, `occurredAt`, `aggregateId` Ä‘á»ƒ tiáº¿n hÃ³a schema an toÃ n. DÃ¹ng Avro/Protobuf khi thÃ­ch há»£p.

VÃ­ dá»¥ Kafka:

```xml
<dependency>
  <groupId>org.springframework.kafka</groupId>
  <artifactId>spring-kafka</artifactId>
</dependency>
```

```java
@Service
class OrderEventPublisher {
  private final KafkaTemplate<String, String> kafka;
  OrderEventPublisher(KafkaTemplate<String,String> kafka){this.kafka=kafka;}
  void publishOrderCreated(String orderId){
    kafka.send("order.events", orderId, "{\"type\":\"ORDER_CREATED\",\"orderId\":\""+orderId+"\"}");
  }
}

@Component
class OrderEventListener {
  @KafkaListener(topics = "order.events", groupId = "billing")
  public void onMessage(String payload){
    // parse JSON vÃ  xá»­ lÃ½
  }
}
```

BÃ i táº­p: Khi táº¡o Order, publish sá»± kiá»‡n; service Inventory consume Ä‘á»ƒ trá»« tá»“n kho.

LÆ°u Ã½ production: Chia partition theo key; Ä‘áº·t `max.poll.interval.ms`, `concurrency`; retry+DLQ.

NÃ¢ng cao (MQ thá»±c hÃ nh):

- RabbitMQ vÃ­ dá»¥ (Spring AMQP):

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

```java
@Configuration class AmqpConfig {
  @Bean TopicExchange ex(){ return new TopicExchange("order.ex"); }
  @Bean Queue q(){ return new Queue("order.q"); }
  @Bean Binding b(Queue q, TopicExchange ex){ return BindingBuilder.bind(q).to(ex).with("order.*"); }
}
@Service class OrderPublisher { private final AmqpTemplate t; OrderPublisher(AmqpTemplate t){this.t=t;} void created(String id){ t.convertAndSend("order.ex","order.created", id);} }
@RabbitListener(queues = "order.q") void handle(String id){ /* consume */ }
```

- Idempotency consumer: lÆ°u `processed_events(event_id, consumer)` Ä‘á»ƒ bá» qua trÃ¹ng.
- Kafka consumer tuning: `max.poll.records`, `fetch.min.bytes`, `enable.auto.commit=false` + manual commit sau xá»­ lÃ½ thÃ nh cÃ´ng.
- Exactly-once vs At-least-once: dÃ¹ng idempotency + transactional producer (Kafka) cho gáº§n exactly-once.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Outbox, DLQ, Idempotency)

- Outbox pattern (JPA) Ä‘á»ƒ khÃ´ng máº¥t sá»± kiá»‡n khi commit DB tháº¥t báº¡i hoáº·c producer lá»—i:

```java
@Entity @Table(name="outbox_events")
class OutboxEvent { @Id @GeneratedValue Long id; String aggregateType; String aggregateId; String type; @Column(columnDefinition="text") String payload; Instant occurredAt; }

@Transactional
public void placeOrder(Order order){
  orderRepo.save(order);
  var evt = new OutboxEvent();
  evt.aggregateType = "Order"; evt.aggregateId = order.id.toString(); evt.type = "ORDER_CREATED";
  evt.payload = objectMapper.writeValueAsString(Map.of("orderId", order.id));
  evt.occurredAt = Instant.now();
  outboxRepo.save(evt);
  // Commit á»Ÿ Ä‘Ã¢y Ä‘áº£m báº£o dá»¯ liá»‡u vÃ  sá»± kiá»‡n Ä‘Æ°á»£c ghi Ä‘á»“ng thá»i
}

// Publisher (Ä‘á»‹nh ká»³) Ä‘á»c outbox vÃ  gá»­i Kafka, sau Ä‘Ã³ Ä‘Ã¡nh dáº¥u Ä‘Ã£ gá»­i
@Scheduled(fixedDelay = 1000)
void publishOutbox(){
  List<OutboxEvent> batch = outboxRepo.findTop100ByOrderByIdAsc();
  for (var e : batch) {
    kafka.send("order.events", e.aggregateId, e.payload);
    outboxRepo.delete(e); // hoáº·c Ä‘Ã¡nh dáº¥u processed
  }
}
```

- Kafka DLQ: cáº¥u hÃ¬nh container error handler Ä‘á»ƒ gá»­i lá»—i sang topic `.DLT`:

```java
@Bean
ConcurrentKafkaListenerContainerFactory<String,String> kafkaFactory(ConsumerFactory<String,String> cf, KafkaTemplate<String,String> tpl){
  var f = new ConcurrentKafkaListenerContainerFactory<String,String>(); f.setConsumerFactory(cf);
  f.setCommonErrorHandler(new DefaultErrorHandler(new DeadLetterPublishingRecoverer(tpl), new ExponentialBackOffWithMaxRetries(5)));
  return f;
}
```

- Idempotency vá»›i Redis (chá»‘ng xá»­ lÃ½ trÃ¹ng láº·p):

```java
boolean firstTime = Boolean.TRUE.equals(redis.setIfAbsent("evt:"+eventId, "1", Duration.ofHours(6)));
if (!firstTime) return; // Ä‘Ã£ xá»­ lÃ½
// ... xá»­ lÃ½ sá»± kiá»‡n an toÃ n
```

- Reactive messaging (Reactor Kafka) cho pipeline tá»‘c Ä‘á»™ cao (tuá»³ chá»n):

```java
ReceiverOptions<String,String> opts = ReceiverOptions.<String,String>create(props).subscription(Set.of("order.events"));
KafkaReceiver.create(opts).receive()
  .concatMap(rec -> process(rec.value()).then(Mono.fromRunnable(() -> rec.receiverOffset().acknowledge())))
  .onErrorContinue((ex, d) -> log.error("err", ex))
  .subscribe();
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (Kafka Streams)

```xml
<dependency>
  <groupId>org.apache.kafka</groupId>
  <artifactId>kafka-streams</artifactId>
</dependency>
```

VÃ­ dá»¥ topology Ä‘áº¿m sá»± kiá»‡n theo key (Ä‘á»c `order.events` vÃ  ghi `order.events.count`):

```java
@Bean ApplicationRunner streamsRunner(){
  return args -> {
    Properties p = new Properties();
    p.put(StreamsConfig.APPLICATION_ID_CONFIG, "orders-agg");
    p.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
    StreamsBuilder b = new StreamsBuilder();
    KStream<String,String> events = b.stream("order.events");
    events.groupByKey().count().toStream().to("order.events.count");
    KafkaStreams streams = new KafkaStreams(b.build(), p);
    streams.start();
  };
}
```

TÃ³m táº¯t & Key Takeaways:

- PhÃ¢n biá»‡t Rabbbit vs Kafka; chá»n theo use-case (command vs event streaming).
- Hiá»ƒu partitioning, consumer group, vÃ  idempotency thá»±c thi á»Ÿ consumer.
- Thiáº¿t láº­p retry + DLQ Ä‘á»ƒ cÃ´ láº­p lá»—i dá»¯ liá»‡u.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Chá»n key partition cho sá»± kiá»‡n ORDER_CREATED? VÃ¬ sao? (Gá»£i Ã½: `orderId` Ä‘á»ƒ giá»¯ thá»© tá»±.)
- Viáº¿t cáº¥u hÃ¬nh concurrency cho KafkaListener xá»­ lÃ½ song song an toÃ n.
- Minh há»a chiáº¿n lÆ°á»£c retry cÃ³ backoff vÃ  DLQ cho message lá»—i.

---

<a id="ch10"></a>

## 10. Hiá»‡u nÄƒng & Caching, HikariCP, Actuator (Advanced)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: tá»‘i Æ°u latency/throughput, táº­n dá»¥ng cache, cáº¥u hÃ¬nh pool, quan sÃ¡t.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 5â€“9.
- LÃ½ do: giáº£m táº£i DB, á»•n Ä‘á»‹nh dÆ°á»›i Ã¡p lá»±c.

#### Ná»™i dung chi tiáº¿t

- Redis cache, rate limit; HikariCP sizing; metrics/tracing vá»›i Actuator.

#### VÃ­ dá»¥ code thá»±c táº¿

- `@Cacheable`, cáº¥u hÃ¬nh HikariCP, metrics Prometheus (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Cache sáº£n pháº©m/hÃ ng tá»“n; circuit breaker cho dá»‹ch vá»¥ phá»¥ thuá»™c.

#### Tá»‘i Æ°u & best practice

- TÃ­nh toÃ¡n pool size; trÃ¡nh cache stampede; báº­t structured logging.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: biáº¿t Ä‘o vÃ  cáº£i thiá»‡n hiá»‡u nÄƒng cÃ³ ká»· luáº­t.
- BÃ i táº­p: thÃªm cache Redis cho GET sáº£n pháº©m, quan sÃ¡t metrics.

Má»¥c tiÃªu há»c:

- DÃ¹ng Redis cache, tá»‘i Æ°u connection pool, metrics.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- `spring-boot-starter-cache` + Redis, key design, TTL, cache invalidation.
- HikariCP tuning: pool size ~ 2Ã—CPU cores, timeouts.
- Actuator + Micrometer + Prometheus.

VÃ­ dá»¥ Redis cache:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-cache</artifactId>
</dependency>
```

```java
@EnableCaching
@Service
class CachedProductService {
  private final ProductRepo repo;
  CachedProductService(ProductRepo repo){this.repo=repo;}
  @Cacheable(cacheNames="product", key="#id")
  public Product get(Long id){ return repo.findById(id).orElseThrow(); }
}
```

```yaml
spring:
  redis:
    host: localhost
    port: 6379
  datasource:
    hikari:
      maximum-pool-size: 16
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
```

BÃ i táº­p: ThÃªm cache cho `search(q)` vá»›i TTL 5 phÃºt; xÃ³a cache khi cáº­p nháº­t sáº£n pháº©m.

LÆ°u Ã½ production: TrÃ¡nh cache stampede (lock, jitter TTL), warmup cache, theo dÃµi hit ratio.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Cache & Pool)

- Chá»‘ng cache stampede vá»›i Spring Cache: `@Cacheable(sync = true)` Ä‘á»ƒ Ä‘á»“ng bá»™ hoÃ¡ táº£i láº§n Ä‘áº§u cho cÃ¹ng key.

```java
@Cacheable(cacheNames="product", key="#id", sync = true)
public Product get(Long id){ ... }
```

- TTL + Jitter (random thÃªm 10â€“20%): trÃ¡nh â€œcache avalancheâ€ khi Ä‘á»“ng loáº¡t háº¿t háº¡n.
- Two-level cache: Caffeine (in-memory) phÃ­a trÆ°á»›c Redis Ä‘á»ƒ giáº£m Ä‘á»™ trá»… Ä‘á»c nÃ³ng.
- HikariCP sizing dá»±a trÃªn I/O bound: dÃ¹ng cÃ´ng thá»©c Littleâ€™s Law, Ä‘o thá»i gian query P95 Ä‘á»ƒ tinh chá»‰nh.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Virtual Threads & Native Image)

- Virtual Threads (Java 21+) cho workload I/O-bound (Spring Boot 3.2+):

```java
@Bean Executor taskExecutor(){
  return Executors.newVirtualThreadPerTaskExecutor();
}
```

```yaml
spring:
  threads:
    virtual:
      enabled: true
```

LÆ°u Ã½: JDBC váº«n blocking theo káº¿t ná»‘i; virtual threads giÃºp táº­n dá»¥ng tá»‘t tÃ i nguyÃªn khi cÃ³ nhiá»u I/O chá».

- Native image (GraalVM) cho startup nhanh, footprint nhá»:

```bash
mvn -Pnative native:compile           # build nhá»‹ phÃ¢n native
# Hoáº·c dÃ¹ng buildpack
mvn -DskipTests spring-boot:build-image -Pnative
```

Khi cáº§n, thÃªm runtime hints hoáº·c `@RegisterReflectionForBinding` cho JSON binding Ä‘áº·c biá»‡t.

NÃ¢ng cao (Hiá»‡u nÄƒng JVM & Metrics):

- GC vÃ  container: dÃ¹ng G1GC (máº·c Ä‘á»‹nh JDK17), gá»£i Ã½ flags:

```
-XX:+UseStringDeduplication -XX:MaxRAMPercentage=75.0 -XX:+ExitOnOutOfMemoryError
```

- HikariCP: báº¯t Ä‘áº§u vá»›i `minIdle=CPU cores`, `maxPoolSize ~ 2Ã—cores` rá»“i Ä‘o lÆ°á»ng.
- Micrometer:

```java
@Component class CheckoutMetrics {
  private final Counter orders;
  CheckoutMetrics(MeterRegistry r){ orders = Counter.builder("orders.created").register(r); }
  void inc(){ orders.increment(); }
}
```

- Cache invalidation chiáº¿n lÆ°á»£c: write-through vs write-behind; cache-aside phá»• biáº¿n.

TÃ³m táº¯t & Key Takeaways:

- Tá»‘i Æ°u pool vÃ  cache dá»±a trÃªn Ä‘o Ä‘áº¡c, khÃ´ng cáº£m tÃ­nh.
- Xuáº¥t metrics vÃ  theo dÃµi SLA/SLO vá»›i Prometheus+Grafana.
- TrÃ¡nh stampede báº±ng lock/jitter vÃ  warm-up dá»¯ liá»‡u nÃ³ng.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- TrÃ¬nh bÃ y tÃ¡c Ä‘á»™ng cá»§a `maximumPoolSize` quÃ¡ lá»›n lÃªn DB.
- Thiáº¿t káº¿ key Redis Ä‘á»ƒ cache káº¿t quáº£ tÃ¬m kiáº¿m theo `q` vÃ  `page`.
- Táº¡o má»™t `Timer` Micrometer Ä‘o latency endpoint `/api/orders`.

### 10B. Redis tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao

- Dependencies:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

- Spring Cache + RedisTemplate:

```java
@EnableCaching
@Configuration
class RedisCfg {
  @Bean RedisTemplate<String, String> redisTemplate(LettuceConnectionFactory cf){
    var t = new RedisTemplate<String,String>(); t.setConnectionFactory(cf); return t;
  }
}

@Cacheable(cacheNames="user", key="#id")
public User getUser(long id){ ... }
```

- Redis Pub/Sub vÃ  Streams:

```java
// publish stream
var rec = StreamRecords.objectBacked(Map.of("orderId","1","type","CREATED")).withStreamKey("order.events");
stringRedisTemplate.opsForStream().add(rec);
// consumer group (pseudo)
stringRedisTemplate.opsForStream().read(Consumer.from("grp","c1"), StreamReadOptions.empty().count(10), StreamOffset.create("order.events", ReadOffset.lastConsumed()))
```

- Rate limiting (token bucket, Lua) vÃ  distributed lock (Redisson) cho tÃ¡c vá»¥ Ä‘á»‹nh ká»³/critical sections.
- Redis Cluster/Sentinel: lÆ°u Ã½ topology, failover vÃ  key hashing.

Checkpoint Redis (10B):

- Viáº¿t demo consumer group Ä‘á»c tá»« Redis Streams vÃ  Ä‘áº£m báº£o idempotency.
- Triá»ƒn khai rate limiting 100 req/minute theo user vá»›i Lua hoáº·c Bucket4j.
- Táº¡o cache key cho search cÃ³ tham sá»‘ trang/sort, xá»­ lÃ½ invalidation khi cáº­p nháº­t.

---

<a id="ch11"></a>

## 11. Reactive: Spring WebFlux (Advanced)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: xá»­ lÃ½ I/O quy mÃ´ lá»›n nonâ€‘blocking, stream dá»¯ liá»‡u.
- Kiáº¿n thá»©c ná»n: Java streams, concurrency; chÆ°Æ¡ng 5â€“10.
- LÃ½ do: tiáº¿t kiá»‡m tÃ i nguyÃªn, phÃ¹ há»£p realtime/chat.

#### Ná»™i dung chi tiáº¿t

- Mono/Flux, backpressure; router functions; R2DBC/Mongo reactive; SSE/WebSocket.

#### VÃ­ dá»¥ code thá»±c táº¿

- WebFlux controller, reactive repo, SSE stream (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Báº£ng tin realtime, thÃ´ng bÃ¡o Ä‘áº©y, xá»­ lÃ½ log/metrics quy mÃ´ lá»›n.

#### Tá»‘i Æ°u & best practice

- Giá»›i háº¡n thread; khÃ´ng block trong reactive; publishOn/subscribeOn Ä‘Ãºng chá»—.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: khi nÃ o chá»n reactive, khi nÃ o khÃ´ng.
- BÃ i táº­p: viáº¿t SSE `/events` vÃ  test backpressure.

Má»¥c tiÃªu há»c:

- Hiá»ƒu WebFlux, khi nÃ o dÃ¹ng reactive vs blocking.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- Reactor `Mono`/`Flux`, backpressure, thread model.
- Khi dÃ¹ng: I/O bound, nhiá»u káº¿t ná»‘i, streaming; trÃ¡nh náº¿u logic CPU-bound thuáº§n.

VÃ­ dá»¥ endpoint reactive:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
```

```java
@RestController
@RequestMapping("/rx")
class RxController {
  @GetMapping("/numbers")
  Flux<Integer> numbers(){ return Flux.range(1, 10).delayElements(Duration.ofMillis(100)); }
}
```

BÃ i táº­p: Viáº¿t endpoint stream log há»‡ thá»‘ng theo thá»i gian thá»±c (SSE).

LÆ°u Ã½ production: Cáº§n non-blocking driver (R2DBC) náº¿u muá»‘n full reactive data path.

NÃ¢ng cao (Reactive):

- TrÃ¡nh cháº·n: khi báº¯t buá»™c gá»i blocking (JDBC), chuyá»ƒn sang `boundedElastic()` vÃ  cÃ¢n nháº¯c thread starvation.

```java
Mono.fromCallable(() -> repo.findById(id)).subscribeOn(Schedulers.boundedElastic())
```

- Context & logging (MDC): dÃ¹ng `Hooks.enableAutomaticContextPropagation()` vÃ  `log()`/`doOnEach`.
- Backpressure: sá»­ dá»¥ng `onBackpressureBuffer`/`drop` phÃ¹ há»£p use-case stream nÃ³ng.

#### Bá»• sung hiá»‡n Ä‘áº¡i (R2DBC, MDC, RSocket)

- R2DBC Postgres máº«u vÃ  repository reactive:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-r2dbc</artifactId>
</dependency>
<dependency>
  <groupId>io.r2dbc</groupId>
  <artifactId>r2dbc-postgresql</artifactId>
  <scope>runtime</scope>
</dependency>
```

```java
@Table("products")
record ProductRx(@Id Long id, String name, BigDecimal price){}
interface ProductRxRepo extends ReactiveCrudRepository<ProductRx, Long> {
  Flux<ProductRx> findByNameContainsIgnoreCase(String q);
}
```

- MDC/Tracing propagation trong Reactor:

```java
Hooks.enableAutomaticContextPropagation();
Mono.deferContextual(ctx -> {
  MDC.put("traceId", ctx.getOrDefault("traceId", "-"));
  log.info("processing");
  return Mono.empty();
}).contextWrite(Context.of("traceId", tracer.currentSpan().context().traceId()))
 .subscribe();
```

- RSocket (reactive messaging) endpoint Ä‘Æ¡n giáº£n:

```java
@Controller
class RSocketCtrl {
  @MessageMapping("echo")
  Flux<String> echo(Flux<String> in){ return in.map(s -> "echo:"+s); }
}
```

TÃ³m táº¯t & Key Takeaways:

- WebFlux phÃ¹ há»£p IO-bound; háº¡n cháº¿ khi logic CPU-bound hoáº·c cáº§n JDBC blocking.
- Hiá»ƒu backpressure vÃ  context propagation Ä‘á»ƒ debug/tracing.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- PhÃ¢n biá»‡t `publishOn` vs `subscribeOn` vÃ  tÃ¡c Ä‘á»™ng thread.
- Viáº¿t SSE tráº£ log há»‡ thá»‘ng theo nhÃ£n `app=product`.
- TrÃ¬nh bÃ y cÃ¡ch káº¿t ná»‘i R2DBC Postgres vÃ  báº«y thÆ°á»ng gáº·p.

### 11B. Reactive MongoDB & Change Streams

- Dependencies:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-mongodb-reactive</artifactId>
</dependency>
```

- Document + Reactive Repository + TTL Index:

```java
@Document("users")
class UserDoc { @Id String id; @Indexed(unique=true) String email; @Indexed(expireAfterSeconds=3600) Instant lastSeen; }
interface UserRepo extends ReactiveMongoRepository<UserDoc, String> { Flux<UserDoc> findByEmailRegex(String regex); }
```

- Aggregation pipeline vÃ  Change Streams:

```java
var agg = Aggregation.newAggregation(match(Criteria.where("status").is("PAID")), group("userId").sum("total").as("sum"));
reactiveMongoTemplate.aggregate(agg, "orders", Document.class).subscribe();
reactiveMongoTemplate.changeStream("orders", ChangeStreamOptions.empty(), Document.class)
  .doOnNext(e -> log.info("Changed: {}", e)).subscribe();
```

- Sharding, write concern, read preference: khi scale, chá»n `majority` cho giao dá»‹ch quan trá»ng; `secondaryPreferred` cho Ä‘á»c.

Checkpoint Mongo (11B):

- Táº¡o TTL index cho `lastSeen` vÃ  xÃ¡c nháº­n tÃ i liá»‡u tá»± xÃ³a.
- Viáº¿t aggregation nhÃ³m tá»•ng chi tiÃªu theo user; so sÃ¡nh latency cÃ³ index/khÃ´ng index.
- Nghe change stream vÃ  cáº­p nháº­t cache realtime khi Ä‘Æ¡n hÃ ng Ä‘á»•i tráº¡ng thÃ¡i.

---

<a id="ch12"></a>

## 12. Kiáº¿n trÃºc & Tá»• chá»©c mÃ£ (Advanced)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: Hexagonal, DDDâ€‘lite, module hoÃ¡.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 2â€“11.
- LÃ½ do: dá»… báº£o trÃ¬, test, má»Ÿ rá»™ng Ä‘á»™i ngÅ©.

#### Ná»™i dung chi tiáº¿t

- Domain/Application/Infrastructure; ports/adapters; boundaries; package by feature.

#### VÃ­ dá»¥ code thá»±c táº¿

- Service domain thuáº§n Java, adapter REST/DB/MQ (máº«u trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Chia module product/order/payment; chiáº¿n lÆ°á»£c giao tiáº¿p giá»¯a bounded contexts.

#### Tá»‘i Æ°u & best practice

- Chá»‘ng rÃ² rá»‰ háº¡ táº§ng vÃ o domain; interfaceâ€‘driven; antiâ€‘corruption layer.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: cáº¥u trÃºc sáº¡ch vÃ  kiá»ƒm soÃ¡t phá»¥ thuá»™c.
- BÃ i táº­p: refactor má»™t module theo Hexagonal.

Má»¥c tiÃªu há»c:

- Ãp dá»¥ng Hexagonal/Ports-Adapters, tÃ¡ch domain/service/inbound/outbound.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- Package by feature vs by layer; tÃ¡ch module.
- DDD-lite: entity, value object, domain service, application service.

ASCII sÆ¡ Ä‘á»“:

```
[HTTP/GraphQL/gRPC] â†’ Inbound Adapter â†’ Application Service â†’ Domain â†’ Outbound Port â†’ [DB/MQ/External]
```

VÃ­ dá»¥ Port/Adapter:

```java
// Port
interface PaymentPort { boolean charge(String orderId, BigDecimal amount); }
// Adapter
@Component class StripeAdapter implements PaymentPort { /* call Stripe */ }
// App Service
@Service class CheckoutUseCase { private final PaymentPort port; /* ... */ }
```

BÃ i táº­p: Chuyá»ƒn `OrderService` sang mÃ´ hÃ¬nh port/adapters; mock Port trong test.

LÆ°u Ã½ production: TÃ¡ch há»£p Ä‘á»“ng á»Ÿ port, cÃ´ láº­p adapter; module hÃ³a Ä‘á»ƒ giá»›i háº¡n phá»¥ thuá»™c.

NÃ¢ng cao (Kiáº¿n trÃºc):

- Cáº¥u trÃºc module vÃ­ dá»¥:

```
app/ (Spring Boot) â†’ phá»¥ thuá»™c application/, adapters/
domain/ (pure Java, no Spring)
application/ (use-cases, ports)
adapters/
  inbound-rest/
  outbound-jpa/
  outbound-kafka/
```

- TÆ° duy domain: invariants vÃ  policy trong domain service; anti-corruption layer khi tÃ­ch há»£p há»‡ ngoÃ i.
- Boundary: Ä‘á»‹nh nghÄ©a port á»Ÿ application; adapter implement port vÃ  inject vÃ o use-case.

#### Bá»• sung hiá»‡n Ä‘áº¡i (ArchUnit rules)

```java
@AnalyzeClasses(packages = "com.example")
class ArchitectureTest {
  @ArchTest static final ArchRule domain_is_pure = noClasses()
    .that().resideInAPackage("..domain..")
    .should().dependOnClassesThat().resideInAnyPackage("..spring..", "..adapter..", "..infrastructure..");
}
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (CQRS & Event Sourcing)

- PhÃ¢n tÃ¡ch ghi/Ä‘á»c: lá»‡nh (command) cáº­p nháº­t state + ghi event; pháº§n Ä‘á»c (query) build read models tá»‘i Æ°u truy váº¥n.

```java
// Command handler
@Transactional
public void handle(CreateOrder cmd){
  var order = Order.create(cmd.customerId(), cmd.items());
  orderRepo.save(order);
  outboxRepo.save(OutboxEvent.from(order.toOrderCreatedEvent()));
}

// Projector cáº­p nháº­t read model
@KafkaListener(topics = "order.events", groupId = "read-model")
void onOrderCreated(String json){
  var e = mapper.readValue(json, OrderCreated.class);
  readModelRepo.upsert(new OrderView(e.orderId(), e.total(), e.status()));
}
```

- Read model lÆ°u á»Ÿ storage phÃ¹ há»£p (Elasticsearch/Mongo/Redis) Ä‘á»ƒ phá»¥c vá»¥ truy váº¥n nhanh; xá»­ lÃ½ eventual consistency á»Ÿ UI.

TÃ³m táº¯t & Key Takeaways:

- Packaging by feature vÃ  tÃ¡ch domain giÃºp dá»… báº£o trÃ¬, test, thay tháº¿ adapter.
- Port/Adapter cÃ´ láº­p phá»¥ thuá»™c framework; domain thuáº§n Java.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Váº½ láº¡i dependency rules giá»¯a module trÃªn.
- XÃ¡c Ä‘á»‹nh Port cho Inventory khi chuyá»ƒn kho: `reserve`, `release` cáº§n idempotent?
- Viáº¿t test cho use-case checkout vá»›i mock PaymentPort tráº£ lá»—i.

---

<a id="ch13"></a>

## 13. Microservices: gRPC, GraphQL, SAGA, Outbox (Expert)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: giao tiáº¿p Ä‘a giao thá»©c, nháº¥t quÃ¡n cuá»‘i cÃ¹ng, chá»‘ng máº¥t dá»¯ liá»‡u.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 7â€“12.
- LÃ½ do: má»Ÿ rá»™ng há»‡ thá»‘ng phá»©c táº¡p, tá»‘i Æ°u hoÃ¡ Ä‘Ãºng domain.

#### Ná»™i dung chi tiáº¿t

- gRPC unary/streaming; GraphQL schema/resolver; coordinator/choreography SAGA; outbox/idempotency.

#### VÃ­ dá»¥ code thá»±c táº¿

- API GraphQL, proto gRPC, SAGA máº«u vá»›i outbox (Ä‘Ã£ cÃ³ code trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- ÄÆ¡n hÃ ng Ä‘a bÆ°á»›c: reserve stock â†’ charge â†’ ship; query tá»•ng há»£p vá»›i GraphQL.

#### Tá»‘i Æ°u & best practice

- Timeout/retry/budget; theo dÃµi saga; chá»n choreography khi phÃ¹ há»£p.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: ná»n táº£ng microservices sáºµn sÃ ng má»Ÿ rá»™ng.
- BÃ i táº­p: thÃªm outbox cho sá»± kiá»‡n `OrderCreated`.

Má»¥c tiÃªu há»c:

- Giao tiáº¿p service-to-service, schema GraphQL, Ä‘iá»u phá»‘i giao dá»‹ch phÃ¢n tÃ¡n.

Thá»i lÆ°á»£ng: 2 tuáº§n

Ná»™i dung:

- gRPC: hiá»‡u nÄƒng, strongly-typed; dÃ¹ng cho ná»™i bá»™.
- GraphQL: query/mutation/subscription cho BFF.
- SAGA: orchestrator vs choreographer; Outbox pattern + relay Ä‘áº¿n Kafka.
- Idempotency key, exactly-once vs at-least-once.

VÃ­ dá»¥ gRPC proto:

```proto
syntax = "proto3";
package billing;
service BillingService { rpc Charge(ChargeReq) returns (ChargeRes); }
message ChargeReq { string orderId = 1; int64 amount = 2; }
message ChargeRes { bool ok = 1; string txId = 2; }
```

VÃ­ dá»¥ GraphQL schema (product):

```graphql
type Product {
  id: ID!
  name: String!
  price: Float!
}

type Query {
  products(q: String): [Product]!
}

type Mutation {
  createProduct(name: String!, price: Float!): Product!
}

type Subscription {
  priceChanged(productId: ID!): Product
}
```

SAGA checkout (choreography):

- OrderCreated â†’ ReserveInventory â†’ PaymentCharge â†’ Confirm/Cancel Order.
- Outbox: ghi event vÃ o báº£ng outbox trong cÃ¹ng transaction, relayer publish ra Kafka.

BÃ i táº­p: Thiáº¿t káº¿ outbox table vÃ  má»™t relayer (batch) Ä‘áº©y event sang Kafka.

LÆ°u Ã½ production: Quáº£n lÃ½ schema evolution (Protobuf/Avro), consumer group, retry, backoff.

NÃ¢ng cao (Microservices thá»±c chiáº¿n):

- Outbox DDL:

```sql
create table outbox (
  id uuid primary key,
  aggregate_type varchar(64) not null,
  aggregate_id varchar(64) not null,
  event_type varchar(64) not null,
  payload jsonb not null,
  created_at timestamptz default now(),
  processed boolean default false
);
create index on outbox(processed, created_at);
```

- Relay (pseudo-code):

```java
@Transactional
List<Outbox> batch = repo.findTop100ByProcessedFalseOrderByCreatedAt();
batch.forEach(e -> kafka.send(topic(e), e.aggregateId(), e.payload()));
repo.markProcessed(batch);
```

- gRPC client (Spring):

```java
@Bean BillingServiceGrpc.BillingServiceBlockingStub stub(ManagedChannel ch){ return BillingServiceGrpc.newBlockingStub(ch); }
```

- GraphQL subscription (WebSocket): dÃ¹ng protocol graphql-ws; Ä‘áº£m báº£o auth token refresh.
- Orchestrator vs choreography: chá»n orchestrator khi cáº§n Ä‘iá»u phá»‘i táº­p trung/compensation phá»©c táº¡p.

#### Bá»• sung hiá»‡n Ä‘áº¡i (Spring Cloud & Resilience)

- Config/Discovery:

```xml
<dependency><groupId>org.springframework.cloud</groupId><artifactId>spring-cloud-starter-config</artifactId></dependency>
<dependency><groupId>org.springframework.cloud</groupId><artifactId>spring-cloud-starter-netflix-eureka-client</artifactId></dependency>
```

- Gateway (Spring Cloud Gateway) cáº¥u hÃ¬nh routes:

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: product
          uri: http://localhost:8080
          predicates: [Path=/api/products/**]
        - id: order
          uri: lb://order-service
          predicates: [Path=/api/orders/**]
```

- Resilience4j CircuitBreaker/Retry/RateLimiter:

```xml
<dependency><groupId>io.github.resilience4j</groupId><artifactId>resilience4j-spring-boot3</artifactId></dependency>
```

```java
@CircuitBreaker(name = "payment", fallbackMethod = "fallback")
public PaymentRes pay(...) { /* call remote */ }
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (GraphQL Spring)

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-graphql</artifactId>
</dependency>
```

```java
@Controller
class ProductGraphql {
  private final ProductService svc;
  ProductGraphql(ProductService svc){ this.svc = svc; }
  @QueryMapping
  List<ProductDto> products(@Argument String q){ return svc.search(q).stream().map(ProductDto::from).toList(); }
}
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (gRPC plugin & Service)

```xml
<plugin>
  <groupId>io.grpc</groupId>
  <artifactId>protoc-gen-grpc-java</artifactId>
  <version>1.64.0</version>
</plugin>
```

```java
@GrpcService
class BillingGrpc extends BillingServiceGrpc.BillingServiceImplBase {
  @Override public void charge(ChargeReq req, StreamObserver<ChargeRes> out){
    boolean ok = paymentPort.charge(req.getOrderId(), BigDecimal.valueOf(req.getAmount()));
    out.onNext(ChargeRes.newBuilder().setOk(ok).build()); out.onCompleted();
  }
}
```

TÃ³m táº¯t & Key Takeaways:

- Outbox+relay lÃ  ná»n táº£ng chá»‘ng máº¥t sá»± kiá»‡n vÃ  Ä‘áº£m báº£o thá»© tá»± per-aggregate.
- Chá»n kÃªnh: gRPC cho ná»™i bá»™ latency tháº¥p; GraphQL cho BFF hÆ°á»›ng client.
- Saga cáº§n idempotency vÃ  chiáº¿n lÆ°á»£c bÃ¹ trá»« rÃµ rÃ ng.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Thiáº¿t káº¿ topic/partition cho events Ä‘Æ¡n hÃ ng má»©c 10k TPS, tiÃªu chÃ­ chá»n key?
- Viáº¿t flow compensation khi Payment tháº¥t báº¡i sau ReserveInventory.
- TrÃ¬nh bÃ y chiáº¿n lÆ°á»£c evolve schema event mÃ  khÃ´ng phÃ¡ há»ng consumer cÅ©.

---

<a id="ch14"></a>

## 14. Quan sÃ¡t & DevOps: Docker, K8s, CI/CD, OpenTelemetry (Expert)

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: Ä‘Ã³ng gÃ³i, triá»ƒn khai, quan sÃ¡t endâ€‘toâ€‘end.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 5â€“13.
- LÃ½ do: váº­n hÃ nh an toÃ n, rollback nhanh, Ä‘o Ä‘áº¡c liÃªn tá»¥c.

#### Ná»™i dung chi tiáº¿t

- Dockerfile, compose; manifests K8s; GH Actions; metrics/traces/logs OTel.

#### VÃ­ dá»¥ code thá»±c táº¿

- Pipeline CI rÃºt gá»n, compose Postgres/Redis/Kafka (Ä‘Ã£ cÃ³ trong chÆ°Æ¡ng/phá»¥ lá»¥c).

#### á»¨ng dá»¥ng thá»±c táº¿

- Triá»ƒn khai cÃ¡c dá»‹ch vá»¥ máº«u; thiáº¿t láº­p giÃ¡m sÃ¡t sá»± cá»‘ vÃ  cáº£nh bÃ¡o.

#### Tá»‘i Æ°u & best practice

- Immutable image; blue/green/canary; budget quan sÃ¡t.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: tá»« build Ä‘áº¿n váº­n hÃ nh cÃ³ kiá»ƒm soÃ¡t.
- BÃ i táº­p: thÃªm traceId vÃ o log vÃ  dashboard metrics.

Má»¥c tiÃªu há»c:

- Container hÃ³a, triá»ƒn khai K8s, pipeline CI/CD, metrics+tracing.

Thá»i lÆ°á»£ng: 2 tuáº§n

Ná»™i dung:

- Dockerfile multi-stage, giáº£m kÃ­ch thÆ°á»›c image.
- K8s: Deployment, Service, Ingress, ConfigMap, Secret, HPA, probes, PDB.
- CI/CD GitHub Actions: build â†’ test â†’ image â†’ deploy.
- Observability: Micrometer + Prometheus, OpenTelemetry tracing.

#### Bá»• sung hiá»‡n Ä‘áº¡i (OpenTelemetry & Probes)

- OpenTelemetry Java Agent (khÃ´ng cáº§n sá»­a mÃ£):

```bash
JAVA_TOOL_OPTIONS="-javaagent:/otel/javaagent.jar" \
OTEL_EXPORTER_OTLP_ENDPOINT="http://otel-collector:4317" \
OTEL_SERVICE_NAME="product-service" \
OTEL_METRICS_EXPORTER=otlp \
java -jar app.jar
```

- Spring Boot Micrometer Tracing â†’ OTel (yml):

```yaml
management:
  tracing:
    sampling:
      probability: 1.0
  otlp:
    tracing:
      endpoint: http://otel-collector:4317
```

- Probes: map `/actuator/health/readiness` cho readiness, `/actuator/health/liveness` cho liveness (Spring Boot 3+):

```yaml
management:
  endpoint:
    health:
      probes:
        enabled: true
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (OTel Collector & Log Correlation)

- docker-compose Collector rÃºt gá»n (OTLP gRPC):

```yaml
services:
  otel-collector:
    image: otel/opentelemetry-collector-contrib:0.100.0
    command: ["--config=/etc/otelcol-config.yaml"]
    volumes: ["./otelcol-config.yaml:/etc/otelcol-config.yaml:ro"]
    ports: ["4317:4317", "4318:4318"]
```

- Logback pattern thÃªm `traceId`/`spanId` (náº¿u dÃ¹ng pattern text):

```
%d{ISO8601} [%thread] %-5level %logger{36} - traceId=%X{trace_id} spanId=%X{span_id} %msg%n
```

VÃ­ dá»¥ Dockerfile:

```dockerfile
# syntax=docker/dockerfile:1
FROM maven:3.9-eclipse-temurin-17 AS build
WORKDIR /app
COPY . .
RUN mvn -q -DskipTests package

FROM eclipse-temurin:17-jre
WORKDIR /app
COPY --from=build /app/target/app.jar app.jar
ENV JAVA_OPTS="-XX:MaxRAMPercentage=75.0"
ENTRYPOINT ["sh","-c","java $JAVA_OPTS -jar app.jar"]
```

VÃ­ dá»¥ k8s manifests (rÃºt gá»n):

```yaml
apiVersion: apps/v1
kind: Deployment
metadata: { name: product-svc }
spec:
  replicas: 2
  selector: { matchLabels: { app: product } }
  template:
    metadata: { labels: { app: product } }
    spec:
      containers:
        - name: app
          image: ghcr.io/org/product:1.0.0
          ports: [{ containerPort: 8080 }]
          readinessProbe:
            { httpGet: { path: /actuator/health, port: 8080 }, initialDelaySeconds: 5 }
          livenessProbe:
            { httpGet: { path: /actuator/health, port: 8080 }, initialDelaySeconds: 15 }
---
apiVersion: v1
kind: Service
metadata: { name: product }
spec:
  selector: { app: product }
  ports: [{ port: 80, targetPort: 8080 }]
```

BÃ i táº­p: Táº¡o GitHub Actions workflow build+push image lÃªn GHCR/DockerHub.

LÆ°u Ã½ production: Sá»­ dá»¥ng secrets an toÃ n, kÃ½ image (cosign), rollout chiáº¿n lÆ°á»£c, autoscaling.

Bá»• sung manifests váº­n hÃ nh:

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata: { name: product-hpa }
spec:
  minReplicas: 2
  maxReplicas: 10
  scaleTargetRef: { apiVersion: apps/v1, kind: Deployment, name: product-svc }
  metrics:
    - type: Resource
      resource:
        name: cpu
        target: { type: Utilization, averageUtilization: 70 }
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata: { name: product-pdb }
spec:
  minAvailable: 1
  selector: { matchLabels: { app: product } }
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata: { name: product-ing }
spec:
  rules:
    - host: api.example.com
      http:
        paths:
          - path: /products
            pathType: Prefix
            backend:
              service: { name: product, port: { number: 80 } }
---
apiVersion: v1
kind: ConfigMap
metadata: { name: product-config }
data:
  APPLICATION_YML: |
    app:
      greeting: "Xin chÃ o"
---
apiVersion: v1
kind: Secret
metadata: { name: product-secrets }
type: Opaque
stringData:
  DB_PASSWORD: "s3cr3t"
```

CI/CD & Observability nÃ¢ng cao:

- GitHub Actions cache Maven:

```yaml
- uses: actions/cache@v4
  with:
    path: ~/.m2/repository
    key: m2-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
```

- OpenTelemetry Java Agent:

```bash
java -javaagent:opentelemetry-javaagent.jar \
  -Dotel.service.name=product \
  -Dotel.exporter.otlp.endpoint=http://otel-collector:4317 \
  -jar app.jar
```

TÃ³m táº¯t & Key Takeaways:

- K8s váº­n hÃ nh: requests/limits, HPA, PDB, Ingress, ConfigMap/Secret.
- CI/CD cáº§n cache build, quÃ©t báº£o máº­t, vÃ  quáº£n lÃ½ secrets an toÃ n.
- OTel agent giÃºp tracing khÃ´ng xÃ¢m láº¥n mÃ£ nguá»“n.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Thiáº¿t káº¿ readiness vs liveness probe há»£p lÃ½ cho app khá»Ÿi Ä‘á»™ng lÃ¢u.
- Viáº¿t rule HPA dá»±a trÃªn RPS thay vÃ¬ CPU (gá»£i Ã½: custom metrics).
- ThÃªm bÆ°á»›c scan SCA/Container vÃ o pipeline CI.

---

<a id="ch15"></a>

## 15. Dá»± Ã¡n máº«u: E-commerce

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: dá»±ng dá»‹ch vá»¥ bÃ¡n hÃ ng Ä‘Æ¡n giáº£n, má»Ÿ rá»™ng dáº§n.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 2â€“14.
- LÃ½ do: tá»•ng há»£p kiáº¿n thá»©c vÃ o bÃ i thá»±c chiáº¿n.

#### Ná»™i dung chi tiáº¿t

- Danh má»¥c/sáº£n pháº©m/giá» hÃ ng/Ä‘Æ¡n hÃ ng; API; cache; báº£o máº­t; logs/metrics.

#### VÃ­ dá»¥ code thá»±c táº¿

- Skeleton táº¡i `samples/projects/ecommerce-service` (Spring Boot 3, JDK 17).

#### á»¨ng dá»¥ng thá»±c táº¿

- TÃ­ch há»£p Payment/Shipping; Ã¡p dá»¥ng cache & metrics.

#### Tá»‘i Æ°u & best practice

- Idempotency cho checkout; isolation data; quan sÃ¡t lá»—i.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: táº¡o MVP vÃ  Ä‘o lÆ°á»ng.
- BÃ i táº­p: thÃªm endpoint tÃ¬m kiáº¿m sáº£n pháº©m vÃ  bá»™ lá»c.

Má»¥c tiÃªu há»c:

- Thiáº¿t káº¿ má»™t há»‡ thá»‘ng bÃ¡n hÃ ng cÆ¡ báº£n Ä‘á»§ cháº¡y: Catalog, Cart, Order, Payment, Inventory.

Thá»i lÆ°á»£ng: 2â€“3 tuáº§n

Kiáº¿n trÃºc (ASCII):

```
[Web/SPA] --(REST/GraphQL)--> [API Gateway]
   |                               |
   v                               v
[Auth]    [Catalog]  [Cart]  [Order]  [Inventory]  [Payment]
                \         \      |          |        /
                 \         ---- Kafka/RabbitMQ ------
```

DB Schema (chÃ­nh):

- users(id, email, password_hash, roles)
- products(id, name, price, stock, status)
- orders(id, user_id, total, status, created_at)
- order_items(id, order_id, product_id, qty, price)
- payments(id, order_id, amount, provider, status, tx_id)
- outbox(id, aggregate_type, aggregate_id, type, payload, created_at, processed)

API endpoints tiÃªu biá»ƒu (REST):

- GET /api/products?q=â€¦
- POST /api/cart/items {productId, qty}
- POST /api/orders {addressId, paymentMethod}
- GET /api/orders/{id}
- POST /api/payments {orderId}

Contract máº«u:

```json
POST /api/orders
{
  "items": [{"productId": 1, "qty": 2}],
  "shippingAddressId": 10,
  "paymentMethod": "COD"
}
```

```json
200 OK
{ "id": 123, "status": "CREATED", "total": 199.0 }
```

Sequence checkout (choreography):

1. Order Service táº¡o ORDER_CREATED (+ outbox).
2. Inventory consume ORDER_CREATED â†’ reserve stock.
3. Payment consume ORDER_RESERVED â†’ charge.
4. Order consume PAYMENT_SUCCESS â†’ mark PAID; náº¿u fail â†’ CANCELLED + release stock.

TÃ­ch há»£p:

- gRPC giá»¯a Orderâ€“Payment; Kafka cho sá»± kiá»‡n.
- GraphQL cho product search/aggregation á»Ÿ BFF.

Checklist deploy & considerations:

- Scale Catalog Ä‘á»c nhiá»u; cache sáº£n pháº©m.
- Partition Kafka theo `orderId` Ä‘á»ƒ giá»¯ thá»© tá»±.
- DB: index (products.name), (orders.user_id, created_at).
- CÃ¢n nháº¯c sharding báº£ng orders khi lá»›n.

BÃ i táº­p: CÃ i Ä‘áº·t flow ORDER_CREATED â†’ ORDER_PAID vá»›i Kafka vÃ  Outbox.

TÃ³m táº¯t & Key Takeaways:

- PhÃ¢n tÃ¡ch bounded context: Catalog, Order, Inventory, Payment vá»›i giao tiáº¿p sá»± kiá»‡n.
- Outbox giÃºp Ä‘áº£m báº£o publish sá»± kiá»‡n Ä‘Ã¡ng tin cáº­y; partition theo `orderId`.
- API thiáº¿t káº¿ rÃµ rÃ ng cho cartâ†’orderâ†’payment vá»›i idempotency.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t DDL index tá»‘i Æ°u cho truy váº¥n lá»‹ch sá»­ Ä‘Æ¡n hÃ ng cá»§a user.
- Thiáº¿t káº¿ event types cho dÃ²ng Ä‘á»i Ä‘Æ¡n hÃ ng: ORDER_CREATED, ORDER_RESERVED, PAYMENT_SUCCESS/FAILED, ORDER_PAID, ORDER_CANCELLED.
- `curl` test táº¡o Ä‘Æ¡n hÃ ng vÃ  theo dÃµi sá»± kiá»‡n (gá»£i Ã½ dÃ¹ng kcat / rabbitmqadmin).

DB Choices & Ops:

- OLTP: PostgreSQL/MySQL; chá»n Postgres náº¿u dÃ¹ng nhiá»u JSONB, full-text; MySQL náº¿u cáº§n tÆ°Æ¡ng thÃ­ch há»‡ sinh thÃ¡i hiá»‡n cÃ³.
- Cache: Redis cho sáº£n pháº©m phá»• biáº¿n, giá» hÃ ng (TTL), session.
- Outbox: báº£ng Postgres cÃ³ index theo `(processed, created_at)` Ä‘á»ƒ batch relay hiá»‡u quáº£.
- Migration gates: block start khi Flyway pending migrations; readiness probe phá»¥ thuá»™c DB ready.

---

<a id="ch16"></a>

## 16. Dá»± Ã¡n máº«u: Social Network

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: timeline, bÃ i Ä‘Äƒng, bÃ¬nh luáº­n, theo dÃµi.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 2â€“14.
- LÃ½ do: mÃ´ hÃ¬nh quan há»‡ ngÆ°á»i dÃ¹ng vÃ  feed.

#### Ná»™i dung chi tiáº¿t

- User/Profile/Post/Comment; API; báº£o máº­t; tá»‘i Æ°u Ä‘á»c nhiá»u.

#### VÃ­ dá»¥ code thá»±c táº¿

- Skeleton táº¡i `samples/projects/social-service`.

#### á»¨ng dá»¥ng thá»±c táº¿

- Feed theo dÃµi, thÃ´ng bÃ¡o, search.

#### Tá»‘i Æ°u & best practice

- Chá»‰ má»¥c Ä‘á»c; phÃ¢n trang keyset; rate limit.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: dá»±ng social cÆ¡ báº£n.
- BÃ i táº­p: thÃªm API theo dÃµi vÃ  feed ngÆ°á»i dÃ¹ng.

Má»¥c tiÃªu há»c:

- Há»‡ thá»‘ng Ä‘Äƒng bÃ i, comment, like, follow, thÃ´ng bÃ¡o.

Thá»i lÆ°á»£ng: 2 tuáº§n

Kiáº¿n trÃºc (ASCII):

```
[Web/Mobile] â†’ [BFF GraphQL] â†’ [User] [Post] [Comment] [Feed] [Notification]
                               â†˜ Kafka (events: POST_CREATED, LIKE_ADDED)
```

DB Schema:

- users(id, email, pass_hash, name)
- posts(id, user_id, content, created_at)
- comments(id, post_id, user_id, content, created_at)
- follows(follower_id, followee_id, created_at)
- likes(id, post_id, user_id, created_at)

API chÃ­nh:

- GraphQL Query: feed(userId, limit, cursor)
- Mutation: createPost(content), like(postId), follow(userId)

Sequence táº¡o post:

1. Post Service lÆ°u post â†’ phÃ¡t `POST_CREATED`.
2. Feed Service tiÃªu thá»¥, fan-out tá»›i followers hoáº·c ghi log Ä‘á»ƒ query fan-in.
3. Notification Service gá»­i push/email.

TÃ­ch há»£p:

- Subscription GraphQL cho real-time feed.
- Redis cache cho timeline.

Checklist:

- Chá»n mÃ´ hÃ¬nh feed (fan-out vs fan-in) theo scale.
- Dedup like, idempotency.

BÃ i táº­p: Thiáº¿t káº¿ GraphQL schema vÃ  resolver cho `createPost` + subscription `postAdded`.

NÃ¢ng cao & vÃ­ dá»¥ GraphQL:

```graphql
subscription OnPostAdded($userId: ID!) {
  postAdded(userId: $userId) {
    id
    content
    userId
    createdAt
  }
}
```

Indexes Ä‘á» xuáº¥t:

- posts(user_id, created_at desc), likes(post_id, user_id unique), follows(follower_id, followee_id unique).

TÃ³m táº¯t & Key Takeaways:

- Chá»n mÃ´ hÃ¬nh feed theo scale; dÃ¹ng cache/denormalize khi cáº§n.
- GraphQL subscriptions cho realtime; báº£o vá»‡ báº±ng auth + rate limit.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Thiáº¿t káº¿ chiáº¿n lÆ°á»£c xÃ³a dá»¯ liá»‡u (GDPR-like) áº£nh hÆ°á»Ÿng feed nhÆ° tháº¿ nÃ o?
- Tá»‘i Æ°u query feed Ä‘á»ƒ trÃ¡nh N+1 (gá»£i Ã½: batch loader/DataLoader GraphQL).
- `curl`/GraphQL Playground: táº¡o post vÃ  nháº­n subscription sá»± kiá»‡n má»›i.

DB Choices & Ops:

- Document store: MongoDB cho post/comment (ná»™i dung, embed nháº¹), index compound (user_id, created_at).
- Cache: Redis cho timeline, recent posts; invalidation dá»±a trÃªn sá»± kiá»‡n POST_CREATED/DELETED.
- Search: bá»• sung Elasticsearch/OpenSearch náº¿u cáº§n full-text máº¡nh; hoáº·c Postgres FTS.

---

<a id="ch17"></a>

## 17. Dá»± Ã¡n máº«u: Chat Realtime

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: nháº¯n tin thá»i gian thá»±c qua WebSocket/SSE.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 11.
- LÃ½ do: minh hoáº¡ reactive vÃ  realtime patterns.

#### Ná»™i dung chi tiáº¿t

- Káº¿t ná»‘i WebSocket, broadcast, rooms, lÆ°u lá»‹ch sá»­ tá»‘i thiá»ƒu.

#### VÃ­ dá»¥ code thá»±c táº¿

- Skeleton táº¡i `samples/projects/chat-service` (WebSocket echo/room).

#### á»¨ng dá»¥ng thá»±c táº¿

- Chat ná»™i bá»™, thÃ´ng bÃ¡o realtime.

#### Tá»‘i Æ°u & best practice

- Giá»›i háº¡n káº¿t ná»‘i, heartbeat, backpressure.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: ná»n táº£ng chat hoáº¡t Ä‘á»™ng.
- BÃ i táº­p: thÃªm kÃªnh phÃ²ng vÃ  lá»‹ch sá»­ tin nháº¯n inâ€‘memory.

Má»¥c tiÃªu há»c:

- PhÃ²ng chat nhiá»u ngÆ°á»i dÃ¹ng, tin nháº¯n realtime, lá»‹ch sá»­.

Thá»i lÆ°á»£ng: 1â€“2 tuáº§n

Kiáº¿n trÃºc (ASCII):

```
[Web/Mobile] â€”(WebSocket/STOMP/SSE)â†’ [Chat Gateway] â†’ [Chat Service]
                                       â†˜ Redis Pub/Sub hoáº·c Kafka â†â†’ [History/DB]
```

DB Schema:

- rooms(id, name)
- room_members(room_id, user_id)
- messages(id, room_id, sender_id, content, created_at)

Endpoint WebSocket (Spring): `/ws` vá»›i topic `/topic/rooms/{id}`.

Sequence gá»­i tin nháº¯n:

1. Client gá»­i `SEND` tá»›i `/app/rooms/{id}`.
2. Gateway publish vÃ o Kafka/Redis.
3. Chat Service lÆ°u DB, broadcast ra `/topic/rooms/{id}`.

Checklist:

- Scale theo sá»‘ káº¿t ná»‘i (WebFlux), sticky session hoáº·c token-based room auth.
- LÆ°u trá»¯: TTL, partition messages theo room.

BÃ i táº­p: Táº¡o endpoint STOMP vÃ  broadcast tin nháº¯n tá»›i cÃ¡c subscriber.

VÃ­ dá»¥ Spring STOMP:

```java
@Controller
class ChatController {
  @MessageMapping("/rooms/{id}")
  @SendTo("/topic/rooms/{id}")
  Message send(@DestinationVariable String id, Message incoming){
    return incoming;
  }
}
```

Token-based room auth: thÃªm interceptor kiá»ƒm tra quyá»n vÃ o room trÆ°á»›c khi subscribe.

TÃ³m táº¯t & Key Takeaways:

- LÆ°u/stream tÃ¡ch rá»i: DB lÆ°u lá»‹ch sá»­, broker phÃ¡t realtime.
- Scale theo káº¿t ná»‘i: dÃ¹ng WebFlux vÃ  tá»‘i Æ°u sá»‘ thread/netty.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Thiáº¿t káº¿ sharding messages theo roomId Ä‘á»ƒ scale lÆ°u trá»¯.
- Chá»‘ng spam: rate limit per user/channel nhÆ° tháº¿ nÃ o?
- Demo client JS káº¿t ná»‘i STOMP vÃ  gá»­i/nháº­n tin nháº¯n.

DB Choices & Ops:

- Realtime bus: Redis Pub/Sub hoáº·c Streams (Æ°u tiÃªn Streams Ä‘á»ƒ replay/backfill).
- LÆ°u trá»¯: Mongo (TTL index cho message cÅ©) hoáº·c Postgres partition theo room/ngÃ y.
- Backpressure: Ã¡p háº¡n má»©c sá»‘ message/giÃ¢y per room; drop/queue tÃ¹y SLA.

---

<a id="ch18"></a>

## 18. Dá»± Ã¡n máº«u: Microservices Demo End-to-End

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: nhiá»u dá»‹ch vá»¥ phá»‘i há»£p, gá»i nhau, quan sÃ¡t chung.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 12â€“14.
- LÃ½ do: thá»±c hÃ nh phÃ¢n tÃ¡ch vÃ  giao tiáº¿p giá»¯a services.

#### Ná»™i dung chi tiáº¿t

- Gateway + Order + Payment (vd. REST); cáº¥u hÃ¬nh, retry; log/trace chung.

#### VÃ­ dá»¥ code thá»±c táº¿

- Skeleton táº¡i `samples/projects/microservices-e2e` (3 services tá»‘i thiá»ƒu).

#### á»¨ng dá»¥ng thá»±c táº¿

- MÃ´ phá»ng checkout xuyÃªn dá»‹ch vá»¥; trá»±c quan trace endâ€‘toâ€‘end.

#### Tá»‘i Æ°u & best practice

- Timeouts, circuit breaker, idempotency.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: hiá»ƒu tÆ°Æ¡ng tÃ¡c multiâ€‘service.
- BÃ i táº­p: thÃªm endpoint thanh toÃ¡n giáº£ láº­p vá»›i retry.

Má»¥c tiÃªu há»c:

- Tá»• há»£p nhiá»u service: gateway, auth, product, order, inventory, payment, search.

Thá»i lÆ°á»£ng: 2â€“3 tuáº§n

Ná»™i dung:

- API Gateway (Spring Cloud Gateway) + OAuth2 login.
- Service discovery (Eureka/Consul) hoáº·c static DNS.
- gRPC ná»™i bá»™ giá»¯a orderâ€“payment.
- Kafka events, outbox.
- Observability: Grafana+Prometheus, Jaeger/Tempo.

Checklist:

- Tracing xuyÃªn dá»‹ch vá»¥ (propagate headers), correlation-id.
- Circuit breaker (resilience4j), bulkhead, retry.

BÃ i táº­p: Dá»±ng PoC 3 service vÃ  triá»ƒn khai lÃªn K8s local (kind/minikube).

NÃ¢ng cao (Resilience & Gateway):

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: product
          uri: http://product
          predicates: [Path=/api/products/**]
          filters: [TokenRelay]
resilience4j:
  circuitbreaker:
    instances:
      product: { slidingWindowSize: 50, failureRateThreshold: 50 }
  retry:
    instances:
      product: { maxAttempts: 3, waitDuration: 200ms }
```

TÃ³m táº¯t & Key Takeaways:

- Gateway há»£p nháº¥t auth/route/logging; resilience báº£o vá»‡ chuá»—i call.
- Tracing xuyÃªn dá»‹ch vá»¥ yÃªu cáº§u propagate headers chuáº©n W3C TraceContext.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t filter thÃªm `X-Correlation-Id` náº¿u chÆ°a cÃ³.
- Thiáº¿t káº¿ healthcheck vÃ  readiness cho táº¥t cáº£ service trong PoC.

---

<a id="ch19"></a>

## 19. Testing nÃ¢ng cao: Unit, Integration, Contract, E2E, Testcontainers

#### Bá»• sung hiá»‡n Ä‘áº¡i (Testcontainers & Pact)

- Testcontainers Postgres + Kafka vÃ­ dá»¥:

```java
@Testcontainers
class OrderIT {
  @Container static PostgreSQLContainer<?> pg = new PostgreSQLContainer<>("postgres:16");
  @Container static KafkaContainer kafka = new KafkaContainer(DockerImageName.parse("confluentinc/cp-kafka:7.6.0"));

  @DynamicPropertySource static void props(DynamicPropertyRegistry r){
    r.add("spring.datasource.url", () -> pg.getJdbcUrl());
    r.add("spring.datasource.username", () -> pg.getUsername());
    r.add("spring.datasource.password", () -> pg.getPassword());
    r.add("spring.kafka.bootstrap-servers", kafka::getBootstrapServers);
  }

  @Test void create_order_publishes_event(){ /* call API, assert consumed event */ }
}
```

- Pact contract test (consumer):

```java
@PactTestFor(providerName = "product-service")
class ProductApiContractTest {
  @Pact ProviderPact productPact(PactDslWithProvider p){
    return p.given("product exists")
      .uponReceiving("GET /api/products/1")
      .path("/api/products/1").method("GET")
      .willRespondWith().status(200)
      .body(newJsonBody(o -> { o.numberType("id", 1); o.stringType("name", "Book"); o.numberType("price", 10.5);}).build())
      .toPact();
  }
}
```

- E2E smoke vá»›i RestAssured hoáº·c Playwright (API/UI) cháº¡y trong CI.

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: chiáº¿n lÆ°á»£c kiá»ƒm thá»­ Ä‘a táº§ng, cÃ´ láº­p phá»¥ thuá»™c.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 4â€“8.
- LÃ½ do: tá»± tin thay Ä‘á»•i nhanh mÃ  khÃ´ng vá»¡.

#### Ná»™i dung chi tiáº¿t

- Unit/Integration/Contract (Pact)/E2E; Testcontainers; fixtures; seed data.

#### VÃ­ dá»¥ code thá»±c táº¿

- Testcontainers Postgres/Kafka, há»£p Ä‘á»“ng Pact (Ä‘Ã£ cÃ³ trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- Verify giao tiáº¿p giá»¯a services trÆ°á»›c khi triá»ƒn khai.

#### Tá»‘i Æ°u & best practice

- Test nhanh/tÃ¡ch lá»›p; dá»¯ liá»‡u á»•n Ä‘á»‹nh; cháº¡y song song.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: kiá»ƒm thá»­ lÃ  sáº£n pháº©m Ä‘áº§u tiÃªn.
- BÃ i táº­p: thÃªm contract test cho `GET /products/{id}`.

Má»¥c tiÃªu há»c:

- Phá»§ Ä‘á»§ táº§ng kiá»ƒm thá»­ vÃ  cáº¥u hÃ¬nh mÃ´i trÆ°á»ng test cÃ´ láº­p.

Thá»i lÆ°á»£ng: 1 tuáº§n

Ná»™i dung:

- Unit: JUnit5 + Mockito.
- Integration: `@SpringBootTest` vá»›i Testcontainers (Postgres/Redis/Kafka/RabbitMQ).
- Contract tests: Pact (provider/consumer) cho API/gRPC/HTTP.
- E2E: Selenium/Playwright cho UI.

VÃ­ dá»¥ Testcontainers:

```xml
<dependency>
  <groupId>org.testcontainers</groupId>
  <artifactId>postgresql</artifactId>
  <version>1.20.1</version>
  <scope>test</scope>
</dependency>
```

```java
@Testcontainers
@SpringBootTest
class ProductRepoIT {
  @Container static PostgreSQLContainer<?> pg = new PostgreSQLContainer<>("postgres:16");
  @DynamicPropertySource static void props(DynamicPropertyRegistry r){
    r.add("spring.datasource.url", pg::getJdbcUrl);
    r.add("spring.datasource.username", pg::getUsername);
    r.add("spring.datasource.password", pg::getPassword);
  }
  @Autowired ProductRepo repo;
  @Test void save_and_find(){ var p=new Product(); p.name="A"; p.price=new BigDecimal("10");
    var saved=repo.save(p); assertTrue(repo.findById(saved.id).isPresent()); }
}
```

VÃ­ dá»¥ Pact (consumer DSL rÃºt gá»n):

```java
@PactTestFor(providerName = "product-provider")
class ProductConsumerPactTest { /* Ä‘á»‹nh nghÄ©a interactions vÃ  verify */ }
```

BÃ i táº­p: Viáº¿t integration test táº¡o sáº£n pháº©m vÃ  kiá»ƒm tra cache hoáº¡t Ä‘á»™ng.

NÃ¢ng cao (Testing chiáº¿n lÆ°á»£c):

- PhÃ¢n táº§ng: unit nhanh â†’ integration chá»n lá»c â†’ contract Ä‘á»ƒ chá»‘ng phÃ¡ vá»¡ â†’ E2E cho happy path chÃ­nh.
- Mockito tips: trÃ¡nh over-mock; test hÃ nh vi domain thay vÃ¬ chi tiáº¿t triá»ƒn khai.
- Pact: publish contracts vÃ o broker; CI cá»§a provider verify trÆ°á»›c khi release.
- Mutation testing (PIT): Ä‘o Ä‘á»™ hiá»‡u quáº£ test.

TÃ³m táº¯t & Key Takeaways:

- Äá»§ 3 lá»›p test: unit, integration (Testcontainers), contract; E2E tá»‘i thiá»ƒu.
- TÃ¡ch test profiles, khá»Ÿi táº¡o dá»¯ liá»‡u test qua SQL/data builders.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- Viáº¿t `@DataJpaTest` cho repo vÃ  so sÃ¡nh tá»‘c Ä‘á»™ vá»›i `@SpringBootTest`.
- ThÃªm Kafka Testcontainers vÃ  test consumer idempotent.
- Táº¡o má»™t há»£p Ä‘á»“ng Pact cho `GET /api/products/{id}`.

---

<a id="ch20"></a>

## 20. Báº£o máº­t chuyÃªn sÃ¢u: OAuth2/OIDC, PKCE, RBAC/ABAC, Anti-XSS/CSRF/CORS

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: OAuth2/OIDC + PKCE; RBAC/ABAC; báº£o vá»‡ trÃ¬nh duyá»‡t.
- Kiáº¿n thá»©c ná»n: chÆ°Æ¡ng 8â€“9.
- LÃ½ do: báº£o vá»‡ endâ€‘user vÃ  tÃ i sáº£n doanh nghiá»‡p.

#### Ná»™i dung chi tiáº¿t

- Flows OAuth2; id_token; role/permission; antiâ€‘XSS/CSRF/CORS; headers an toÃ n.

#### VÃ­ dá»¥ code thá»±c táº¿

- Resource server JWT, method security, CORS cáº¥u hÃ¬nh (Ä‘Ã£ cÃ³ trong chÆ°Æ¡ng).

#### á»¨ng dá»¥ng thá»±c táº¿

- PhÃ¢n quyá»n chi tiáº¿t theo phÃ²ng ban/chá»§ sá»Ÿ há»¯u; báº£o vá»‡ SPA/mobile.

#### Tá»‘i Æ°u & best practice

- Rotate refresh token; sameâ€‘site cookies; CSP.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: defenseâ€‘inâ€‘depth cho á»©ng dá»¥ng web/API.
- BÃ i táº­p: rule ABAC xem Ä‘Æ¡n hÃ ng theo ownerId.

Má»¥c tiÃªu há»c:

- Hiá»ƒu OAuth2/OIDC flow, PKCE; mÃ´ hÃ¬nh RBAC/ABAC; báº£o vá»‡ Ä‘áº§u vÃ o vÃ  trÃ¬nh duyá»‡t.

Thá»i lÆ°á»£ng: 1â€“2 tuáº§n

Ná»™i dung:

- OAuth2 Authorization Code + PKCE, refresh token, token revocation.
- OIDC: id_token vÃ  claims.
- RBAC: role-based; ABAC: theo thuá»™c tÃ­nh (dept, ownerId).
- Input validation (Hibernate Validator), sanitization, SQL injection (PreparedStatement), XSS (encode output), CSRF (stateless JWT thÃ¬ disable CSRF), CORS cáº¥u hÃ¬nh allowlist.

VÃ­ dá»¥ Spring Security OAuth2 Resource Server:

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-oauth2-resource-server</artifactId>
</dependency>
```

```java
@Bean SecurityFilterChain api(HttpSecurity http) throws Exception {
  http.oauth2ResourceServer(o -> o.jwt());
  http.authorizeHttpRequests(a->a.anyRequest().authenticated());
  return http.build();
}
```

VÃ­ dá»¥ method-level security:

```java
@PreAuthorize("hasAuthority('product:write') or hasRole('ADMIN')")
public Product createProduct(...) { /* ... */ }
```

Báº£ng permission máº«u:

- permissions(id, code: `product:read`, `product:write`, ...)
- role_permissions(role_id, permission_id)
- user_attributes(user_id, key, value) â€” cho ABAC.

BÃ i táº­p: ThÃªm kiá»ƒm tra ABAC: chá»‰ chá»§ sá»Ÿ há»¯u Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c xem chi tiáº¿t.

Checklist security audit:

- Quáº£n lÃ½ secrets, TLS, headers báº£o máº­t (HSTS, CSP), log truy cáº­p.
- Kiá»ƒm tra dependency vulnerabilities (OWASP Dependency Check).

NÃ¢ng cao (OAuth2/OIDC & TrÃ¬nh duyá»‡t):

- Authorization Code + PKCE: public client (SPA/mobile) báº¯t buá»™c PKCE; rotate refresh token.
- Token TTL ngáº¯n; refresh token dÃ i hÆ¡n, rÃ ng buá»™c device/fingerprint náº¿u cáº§n.
- CSRF: vá»›i session stateful báº­t CSRF token; vá»›i JWT stateless thÃ¬ disable CSRF filter nhÆ°ng báº£o vá»‡ báº±ng same-site cookie vÃ  CORS cháº·t cháº½.
- XSS: encode output, CSP háº¡n cháº¿ nguá»“n script; sanitize input HTML (vd. OWASP Java HTML Sanitizer) khi cáº§n WYSIWYG.

VÃ­ dá»¥ CORS an toÃ n (Spring Boot 3):

```yaml
spring:
  web:
    cors:
      allowed-origins: ["https://app.example.com"]
      allowed-methods: ["GET", "POST", "PUT", "DELETE"]
      allow-credentials: true
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (Authorization Server & CSP)

- Spring Authorization Server tá»‘i thiá»ƒu (cho mÃ´i trÆ°á»ng dev/test):

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-oauth2-authorization-server</artifactId>
</dependency>
```

```java
@Configuration @EnableWebSecurity
class AuthzConfig {
  @Bean SecurityFilterChain authz(HttpSecurity http) throws Exception {
    OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
    return http.build();
  }
  @Bean RegisteredClientRepository clients(){
    var c = RegisteredClient.withId(UUID.randomUUID().toString())
      .clientId("spa").clientName("spa")
      .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
      .redirectUri("http://localhost:3000/callback")
      .scope("openid").scope("profile").build();
    return new InMemoryRegisteredClientRepository(c);
  }
}
```

- CSP headers (giá»›i háº¡n nguá»“n script/style) vÃ  Security headers cÆ¡ báº£n:

```java
@Bean SecurityFilterChain api(HttpSecurity http) throws Exception {
  http.headers(h -> h
    .contentSecurityPolicy(csp -> csp.policyDirectives("default-src 'self'; script-src 'self' 'unsafe-inline'"))
    .httpStrictTransportSecurity(hsts -> hsts.includeSubDomains(true))
    .referrerPolicy(r -> r.policy(ReferrerPolicyHeaderWriter.ReferrerPolicy.SAME_ORIGIN))
  );
  return http.build();
}
```

#### Bá»• sung hiá»‡n Ä‘áº¡i (Keycloak & Resource Server JWT)

- docker-compose Keycloak (dev):

```yaml
services:
  keycloak:
    image: quay.io/keycloak/keycloak:24.0
    command: ["start-dev", "--http-port=8087"]
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    ports: ["8087:8087"]
```

- Resource server trá» tá»›i JWK Set URI tá»« Keycloak realm:

```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:8087/realms/demo/protocol/openid-connect/certs
```

- Mapping role â†’ authorities: dÃ¹ng `JwtAuthenticationConverter` Ä‘á»c `realm_access.roles`.

TÃ³m táº¯t & Key Takeaways:

- Náº¯m flow OAuth2/OIDC thá»±c táº¿ vá»›i PKCE vÃ  refresh token rotation.
- RBAC káº¿t há»£p ABAC Ä‘á»ƒ kiá»ƒm soÃ¡t chi tiáº¿t; kiá»ƒm soÃ¡t CORS/CSRF/XSS thá»±c dá»¥ng.

Checkpoint tá»± Ä‘Ã¡nh giÃ¡:

- MÃ´ táº£ chiáº¿n lÆ°á»£c revoke refresh token khi thiáº¿t bá»‹ bá»‹ máº¥t.
- Viáº¿t rule ABAC cho phÃ©p admin phÃ²ng ban xem Ä‘Æ¡n hÃ ng thuá»™c phÃ²ng.
- Báº­t HTTP security headers cÆ¡ báº£n (HSTS/CSP) trong Spring Security.

---

<a id="ch21"></a>

## 21. Phá»¥ lá»¥c

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: táº­p há»£p máº«u cáº¥u hÃ¬nh vÃ  lá»‡nh tiá»‡n dá»¥ng.
- Kiáº¿n thá»©c ná»n: Ä‘Ã£ há»c cÃ¡c chÆ°Æ¡ng trÆ°á»›c.
- LÃ½ do: tra cá»©u nhanh khi triá»ƒn khai.

#### Ná»™i dung chi tiáº¿t

- BOM, docker-compose, GH Actions, Gradle, log cáº¥u trÃºc (máº«u Ä‘Ã£ cÃ³ trong chÆ°Æ¡ng).

#### VÃ­ dá»¥ code thá»±c táº¿

- CÃ¡c máº«u cáº¥u hÃ¬nh sáºµn dÃ¹ng; copy vÃ  chá»‰nh cho dá»± Ã¡n.

#### á»¨ng dá»¥ng thá»±c táº¿

- DÃ¹ng Ä‘á»ƒ khá»Ÿi táº¡o nhanh vÃ  chuáº©n hoÃ¡ dá»± Ã¡n trong team.

#### Tá»‘i Æ°u & best practice

- LuÃ´n giá»¯ secret an toÃ n; tÃ¡i sá»­ dá»¥ng BOM; pin version.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: há»™p cÃ´ng cá»¥ triá»ƒn khai nhanh.
- BÃ i táº­p: táº¡o compose cho Postgres/Redis/Kafka local.

Cheat-sheets:

- Git: `git clone`, `branch`, `commit`, `push`, `rebase`, `tag`.
- SQL: `SELECT`, `JOIN`, index, transaction ACID.
- JPA annotations: `@Entity`, `@Id`, `@OneToMany`, `@ManyToOne`, `@Embeddable`.
- Spring annotations: `@Component`, `@Service`, `@Repository`, `@Configuration`, `@Bean`, `@RestController`, `@ControllerAdvice`.

Máº«u `pom.xml` (rÃºt gá»n vá»›i Spring Boot BOM):

```xml
<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-dependencies</artifactId>
      <version>3.3.2</version>
      <type>pom</type>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>
```

Docker Compose (Postgres+Redis+Kafka rÃºt gá»n):

```yaml
services:
  postgres:
    image: postgres:16
    environment: { POSTGRES_USER: shop, POSTGRES_PASSWORD: shop, POSTGRES_DB: shop }
    ports: ["5432:5432"]
  redis:
    image: redis:7
    ports: ["6379:6379"]
  kafka:
    image: bitnami/kafka:3
    environment: { KAFKA_ENABLE_KRAFT: "yes" }
    ports: ["9092:9092"]
```

Docker Compose (Postgres + MySQL + MongoDB + Redis):

```yaml
services:
  postgres:
    image: postgres:16
    environment: { POSTGRES_USER: app, POSTGRES_PASSWORD: app, POSTGRES_DB: app }
    ports: ["5432:5432"]
  mysql:
    image: mysql:8
    environment: { MYSQL_ROOT_PASSWORD: root, MYSQL_DATABASE: app }
    command: ["--default-authentication-plugin=mysql_native_password"]
    ports: ["3306:3306"]
  mongo:
    image: mongo:7
    ports: ["27017:27017"]
  redis:
    image: redis:7
    ports: ["6379:6379"]
```

GitHub Actions (rÃºt gá»n):

```yaml
name: ci
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: { distribution: temurin, java-version: 17 }
      - run: mvn -B -DskipTests verify
      - uses: docker/login-action@v3
        with: { registry: ghcr.io, username: ${{ github.actor }}, password: ${{ secrets.GITHUB_TOKEN }} }
      - run: docker build -t ghcr.io/org/app:${{ github.sha }} .
      - run: docker push ghcr.io/org/app:${{ github.sha }}
```

Máº«u `build.gradle` (Gradle Kotlin DSL):

```kotlin
plugins {
  id("org.springframework.boot") version "3.3.2"
  id("io.spring.dependency-management") version "1.1.5"
  java
}

java { sourceCompatibility = JavaVersion.VERSION_17 }

repositories { mavenCentral() }

dependencies {
  implementation("org.springframework.boot:spring-boot-starter-web")
  testImplementation("org.springframework.boot:spring-boot-starter-test")
}

tasks.test { useJUnitPlatform() }
```

Logback JSON (structured logging):

```xml
<configuration>
  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LogstashEncoder" />
  </appender>
  <root level="INFO"><appender-ref ref="STDOUT"/></root>
  <logger name="org.springframework" level="INFO"/>
  <logger name="org.hibernate.SQL" level="WARN"/>
  <logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="WARN"/>
  <!-- MDC fields like traceId/spanId if using OTel -->
</configuration>
```

Rollback plan:

- Blue/Green hoáº·c Canary; giá»¯ version N-1 sáºµn sÃ ng; script rollback.

Pre-deploy checklist:

- DB migration Ä‘Ã£ cháº¡y? Health check pass? Observability OK? Secrets cáº­p nháº­t?

---

<a id="ch22"></a>

## 22. Timeline Ä‘á» xuáº¥t

#### Giá»›i thiá»‡u

- Má»¥c tiÃªu: láº­p káº¿ hoáº¡ch há»c phÃ¹ há»£p quá»¹ thá»i gian.
- Kiáº¿n thá»©c ná»n: toÃ n bá»™ giÃ¡o trÃ¬nh.
- LÃ½ do: Ä‘áº£m báº£o tiáº¿n Ä‘á»™ vÃ  nhá»‹p thá»±c hÃ nh Ä‘á»u Ä‘áº·n.

#### Ná»™i dung chi tiáº¿t

- Ba tá»‘c Ä‘á»™: nhanh/trung bÃ¬nh/cháº­m; Ä‘iá»u chá»‰nh theo má»¥c tiÃªu cÃ¡ nhÃ¢n.

#### VÃ­ dá»¥ code thá»±c táº¿

- KhÃ´ng Ã¡p dá»¥ng; tham chiáº¿u cÃ¡c dá»± Ã¡n máº«u Ä‘á»ƒ phÃ¢n bá»• thá»i gian.

#### á»¨ng dá»¥ng thá»±c táº¿

- Láº­p lá»‹ch há»c vÃ  review theo checkpoint tá»«ng chÆ°Æ¡ng.

#### Tá»‘i Æ°u & best practice

- Táº¡o nháº­t kÃ½ há»c, Ä‘Ã¡nh giÃ¡ theo tuáº§n, giá»¯ context báº±ng miniâ€‘project.

#### TÃ³m táº¯t & bÃ i táº­p

- TÃ³m táº¯t: káº¿ hoáº¡ch 8â€“48 tuáº§n linh hoáº¡t.
- BÃ i táº­p: chá»n tá»‘c Ä‘á»™ vÃ  lÃªn lá»‹ch cá»¥ thá»ƒ trong calendar.

- Tá»•ng thá»ƒ: 24 tuáº§n (6â€“8 giá»/tuáº§n)

PhÃ¢n bá»• theo chÆ°Æ¡ng (Æ°á»›c lÆ°á»£ng):

- Tuáº§n 1: Ch.1â€“2 (Giá»›i thiá»‡u, Java cÆ¡ báº£n)
- Tuáº§n 2: Ch.3
- Tuáº§n 3: Ch.4
- Tuáº§n 4: Ch.5
- Tuáº§n 5â€“6: Ch.6
- Tuáº§n 7: Ch.7
- Tuáº§n 8: Ch.8
- Tuáº§n 9: Ch.9
- Tuáº§n 10: Ch.10
- Tuáº§n 11: Ch.11
- Tuáº§n 12: Ch.12
- Tuáº§n 13â€“14: Ch.13
- Tuáº§n 15â€“16: Ch.14
- Tuáº§n 17â€“19: Ch.15 (E-commerce)
- Tuáº§n 20â€“21: Ch.16 (Social)
- Tuáº§n 22â€“23: Ch.17 (Chat)
- Tuáº§n 24: Ch.18 + Ch.19â€“20 + Ã´n táº­p

Ba tá»‘c Ä‘á»™ há»c:

- Nhanh (full-time ~ 30â€“40h/tuáº§n): 8â€“10 tuáº§n. Má»—i â€œtuáº§nâ€ á»Ÿ trÃªn coi nhÆ° 2â€“3 ngÃ y.
- Trung bÃ¬nh (part-time ~ 10â€“12h/tuáº§n): 24 tuáº§n nhÆ° báº£ng.
- Cháº­m (hobby ~ 4â€“6h/tuáº§n): 40â€“48 tuáº§n; má»—i tuáº§n á»Ÿ trÃªn kÃ©o dÃ i 2 tuáº§n thá»±c táº¿.

CÃ¡ch sá»­ dá»¥ng timeline:

- Má»—i chÆ°Æ¡ng Ä‘á»u cÃ³ BÃ i táº­p & Checkpoint â€” coi Ä‘Ã³ lÃ  Ä‘iá»u kiá»‡n qua chÆ°Æ¡ng.
- Æ¯u tiÃªn lÃ m ngay má»™t mini-project sau má»—i khá»‘i (Beginner, Intermediate, Advanced) trÆ°á»›c khi sang Expert.

---

Káº¿t luáº­n: Vá»›i lá»™ trÃ¬nh nÃ y, báº¡n cÃ³ thá»ƒ tá»± mÃ¬nh xÃ¢y dá»±ng vÃ  triá»ƒn khai cÃ¡c há»‡ thá»‘ng Java/Spring Boot hiá»‡n Ä‘áº¡i, cÃ³ kiá»ƒm thá»­, báº£o máº­t, hiá»‡u nÄƒng vÃ  DevOps Ä‘áº§y Ä‘á»§. HÃ£y giá»¯ nhá»‹p Ä‘á»™ Ä‘á»u, Æ°u tiÃªn thá»±c hÃ nh, vÃ  Ä‘á»«ng quÃªn Ä‘o Ä‘áº¡c (metrics) Ä‘á»ƒ há»c tá»« dá»¯ liá»‡u thá»±c táº¿.
